function UpdraftCentral_WPO_Management(){var _,d,v,f,g,m=this,h=jQuery,l=new UpdraftCentral_Queue,s=new UpdraftCentral_Collection,n=UpdraftCentral.get_debug_level(),c="WP-Optimize",u="wp-optimize",b="WP-Optimize Premium",z="wp-optimize-premium",y={};function k(t,e,i){var n=!1,o=!1,a=i;return _=i,d=u,t||(n=!0,-1!==a.indexOf("Premium")&&(a=a.replace(" Premium",""))),i={action:{install_and_activate:n,activate:o=!e&&t?!0:o,messages:{not_installed:vsprintf(udclion.plugin_not_installed,[a]),install_and_activate:udclion.plugin_install_and_activate,not_activated:vsprintf(udclion.plugin_not_activated,[_]),activate:udclion.plugin_activate}}},UpdraftCentral.template_replace("wpo-wpo-not_active",i)}function i(n,o){var a="",s=r(n);UpdraftCentral.set_loading(s),F(n,c,u).then(function(t){var i;t.installed&&t.active?m.load_contents(n,o):(m.current_section=o,!t.installed||t.installed&&!t.active?(i=!(!t.installed||t.active),F(n,b,z).then(function(t){var e;t.installed&&t.active?m.load_contents(n,o):(e=!(!t.installed||t.active),a=!e&&i?k(!0,!1,c):k(t.installed,t.active,b),UpdraftCentral.done_loading(s,a))}).fail(function(t){p(t),UpdraftCentral.done_loading(s,a)})):!t.active&&t.installed&&(a=k(t.installed,t.active,c),UpdraftCentral.done_loading(s,a)))}).fail(function(t){p(t),UpdraftCentral.done_loading(s,a)})}function C(){0===h(".wpo_scheduled_event:visible").length?(h(".wpo_auto_event_heading_container").hide(),h(".wpo_no_schedules").show()):(h(".wpo_auto_event_heading_container").show(),h(".wpo_no_schedules").hide()),0!==h(".wpo_scheduled_event:visible").length||0!==h(".wpo_auto_event:visible").length||h("#save_settings_reminder").is(":visible")?h(".wpo_no_schedules").hide():h(".wpo_no_schedules").show()}function U(){h(".wpo_auto_optimizations").select2({placeholder:f.select_optimizations}),h(".wpo_auto_optimizations").off("select2:open").on("select2:open",function(){h.fullscreen.isFullScreen()&&h(document.body).children("span.select2-container--open").appendTo("#updraftcentral_dashboard")}),h(".wpo_auto_optimizations").off("select2:opening select2:closing").on("select2:opening select2:closing",function(t){h(this).parent().find(".select2-search__field").prop("disabled",!0)})}function x(t){confirm(f.are_you_sure_you_want_to_remove_logging_destination)&&(t.closest(".wpo_logging_row, .wpo_add_logger_form").remove(),h(".wpo_logger_type").each(function(){O(h(this))}),0==h("#wp-optimize-logging-options .wpo_logging_row").length&&h("#wp-optimize-logging-options").hide(),j())}function j(){var t=h("#wp-optimize-logger-settings .save_settings_reminder");t.is(":visible")||t.slideDown("normal")}function O(t){n=[],h(".wpo_logging_row, .wpo_logger_type").each(function(){var t=h(this).is("select")?h(this).val():h(this).data("id");t&&n.push(t)});var e,i,n,o=n;for(e in o)i=o[e],f.loggers_classes_info[i].allow_multiple?h('option[value="'+i+'"]',t).show():h('option[value="'+i+'"]',t).hide()}function D(t){var e,i,n;if(t)for(e in t)t.hasOwnProperty(e)&&(i=["#wp-optimize-settings-",t[e].dom_id].join(""),n=t[e].info?t[e].info.join("<br>"):"",h(i+" .wp-optimize-settings-optimization-info").html(n))}function P(){var e=[];return h('#wpo_settings_sites_list input[type="checkbox"]').each(function(){var t=h(this);t.is(":checked")&&e.push(t.attr("value"))}),e}function q(t,e){var i,n=0,o=0;e.each(function(){h(this).is(":checked")&&o++,n++}),t.next().is("label")&&t.next().data("label")&&(i=(e=t.next()).data("label"),n==o?e.text(i):e.text(i.replace("all",[o," of ",n].join("")))),n==o?t.prop("checked",!0):t.prop("checked",!1)}function r(t){var t=t.find(".updraftcentral_row_extracontents"),e=t.find(".updraftcentral_wpo_rows");return e=0===e.length?h('<div class="updraftcentral_wpo_rows"></div>').appendTo(t):e}function p(t){var e;void 0===t.data||null!==(t=t.data)&&void 0!==t.message&&(void 0===(e=udclion.wpo[t.message])&&void 0===(e=udclion[t.message])&&(e=udclion.unknown_response),void 0!==t.values?UpdraftCentral_Library.dialog.alert("<h2>"+udclion.error+"</h2><p>"+vsprintf(e,t.values)+"</p>"):UpdraftCentral_Library.dialog.alert("<h2>"+udclion.error+"</h2><p>"+e+"</p>"))}function $(t){var i="";return"object"==(t=void 0===t?"string":t)?i=h(".updraftcentral_wpo_rows form input[name!='action'], .updraftcentral_wpo_rows form textarea, .updraftcentral_wpo_rows form select").serializeJSON({useIntKeysAsArrayIndex:!0}):(i=h(".updraftcentral_wpo_rows form input[name!='action'], .updraftcentral_wpo_rows form textarea, .updraftcentral_wpo_rows form select").serialize(),h.each(h(".updraftcentral_wpo_rows form input[type=checkbox]").filter(function(t){return 0==h(this).prop("checked")}),function(t,e){i+="&"+h(e).attr("name")+"=0"})),i}function S(){h("#enable-schedule").is(":checked")?h("#wp-optimize-auto-options").css("opacity","1"):h("#wp-optimize-auto-options").css("opacity","0.5")}function M(){h("#wp-optimize-logger-updraft_ring_logger").is(":checked")?h("#additional_options_updraft_ring_logger").show():h("#additional_options_updraft_ring_logger").hide()}function W(){h("#wp-optimize-logger-updraft_slack_logger").is(":checked")?h("#additional_options_updraft_slack_logger").show():h("#additional_options_updraft_slack_logger").hide()}function T(t,e){var i=h.Deferred();return w({name:"do_optimization",arguments:t},e).then(function(t){i.resolve(t)}).fail(function(t){i.reject(t)}),i.promise()}function w(t,e){var n=h.Deferred();return UpdraftCentral.send_site_rpc("wpoptimize."+t.name,t.arguments,e,function(t,e,i){"ok"!==e||void 0===t.data||null===t.data||t.data.error?n.reject(t):n.resolve(t.data)}),n.promise()}function F(t,e,i){return UpdraftCentral.is_plugin_active(t,e,i)}function a(i,t){!0!==h(".optimization_button_"+i).prop("disabled")&&(h("#optimization_checkbox_"+i).hide(),h("#optimization_spinner_"+i).show(),h(".optimization_button_"+i).prop("disabled",!0),h("#optimization_info_"+i).html("..."),"optimizetables"==i?h(v).each(function(t){var e=h(this).find("td");table_type=e.eq(5).text(),table=e.eq(1).text(),optimizable=e.eq(5).data("optimizable"),""!=table&&"1"==optimizable&&(e={optimization_id:i,optimization_table:e.eq(1).text(),optimization_table_type:table_type},l.enqueue(e))}):l.enqueue(i),function a(s){if(l.get_lock()){0<n&&console.log("WP-Optimize: process_queue(): got queue lock");var r=l.peek();if("object"==typeof r?r=(data=r).optimization_id:data={},void 0===r)return h(document).trigger("updraftcentral_wpo_opimization_end",[s]),0<n&&console.log("WP-Optimize: process_queue(): queue is apparently empty - exiting"),void l.unlock();0<n&&console.log("WP-Optimize: process_queue(): processing item: "+r),l.dequeue(),T({optimization_id:r,data:data},s).then(function(t){if(h("#optimization_spinner_"+r).hide(),h("#optimization_checkbox_"+r).show(),h(".optimization_button_"+r).prop("disabled",!1),t){for(var e="",i=0,n=t.errors.length;i<n;i++)e+='<span class="error">'+t.errors[i]+"</span><br>";for(i=0,n=t.messages.length;i<n;i++)e+=t.errors[i]+"<br>";for(var o,i=0,n=t.result.output.length;i<n;i++)e+=t.result.output[i]+"<br>";h("#optimization_info_"+r).html(e),t.hasOwnProperty("status_box_contents")&&(h("#wp_optimize_status_box").css("opacity","1").find(".inside").html(t.status_box_contents),h("a#wp_optimize_status_box_refresh").attr("href","#"),UpdraftCentral.register_event_handler("click","a#wp_optimize_status_box_refresh",function(){m.load_contents(s,"wp_optimize")})),t.hasOwnProperty("table_list")&&h("#wpoptimize_table_list tbody").replaceWith(t.table_list),t.hasOwnProperty("total_size")&&h("#optimize_current_db_size").html(t.total_size),"optimizetables"===r&&data.optimization_table&&(o=l.peek(),l.is_empty()||void 0===o.optimization_table?(h("#optimization_spinner_"+r).hide(),h("#optimization_checkbox_"+r).show(),h(".optimization_button_"+r).prop("disabled",!1),h("#optimization_info_"+r).html(udclion.wpo.optimization_complete)):(h("#optimization_checkbox_"+r).hide(),h("#optimization_spinner_"+r).show(),h(".optimization_button_"+r).prop("disabled",!0))),t.result.meta&&t.result.meta.hasOwnProperty("awaiting_mod")&&(0<(o=t.result.meta.awaiting_mod)?h("#adminmenu .awaiting-mod .pending-count").remove(o):h("#adminmenu .awaiting-mod").remove())}setTimeout(function(){l.unlock(),a(s)},10)})}else 0<n&&console.log("WP-Optimize: process_queue(): queue is currently locked - exiting")}(t))}h("#updraftcentral_dashboard_existingsites").on("updraftcentral_dashboard_mode_set_wpo",function(){UpdraftCentral.register_row_clicker(".updraftcentral_site_wp_optimize",function(t){i(t,"wp_optimize")},!0),UpdraftCentral.register_row_clicker(".updraftcentral_site_table_information",function(t){i(t,"table_information")},!0),UpdraftCentral.register_row_clicker(".updraftcentral_site_settings",function(t){i(t,"settings")},!0),UpdraftCentral.register_row_clicker("#btn-activate",function(e){var t,i,n=r(e);UpdraftCentral.set_loading(n),t=_,i=d,UpdraftCentral.activate_plugin(e,t,i).then(function(t){t.activated&&m.load_contents(e,m.current_section)}).fail(function(t){p(t),UpdraftCentral.done_loading(n)})},!0),UpdraftCentral.register_row_clicker("#btn-install-activate",function(e){var i=r(e);UpdraftCentral.set_loading(i),UpdraftCentral.install_activate_plugin(e,c,u).then(function(t){(t.installed||t.activated)&&m.load_contents(e,m.current_section)}).fail(function(t){p(t),UpdraftCentral.done_loading(i)})},!0)}),h(document).on("updraftcentral_wpo_opimization_start",function(t,e){void 0!==e&&r(e).css("opacity","0.3")}),h(document).on("updraftcentral_wpo_opimization_end",function(t,e){void 0!==e&&(r(e).css("opacity","1.0"),w({name:"optimizations_done",arguments:{}},e),e.find("table#optimizations_list tr").each(function(){var t=h(this).data("optimization_id");h(this).find("#optimization_spinner_"+t).is(":visible")&&(h(this).find("#optimization_spinner_"+t).hide(),h(this).find("#optimization_checkbox_"+t).show(),h(this).find(".optimization_button_"+t).prop("disabled",!1),"optimizetables"===t&&h(this).find("#optimization_info_"+t).html(udclion.wpo.optimization_complete))}))}),h("#updraftcentral_dashboard_existingsites").on("updraftcentral_listener_finished_updraftplus_backup",function(t,e){t.preventDefault(),void 0!==e.site_id?(t="site_"+e.site_id,s.exists(t)&&((e=s.item(t)).autobackup_complete||(t=e.autobackup_options,e.autobackup_complete=!0,void 0!==t&&void 0!==t.callback&&t.callback.apply(null,[])))):0<n&&console.log("WP-Optimize: unexpected site id was returned - exiting")}),this.toggle_feature=function(t,e,i){var n,o=r(i);void 0!==e&&e.length&&(e="enable"===(e=(e=e.attr("id").split("-"))[e.length-1]),UpdraftCentral.set_loading(o),t=t,e=e,i=i,n=h.Deferred(),w({name:"enable_or_disable_feature",arguments:{type:t,enable:e?1:0}},i).then(function(t){n.resolve(t)}).fail(function(t){n.reject(t)}),n.promise().then(function(t){void 0!==t.output&&t.output.length&&UpdraftCentral_Library.dialog.alert("<h2>"+udclion.wpo.feature_update_heading+"</h2><p>"+t.output[0]+"</p>")}).fail(function(t){p(t)}).always(function(){UpdraftCentral.done_loading(o)}))},this.save_settings=function(t){var e,i,n,o=r(t),a=$(),s=(i=0,h("#wpo_auto_events .wpo_auto_event").each(function(){0===h(this).find("ul.select2-selection__rendered > li.select2-selection__choice").length&&i++}),i);if(!function(){var t=!0,e=f.fill_all_settings_fields;h("ul.select2-selection__rendered").each(function(){0===h(this).find("li.select2-selection__choice").length?(t=!1,e=f.fill_all_fields,h(this).closest(".select2-selection--multiple").addClass("wpo_error_field")):h(this).closest(".select2-selection--multiple").removeClass("wpo_error_field")}),h(".wpo_schedule_type, .wpo_logger_addition_option, .wpo_logger_type").each(function(){!function(t,e){var i=t.val(),t=t.data("validate");if(!t&&e)return""!=i.trim();if(t&&!e&&""==i.trim())return!0;var n=!0;switch(t){case"email":for(var o=/\S+@\S+\.\S+/,a=i.split(","),s="",r=0;r<a.length;r++)""!=(s=a[r].trim())&&o.test(s)||(n=!1);break;case"url":n=(o=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,}))\.?)(?::\d{2,5})?(?:[/?#]\S*)?$/i).test(i)}return n}(h(this),!0)?(t=!1,h(this).addClass("wpo_error_field")):h(this).removeClass("wpo_error_field")}),t?h("#wp-optimize-logger-settings .save_settings_reminder").slideUp():h("#wp-optimize-settings-save-results").show().addClass("wpo_alert_notice").text(e).delay(5e3).fadeOut(3e3,function(){h(this).removeClass("wpo_alert_notice")});return t}())return!1;0<s?UpdraftCentral_Library.dialog.alert("<h2>"+udclion.wpo.save_settings_heading+"</h2><p>"+udclion.wpo.empty_schedule+"</p>"):(UpdraftCentral.set_loading(o),s=a,a=t,n=h.Deferred(),w({name:"save_settings",arguments:s},a).then(function(t){n.resolve(t)}).fail(function(t){n.reject(t)}),n.promise().then(function(t){void 0!==t.save_results&&(e=t.save_results)}).fail(function(t){p(t)}).always(function(){UpdraftCentral.done_loading(o).then(function(){void 0!==e&&(void 0!==e.errors&&e.errors.length?UpdraftCentral_Library.dialog.alert("<h2>"+udclion.wpo.save_settings_heading+"</h2><p>"+e.errors[0]+"</p>"):(UpdraftCentral_Library.dialog.alert("<h2>"+udclion.wpo.save_settings_heading+"</h2><p>"+e.messages[0]+"</p>"),m.load_contents(t,"settings")))})}))},this.run_optimization_single=function(t,i){h(document).trigger("updraftcentral_wpo_opimization_start",[i]),m.pre_optimization_run(i,!1,function(){var e=h(t).closest(".wp-optimize-settings").data("optimization_id");e?m.pre_save_options(i,function(t){h("#wpo_settings_sites_list").length?m.save_sites_list({"wpo-sites":P()},i).then(function(t){a(e,i)}):a(e,i)}):console.log("Optimization ID corresponding to pressed button not found")})},this.run_optimization_all=function(o){h(document).trigger("updraftcentral_wpo_opimization_start",[o]),m.pre_optimization_run(o,!0,function(){m.pre_save_options(o,function(n){if(h("#wpo_settings_sites_list").length)m.save_sites_list({"wpo-sites":P()},o).then(function(t){for(var e in n){var i=n[e];void 0!==i.active&&1==i.active&&a(e,o)}});else for(var t in n){var e=n[t];void 0!==e.active&&1==e.active&&a(t,o)}})})},this.pre_save_options=function(t,e){i={},($optimizations=h("#optimizations_list .optimization_checkbox:checked")).sort(function(t,e){return t=h(t).closest(".wp-optimize-settings").data("optimization_run_sort_order"),(e=h(e).closest(".wp-optimize-settings").data("optimization_run_sort_order"))<t?1:t<e?-1:0}),$optimizations.each(function(t){var e=h(this).closest(".wp-optimize-settings").data("optimization_id");e?i[e]={active:1}:console.log("Optimization ID corresponding to pressed button not found")});var i,n,o,a=i;n=a,t=t,o=h.Deferred(),w({name:"save_manual_run_optimization_options",arguments:n},t).then(function(t){o.resolve(t)}).fail(function(t){o.reject(t)}),o.promise().then(function(t){e.apply(null,[a])}).fail(function(t){p(t)})},this.pre_optimization_run=function(n,t,o){if(void 0!==t&&t&&!1===confirm(udclion.wpo.warning))return void r(n).css("opacity","1.0");var e,i,a=!1;h("#enable-auto-backup").is(":checked")&&(a=!0),t=a,e=n,i=h.Deferred(),w({name:"save_auto_backup_option",arguments:{auto_backup:t}},e).then(function(t){i.resolve(t)}).fail(function(t){i.reject(t)}),i.promise().then(function(t){var e,i="site_"+n.data("site_id");s.exists(i)&&(i=s.item(i),a&&!i.autobackup_complete?(e={_listener_title:"<h2>"+n.data("site_description")+" - "+udclion.wpo.automatic_backup+"</h2>"},i.autobackup_options={callback:o},UpdraftCentral.set_current_site_row(n),UpdraftCentral_Module_UpdraftPlus.backupnow_go(!1,!1,!1,"",e,udclion.wpo.automatic_backup,"")):o.apply(null,[]))}).fail(function(t){p(t)})},this.load_contents=function(_,d){var t,c="",u=r(_),i="site_"+_.data("site_id"),i=(s.exists(i)||(t=new UpdraftCentral_Site(_),s.add(i,t)),{name:"get_"+d+"_contents",arguments:{}});UpdraftCentral.set_loading(u),w(i,_).then(function(t){void 0!==t&&(void 0!==t.content?(c=t.content,f=t.translations):c=t)}).fail(function(t){t=p(t)}).always(function(){UpdraftCentral.done_loading(u,c).then(function(){var i,t,n,o,a,s,r,l,p;c&&c.length?(h("img.optimization_spinner, img#wpo_import_spinner").attr("src",udclion.wpo.images+"spinner-2x.gif").attr("alt","").addClass("wp_uc_spinner"),u.find(".wpo_section .button").addClass("btn"),u.find(".wpo_section .button-primary").addClass("btn-primary"),u.find(".wpo_section .button-secondary").addClass("btn-secondary"),u.find("a#wp_optimize_status_box_refresh").attr("href","#"),void 0!==(t=u.find("input#wp-optimize-settings-save"))&&t.length&&((btn_save_clone=t.clone()).attr("type","button"),t.replaceWith(btn_save_clone)),void 0!==(t=u.find("input#wp-optimize"))&&t.length&&((btn_optimize_clone=t.clone()).attr("type","button"),t.replaceWith(btn_optimize_clone)),h("#optimizations_list .wp-optimize-settings-optimization-info a").each(function(){h(this).attr("target","_blank")}),S(),M(),W(),"wp_optimize"===d&&m.get_optimization_tables(_).then(function(t){t=h("<div>").html(t.table_list);v=t.find("tbody#the-list tr")}),s=h("#wpoptimize_table_list_filter"),r=h("#wpoptimize_table_list"),l=h("#wpoptimize_table_list tbody:last"),p=h("#wpoptimize_table_list_tables_not_found"),r.tablesorter({theme:"default",widgets:["zebra","rows","filter"],cssInfoBlock:"tablesorter-no-sort",headers:{7:{sorter:!1}},widgetOptions:{filter_external:s,filter_defaultFilter:{2:"~{query}"}}}),r.on("filterEnd",function(){""==s.val().trim()?l.show():l.hide(),0==h("#the-list tr:visible",r).length?p.show():p.hide()}),h("button.run-single-table-optimization").addClass("btn btn-secondary"),h("#optimize_current_db_size").closest("h3").addClass("updraftcentral-current-db-size"),h("#wpoptimize_table_list > tbody > tr").each(function(t){var e=h(this);t%2==1?e.addClass("even"):e.addClass("odd")}),h("#wpoptimize_table_list th > div.tablesorter-header-inner").each(function(){var t=h(this).html();h(this).closest("th").attr("data-label",t)}),i="",h("#wpo_settings_sites_list_cron").length&&(i="_cron"),q(h("#wpo_settings_sites_list"+i+" #wpo_all_sites"+i),h("#wpo_sitelist_moreoptions"+i+' input[type="checkbox"]')),UpdraftCentral.register_event_handler("click","#wpo_sitelist_show_moreoptions"+i,function(){h("#wpo_sitelist_moreoptions"+i).hasClass("wpo_always_visible")||h("#wpo_sitelist_moreoptions"+i).toggleClass("wpo_hidden")}),UpdraftCentral.register_event_handler("change","#wpo_settings_sites_list"+i+" #wpo_all_sites"+i,function(){var t=h(this),e=h("#wpo_sitelist_moreoptions"+i+' input[type="checkbox"]');t.is(":checked")?e.prop("checked",!0):e.prop("checked",!1),q(t,e)}),UpdraftCentral.register_event_handler("change","#wpo_sitelist_moreoptions"+i+' input[type="checkbox"]',function(){var t=h("#wpo_sitelist_moreoptions"+i+' input[type="checkbox"]');q(h("#wpo_settings_sites_list"+i+" #wpo_all_sites"+i),t)}),UpdraftCentral.register_event_handler("change",'#wpo_settings_sites_list input[type="checkbox"]',function(){var t,e;e=[(t=_).data("site_id"),P().join("_")].join("_"),y.hasOwnProperty(e)?D(y[e]):w({name:"get_optimizations_info",arguments:{"wpo-sites":P()}},t).then(function(t){void 0!==t&&!1!==t&&D(y[e]=t)})}),UpdraftCentral.register_event_handler("click","#wpoptimize_table_list .run-single-table-optimization",function(){var e=h(this),i=e.next(),n=i.next(),t={optimization_id:"optimizetables",optimization_table:e.data("table"),optimization_table_type:e.data("type")};i.removeClass("visibility-hidden"),T({optimization_id:"optimizetables",data:t},_).then(function(t){e.prop("disabled",!1),i.addClass("visibility-hidden"),n.show().removeClass("visibility-hidden").delay(3e3).fadeOut("slow")})}),UpdraftCentral.register_event_handler("click","#wpoptimize_table_list .run-single-table-delete",function(){if(!confirm(udclion.wpo.are_you_sure_you_want_to_remove_this_table))return!1;var n=h(this),t=n.next(),o=t.next(),a=n.data("table"),e=(data={optimization_id:"orphanedtables",optimization_table:a},t.removeClass("visibility-hidden"),{optimization_id:"orphanedtables",data:data});m.pre_optimization_run(_,!1,function(){T(e,_).then(function(t){var i,e;t.result.meta.success?(i=n.closest("tr"),o.show().removeClass("visibility-hidden"),setTimeout(function(){i.fadeOut("slow",function(){var t,e;i.remove(),t=h("#wpoptimize_table_list"),e=!0,h("tr",t).each(function(){var t=h(this);if(0<h("button",t).length)return e=!1}),h("tr",t).each(function(){var t=h(this);e?h("td:last, th:last",t).hide():h("td:last, th:last",t).show()})})},500)):(e=vsprintf(udclion.wpo.table_was_not_deleted,[a]),t.result.meta.message&&(e+="("+t.result.meta.message+")"),UpdraftCentral_Library.dialog.alert("<h2>"+udclion.error+"</h2><p>"+e+"</p>"))}).always(function(){n.prop("disabled",!1),t.addClass("visibility-hidden")})})}),UpdraftCentral.register_event_handler("click","#wpo_import_settings_btn",function(){var t=h("#wpo_import_settings_file"),i=t.val(),t=t[0].files[0],n=new FileReader;if(h("#wpo_import_settings_btn").prop("disabled",!0),!/\.json$/.test(i))return e.preventDefault(),h("#wpo_import_settings_btn").prop("disabled",!1),h("#wpo_import_error_message").text(udclion.wpo.please_select_settings_file).slideDown(),!1;n.onload=function(){var t,e,i,n,o;t=this.result,e=_,i=h("#wpo_import_spinner"),n=h("#wpo_import_success_message"),o=h("#wpo_import_error_message"),t={name:"import_settings",arguments:{settings:t}},i.show(),w(t,e).then(function(t){i.hide(),t&&t.errors&&t.errors.length?(o.text(t.errors.join("<br>")),o.slideDown()):t&&t.messages&&t.messages.length&&(n.text(t.messages.join("<br>")),n.slideDown(),setTimeout(function(){m.load_contents(e,"settings")},2e3)),h("#wpo_import_settings_btn").prop("disabled",!1)})},n.readAsText(t)}),UpdraftCentral.register_event_handler("change","#wpo_import_settings_file",function(){h("#wpo_import_error_message").slideUp()}),UpdraftCentral.register_event_handler("click","#wpo_export_settings_btn",function(){var t,e,i,n,o,a;t=$("object"),i=document.body.appendChild(document.createElement("a")),n=new Date,o=n.getFullYear(),a=n.getMonth()<10?["0",n.getMonth()].join(""):n.getMonth(),n=n.getDay()<10?["0",n.getDay()].join(""):n.getDay(),e=e||["wpo-settings-",o,"-",a,"-",n,".json"].join(""),i.setAttribute("download",e),i.setAttribute("style","display:none;"),i.setAttribute("href","data:text/json;charset=UTF-8,"+encodeURIComponent(JSON.stringify(t))),i.click()}),UpdraftCentral.register_event_handler("click",".updraftcentral_wpo_rows input#innodb_force_optimize",function(){var t=h(this).closest("tr.wp-optimize-settings"),e=h(this).is(":checked");t.find("input.optimization_checkbox, button.wp-optimize-settings-optimization-run-button").each(function(){!e&&h(this).hasClass("optimization_checkbox")&&h(this).prop("checked",!1),h(this).prop("disabled",!e)})}),UpdraftCentral.register_event_handler("change",".updraftcentral_wpo_rows input#enable-schedule",function(){S()}),UpdraftCentral.register_event_handler("change",".updraftcentral_wpo_rows input#wp-optimize-logger-updraft_ring_logger",function(){M()}),UpdraftCentral.register_event_handler("change",".updraftcentral_wpo_rows input#wp-optimize-logger-updraft_slack_logger",function(){W()}),UpdraftCentral.register_event_handler("click",".updraftcentral_wpo_rows #wp_optimize_table_list_refresh",function(){m.load_contents(_,"table_information")}),UpdraftCentral.register_event_handler("click",'.updraftcentral_wpo_rows button[id^="wp-optimize-disable-enable-trackbacks-"]',function(){m.toggle_feature("trackbacks",h(this),_)}),UpdraftCentral.register_event_handler("click",'.updraftcentral_wpo_rows button[id^="wp-optimize-disable-enable-comments-"]',function(){m.toggle_feature("comments",h(this),_)}),UpdraftCentral.register_event_handler("click",".updraftcentral_wpo_rows input#wp-optimize-settings-save",function(){m.save_settings(_)}),UpdraftCentral.register_event_handler("click",".updraftcentral_wpo_rows a#wp_optimize_status_box_refresh",function(){m.load_contents(_,"wp_optimize")}),UpdraftCentral.register_event_handler("click",".updraftcentral_wpo_rows button.wp-optimize-settings-optimization-run-button",function(){m.run_optimization_single(this,_)}),UpdraftCentral.register_event_handler("click",".updraftcentral_wpo_rows input#wp-optimize",function(){0==h("#optimizations_list input.optimization_checkbox:checked").length?UpdraftCentral_Library.dialog.alert("<h2>"+udclion.error+"</h2><p>"+udclion.wpo.no_selected_items+"</p>"):m.run_optimization_all(_)}),void 0!==f&&(t=h("#wp-optimize-auto-options"),n=h('input[type="time"]'),o=h('input[type="date"]'),a=(new Date).toISOString().split("T")[0],g=h(".wpo_auto_event:last").data("count")||0,n.each(function(t,e){Modernizr.inputtypes.time||(h(e).timepicker({timeFormat:"H:i"}),h(e).addClass("no_date_time_support"),h(e).on("changeTime",function(){h(this).timepicker("hide")}))}),o.each(function(t,e){Modernizr.inputtypes.date||(h(e).datepicker({dateFormat:"yy-mm-dd",minDate:0}),h(e).addClass("no_date_time_support"))}),0!==h(".wpo_scheduled_event").length?h(".wpo_no_schedules").hide():h(".wpo_no_schedules").show(),U(),h("#wpo-add-event").on("click",function(t){g++;var e=UpdraftCentral.template_replace("schedule-optimizations",{optimizations:f.auto_optimizations,count:g}),i=UpdraftCentral.template_replace("schedule-schedule_types",{schedule_types:f.schedule_types,count:g}),n=UpdraftCentral.template_replace("schedule-action",{count:g}),o=(o='<div class="wpo_auto_event wpo_cf" data-count="'+g+'">')+(e+i+n)+"</div>";h("#wpo_auto_events").prepend(o+'<div class="clear"></div>'),U()}),($logging=h("#wp-optimize-logger-settings")).find(".wpo_logging_header").append('<div class="clear"></div>'),$logging.find(".wpo_logging_row").append('<div class="clear"></div>'),$logging.find(".wpo_logging_row").each(function(){0===h(this).find(".wpo_logging_options_row").html().length&&h(this).find(".wpo_logging_options_row").html("&nbsp;")}),$logging.find("#wpo_add_logger_link").on("click",function(){h("#wp-optimize-logger-settings .save_settings_reminder").after(function(){var t,e=['<option value="">Select destination</option>'];for(t in f.loggers_classes_info)f.loggers_classes_info.hasOwnProperty(t)&&e.push(['<option value="',t,'">',f.loggers_classes_info[t].description,"</option>"].join(""));return['<div class="wpo_add_logger_form">','<select class="wpo_logger_type" name="wpo-logger-type[]">',e.join(""),"<select>",'<a href="#" class="wpo_delete_logger dashicons dashicons-no-alt"></a>','<div class="wpo_additional_logger_options"></div>',"</div>"].join("")}()),O(h(".wpo_logger_type").first()),$logging.find(".wpo_logger_type").on("change",function(){var t=h(this),e=t.val();t.parent().find(".wpo_additional_logger_options").html(function(t){if(!f.loggers_classes_info[t].options)return"";var e,i=f.loggers_classes_info[t].options,n=[],o="",a="";for(e in i)i.hasOwnProperty(e)&&(a=Array.isArray(i[e])?(o=i[e][0].trim(),i[e][1].trim()):(o=i[e].trim(),""),n.push(['<input class="wpo_logger_addition_option" type="text" name="wpo-logger-options[',e,'][]" value="" ','placeholder="',o,'" ',""!==a?'data-validate="'+a+'"':"","/>"].join("")));return n.push('<input type="hidden" name="wpo-logger-options[active][]" value="1" />'),n.join("")}(e)),t.val()&&j()}),$logging.find(".wpo_add_logger_form a.wpo_delete_logger").on("click",function(){x(h(this))})}),$logging.find(".wpo_logging_row a.wpo_delete_logger").on("click",function(){x(h(this))}),$logging.find(".wpo_logging_actions_row .dashicons-edit").on("click",function(){var t=h(this),e=t.closest(".wpo_logging_row");return h(".wpo_additional_logger_options",e).removeClass("wpo_hidden"),h(".wpo_logging_options_row",e).text(""),h(".wpo_logging_status_row",e).text(""),t.hide(),!1}),$logging.find(".wpo_logging_row input.wpo_logger_active_checkbox").on("click",function(){var t=h(this).is(":checked")?1:0;h(this).closest("label").find('input[type="hidden"]').val(t)}),($auto_events=h("#wpo_auto_events")).find(".wpo_auto_event_heading_container").append('<div class="clear"></div>'),$auto_events.find(".wpo_scheduled_event").append('<div class="clear"></div>'),t.on("focus",'input[type="time"]',function(){var t=h(this).get(0);Modernizr.inputtypes.time||(h(t).timepicker({timeFormat:"H:i"}),h(t).on("changeTime",function(){h(this).timepicker("hide")}))}),t.on("keypress","input",function(t){if(13===t.keyCode)return!1}),t.on("focus",'input[type="date"]',function(){var t=h(this).get(0);Modernizr.inputtypes.date||h(t).datepicker({dateFormat:"yy-mm-dd",minDate:0})}),t.on("change",'select, input[type="date"], input[type="time"]',function(){h("#save_settings_reminder").slideDown(),C()}),t.on("change",".wpo_schedule_type",function(){var t=h(this).closest(".wpo_auto_event"),e=t.data("count")||g,i=h(this).val(),n="",e=(Modernizr.inputtypes.date&&Modernizr.inputtypes.time||(n="no_date_time_support"),{date:f.date,time:f.time,day:f.day,day_number:f.day_number,days:f.days,date_value:"",time_value:"00:00",status:f.active,status_value:"checked",week_days:f.week_days,week:f.week,count:e,class_name:n,today:a}),n=function(t,e){var i="";switch(t){case"wpo_once":i=UpdraftCentral.template_replace("schedule-once",{details:e});break;case"wpo_daily":i=UpdraftCentral.template_replace("schedule-daily",{details:e});break;case"wpo_weekly":i=UpdraftCentral.template_replace("schedule-weekly",{details:e});break;case"wpo_fortnightly":i=UpdraftCentral.template_replace("schedule-fortnightly",{details:e});break;case"wpo_monthly":i=UpdraftCentral.template_replace("schedule-monthly",{details:e})}return i}(i,e),i=UpdraftCentral.template_replace("schedule-status",{details:e}),e=UpdraftCentral.template_replace("schedule-action",{});h(this).next().html(""),t.find(".wpo_event_status").remove(),t.find(".wpo_event_actions").remove(),""!==n&&h(this).next().html(n),t.append(i+e)}),t.on("click",".wpo_edit_event",function(){var t=h(this).closest(".wpo_scheduled_event");t.hide(),t.next().append('<div class="clear"></div>').show(),C()}),t.on("click",".wpo_remove_event",function(){var t,e,i=h(this).data("count");!0===confirm(f.confirm_remove_task)&&(t=h(this).closest(".wpo_scheduled_event"),e=h(this).closest(".wpo_auto_event"),i==t.next().data("count")&&(t.next().remove(),t.remove()),i==e.prev().data("count")&&e.prev().remove(),e.remove(),h("#save_settings_reminder").slideDown(),C())})),UpdraftCentral.register_event_handler("click","#optimizations_list input#select_all_optimizations",function(){var t=!!h(this).is(":checked");h("#optimizations_list input.optimization_checkbox").each(function(){h(this).prop("checked",t)})})):(UpdraftCentral_Library.dialog.alert("<h2>"+udclion.error+"</h2><p>"+udclion.wpo.could_not_return_content+"</p>"),u.empty())})})},this.save_sites_list=function(t,e){var i=h.Deferred();return w({name:"save_site_settings",arguments:t},e).then(function(t){i.resolve(t)}).fail(function(t){i.reject(t)}),i.promise()},this.get_optimization_tables=function(t){var e=h.Deferred();return w({name:"get_table_list",arguments:{}},t).then(function(t){e.resolve(t)}).fail(function(t){e.reject(t)}),e.promise()}}jQuery(function(){new UpdraftCentral_WPO_Management});