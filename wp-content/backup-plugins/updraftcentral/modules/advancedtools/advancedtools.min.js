jQuery(function(i){i("#updraftcentral_dashboard_existingsites").on("updraftcentral_dashboard_mode_set_advancedtools",function(){UpdraftCentral.register_row_clicker(".updraftcentral_site_advanced_settings",function(a){UpdraftCentral.send_site_rpc("updraftplus.get_advanced_settings",{suppress_plugins_for_debugging:!0},a,function(t,e,n){"ok"===e&&a.find(".updraftcentral_row_extracontents").empty().append(UpdraftCentral_Library.sanitize_html(t.data))})},!0),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_menu .advanced_tools_button",function(t){var e;e=this.id,i('.expertmode .advanced_settings_container .advanced_tools:not(".'+e+'")').hide(),i(".expertmode .advanced_settings_container .advanced_tools."+e).fadeIn("slow"),i(".expertmode .advanced_settings_container .advanced_tools_button:not(#"+e+")").removeClass("active"),i(".expertmode .advanced_settings_container .advanced_tools_button#"+e).addClass("active")}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content a.updraft_diskspaceused_update",function(a){a.find(".updraft_diskspaceused").html("<em>"+udclion.advancedtools.calculating+"</em>"),UpdraftCentral.send_site_rpc("updraftplus.get_fragment",{fragment:"disk_usage",data:"updraft"},a,function(t,e,n){"ok"==e&&t&&a.find(".updraft_diskspaceused").html(UpdraftCentral_Library.sanitize_html(t.data.output))})}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content .site_info #updraftplus-phpinfo",function(t,e){UpdraftCentral.send_site_rpc("core.phpinfo",null,t,function(t,e,n){var a;"ok"==e&&t.data&&(a="",i.each(t.data,function(t,e){a+="<h3>"+t+"</h3>\n<table>\n",i.each(e,function(t,e){e.constructor===Array?a+="<tr><td>"+t+"</td><td>"+e[0]+"</td><td>"+e[1]+"</td></tr>\n":"string"==typeof e?UpdraftCentral_Library.is_numeric(t)?a+="<tr><td></td><td>"+e+"</td></tr>\n":a+="<tr><td>"+t+"</td><td>"+e+"</td></tr>\n":(console.log("UpdraftCentral: phpinfo: Unrecognised output for key "+t+" (follows)"),console.log(e))}),a+="</table>\n"}),UpdraftCentral.open_modal(udclion.advancedtools.php_info,'<div id="updraftcentral_phpinfo_results">'+a+"</div>",null,!1,null,!0,"modal-lg"))},i(this))}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content .site_info #updraftplus_httpget_go",function(t,e){data=i("#updraftplus_httpget_uri").val(),UpdraftCentral.send_site_rpc("updraftplus.http_get",data,t,function(t,e,n){UpdraftCentral.open_modal(udclion.advancedtools.response,"<p>"+UpdraftCentral_Library.sanitize_html(t.data.response)+"</p>",null,!1,null,!0)})}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content .site_info #updraftplus_httpget_gocurl",function(t,e){var n=i("#updraftplus_httpget_uri").val();UpdraftCentral.send_site_rpc("updraftplus.http_get_curl",n,t,function(t,e,n){UpdraftCentral.open_modal(udclion.advancedtools.response,"<p><pre>"+UpdraftCentral_Library.sanitize_html(t.data.response)+"</pre></p>",null,!1,null,!0,"modal-lg")})}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content .site_info #updraftplus_callwpaction_go",function(t,e){var n={wpaction:i("#updraftplus_callwpaction").val()};UpdraftCentral.send_site_rpc("core.call_wordpress_action",n,t,function(t,e,n){UpdraftCentral.open_modal(udclion.advancedtools.response,"<p>"+UpdraftCentral_Library.sanitize_html(t.data.response)+"</p>",null,!1,null,!0)})}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content .site_info #updraft_reset_sid",function(t,e){UpdraftCentral.send_site_rpc("updraftplus.reset_site_id",null,t,function(t,e,n){i("#updraft_show_sid").text(t.data)})}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content .site_info #updraftplus-rawbackuphistory",function(t,e){UpdraftCentral.send_site_rpc("updraftplus.show_raw_backup_and_file_list",null,t,function(t,e,n){UpdraftCentral.open_modal(udclion.advancedtools.raw_backup_history,'<pre><div id="raw_backup_modal">'+UpdraftCentral_Library.sanitize_html(t.data)+"</div></pre>",null,!1,null,!0,"modal-lg")})}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content .lock_admin .change_lock_settings",function(t,e){var a={old_password:i("#updraft_unlockadmin_oldpassword").val(),password:i("#updraft_unlockadmin_password").val(),session_length:i("#updraft_unlockadmin_session_length").val(),support_url:i("#updraft_unlockadmin_support_url").val()};UpdraftCentral.send_site_rpc("updraftplus.change_lock_settings",a,t,function(t,e,n){i("#updraft_unlockadmin_oldpassword").val(a.password),message=""==a.password?udclion.advancedtools.settings_unlocked:udclion.advancedtools.password_changed_to+" '"+a.password+"' ",UpdraftCentral.open_modal(udclion.advancedtools.lock_changed,"<p>"+message+"</p>",null,!1,null,!0)})}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content .updraft_central .updraft_debugrow .updraftcentral_key_delete",function(a,t){var e=i(this).data("key_id");UpdraftCentral.send_site_rpc("updraftplus.delete_key",e,a,function(t,e,n){a.find("#updraftcentral_keys").replaceWith(t.data.keys_table)})}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content .updraft_central #updraftcentral_view_log",function(t,e){UpdraftCentral.send_site_rpc("updraftplus.fetch_log",null,t,function(t,e,n){UpdraftCentral.open_modal(udclion.advancedtools.log,"<pre>"+UpdraftCentral_Library.sanitize_html(t.data.log_contents)+"</pre>",function(){},!1,null,!1,"modal-lg")})}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content .search_replace #search_replace_form .search_and_replace",function(t,e){var n={search:t.find("#search").val(),replace:t.find("#replace").val(),pagesize:t.find("#pagesize").val(),whichtables:t.find("#whichtables").val(),show_return_link:!1,show_heading:!1};UpdraftCentral.send_site_rpc("updraftplus.search_replace",n,t,function(t,e,n){UpdraftCentral.open_modal(udclion.advancedtools.response,"<h2>"+udclion.advancedtools.search_replace+"</h2><pre>"+UpdraftCentral_Library.sanitize_html(t.data.log)+"</pre>",null,!1,null,!0)})}),UpdraftCentral.register_modal_listener(".return_to_updraft",function(t){t.preventDefault(),UpdraftCentral.close_modal()}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content .total_size .count",function(t){var a=i(this).data("type"),e=(jQuery("#updraft_diskspaceused_"+a).html("<em>"+udclion.advancedtools.calculating+"</em>"),i(this).closest(".updraftcentral_site_row"));UpdraftCentral.send_site_rpc("core.count",a,e,function(t,e,n){jQuery("#updraft_diskspaceused_"+a).html(t.data)})}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content #updraftplus-settings-export",function(s,t){UpdraftCentral.send_site_rpc("updraftplus.get_settings",{include_database_decrypter:0,include_adverts:0,include_save_button:1},s,function(t,e,n){var a,d,r,t=UpdraftCentral_Library.sanitize_html(t.data.settings);a=s,t=function(t){i("body").append('<div class="hidden_udp_settings" style="display:none;">'+t+"</div>");var n=i(".hidden_udp_settings input[name!='action'], .hidden_udp_settings textarea, .hidden_udp_settings select").serialize();return i.each(i(".hidden_udp_settings input[type=checkbox]").filter(function(t){return 0==i(this).prop("checked")}),function(t,e){n+="&"+i(e).attr("name")+"=0"}),i(".hidden_udp_settings").remove(),n}(t=t).split("&"),d={},i.each(t,function(t,e){var n,e=e.split("="),a=decodeURIComponent(e[0]);if(0<=a.indexOf("option_page")||0<=a.indexOf("_wpnonce")||0<=a.indexOf("_wp_http_referer"))return!0;0<=a.indexOf("[")?(n=a.match(/\[(.*)\]/).pop(),a=a.substring(0,a.indexOf("[")),n&&"0"!==n?(void 0===d[a]&&(d[a]={}),d[a][n]=decodeURIComponent(e[1])):(void 0===d[a]&&(d[a]=[]),d[a].push(decodeURIComponent(e[1])))):d[a]=decodeURIComponent(e[1])}),r=new Date,t=JSON.stringify({version:"1.12.19",epoch_date:r.getTime(),local_date:r.toLocaleString(),network_site_url:a.data("site_url"),data:d}),i("body").append('<div id="udc_exported_settings" style="display:none;">'+t+"</div>"),UpdraftCentral_Library.download_inner_html("updraftplus-settings.json","udc_exported_settings","text/json"),i("#udc_exported_settings").remove()})}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content #updraftplus-settings-import",function(t,e){var n,a=document.getElementById("import_settings");0!=a.files.length?(a=a.files[0],(n=new FileReader).onload=function(){var t,e;t=this.result,e=decodeURIComponent(t),e=JSON.parse(e),UpdraftCentral_Library.dialog.confirm(udclion.advancedtools.importing_data_from+" "+e.network_site_url+"\n"+udclion.advancedtools.exported_on+" "+e.local_date+"\n"+udclion.advancedtools.continue_import,function(t){t&&(e=e.data,UpdraftCentral.send_site_rpc("updraftplus.save_settings",e,$site_row,function(t,e,n){message="ok"===e?udclion.advancedtools.import_success:udclion.advancedtools.import_failed,UpdraftCentral.open_modal(udclion.advancedtools.import_settings,"<p>"+message+"</p>",null,!1,null,!0)}))})},n.readAsText(a)):UpdraftCentral_Library.dialog.alert(udclion.advancedtools.import_select_file)}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content .updraft_wipe_settings",function(t,e){UpdraftCentral.send_site_rpc("updraftplus.wipe_settings",null,t,function(t,e,n){message=1==t.data?udclion.advancedtools.settings_wiped:udclion.advancedtools.wipe_settings_error,UpdraftCentral.open_modal(udclion.advancedtools.wipe_settings,"<p>"+message+"</p>",null,!1,null,!0)})})})});