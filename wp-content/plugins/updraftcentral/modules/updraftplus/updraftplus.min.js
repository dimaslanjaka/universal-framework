function UpdraftCentral_UpdraftPlus_Module(){var f=jQuery,t=".updraftcentral_row_extracontents .updraft_site_settings_output ",s="#updraftcentral_dashboard_existingsites "+t,u={},o=new UpdraftCentral_Collection,l=new UpdraftCentral_Collection,p="single";function d(t){var a=[];t.find("tr.updraft_existing_backups_row").each(function(){var t=f(this).data("key"),e=f(this).find("button.updraft_download_button");e.length&&(e=e[0].closest("td"),-1===f.inArray(t,a)&&(a.push(t),f(e).prepend('<a class="show-backup-data" data-key="'+t+'"><span class="dashicons dashicons-arrow-right"></span> '+udclion.updraftplus.select_backup_data+"</a>"),f(e).find("button.updraft_download_button").wrapAll('<span class="backup-data-'+t+' hide-backup-data"></span>')))}),UpdraftCentral.register_event_handler("click","a.show-backup-data",function(){var t=f(this).data("key");f(this).find("span.dashicons").toggleClass("dashicons-arrow-right dashicons-arrow-down"),f(this).parent().find(".backup-label-container-"+t).toggleClass("hide-backup-data"),f(this).parent().find(".backup-data-"+t).toggleClass("hide-backup-data")});var e=t.find(".updraftcentral_row_extracontents div.backup_date_label");e.length||(t.find(".updraftcentral_row_extracontents td.updraft_existingbackup_date").each(function(){f(this).wrapInner('<div class="backup_date_label"></div>')}),e=t.find(".updraftcentral_row_extracontents div.backup_date_label")),e.length&&(e.prepend('<div class="delete-backup-container"><input type="checkbox" class="delete_backup_item" name="delete_backup" value="1" /></div>'),t.find(".updraftcentral_row_extracontents div.updraft_existing_backups").append('<button id="btn-backup-bulk-delete" class="btn btn-secondary">'+udclion.updraftplus.delete_selected+"</button>")),$table=function(t,e,a){var r=t.find(".updraftcentral_row_extracontents table.existing-backups-table"),n=r.find("thead th.backup-date"),t=r.find("tbody td.updraft_existingbackup_date");void 0!==a&&a&&t.next("td").attr("class","updraft_existingbackup_data");return f('<th class="backup-'+e+'">'+udclion.updraftplus.backup+" "+e+"</th>").insertAfter(n),f('<td class="updraft_existingbackup_'+e+'"></td>').insertAfter(t),r}(t,"storage",!0),$table.find("tr.updraft_existing_backups_row").each(function(){var t=f(this);t.find(".backup_date_label img.stored_icon").each(function(){f(this).appendTo(t.find("td.updraft_existingbackup_storage"))})}),t.find(".updraftcentral_row_extracontents table.existing-backups-table").find("tr.updraft_existing_backups_row").each(function(){var t=f(this),e=t.find("td.updraft_existingbackup_data a.show-backup-data"),a="backup-label-container-"+e.data("key");f('<div class="'+a+' hide-backup-data"></div>').insertAfter(e),t.find(".backup_date_label br").wrap("<span></span>"),t.find(".backup_date_label .clear-right ~ span").appendTo(t.find("div."+a))})}UpdraftCentral.register_listener_processor("updraftplus_backup",function(t,e,a){return 0<f(t).find(".updraft_finished").length?(1<UpdraftCentral.get_debug_level()&&console.log("UDCentral: UpdraftPlus backup listener: job finished"),0):(t=f(t).data("job_id"),u.hasOwnProperty(t)||(u[t]=0),u[t]++,u[t]<30||0==u[t]%3?{call:"updraftplus.backup_progress",data:{job_id:t}}:null)}),UpdraftCentral.register_listener_processor("updraftplus.backup_progress",function(t,e,a,r){var n="";r.hasOwnProperty("l")&&(n+="<strong>"+udclion.updraftplus.lastlogline+":</strong> "+r.l+"<br>"),r.hasOwnProperty("j")&&(n+=r.j),f(t).find(".backup_state:first").html(UpdraftCentral_Library.sanitize_html(n)),a="<div class='text-center' id='info"+a+"'>"+("undefined"===jQuery.type(f(t).find(".updraft_percentage").data("info"))?udclion.updraftplus.missing_data_attributes:UpdraftCentral_Library.sanitize_html(f(t).find(".updraft_percentage").data("info")))+"</div>",a+="<progress class='progress progress-updraftcentral' value='"+("undefined"===jQuery.type(f(t).find(".updraft_percentage").data("progress"))?"0":UpdraftCentral_Library.quote_attribute(f(t).find(".updraft_percentage").data("progress")))+"' max='100' ></progress>",f(t).find(".curstage").html(a)}),UpdraftCentral.register_listener_processor("updraftplus_download",function(t,e,n){var d=[],s=null;return f(t).find(".updraftplus_downloader").each(function(t,e){f(e).data("updraft_finished")?null===s&&(s=!0):s=!1;var a=f(e).data("findex"),r=f(e).data("what"),e=f(e).data("backup_timestamp");d.push(n+","+e+","+r+","+a)}),s?(console.log("UDCentral: UpdraftPlus download listener: job finished - will not poll any more"),1):{call:"updraftplus.get_download_status",data:d}}),UpdraftCentral.register_listener_processor("updraftplus.get_download_status",function(t,e,a,r){f.each(r,function(t,e){var a,r,n,d,s,i,o;e.hasOwnProperty("base")&&(r=(a=e).base,a.f,n=a.findex,a.m,a.hasOwnProperty("p")&&a.p,a.s,a.t,d=a.timestamp,s=a.what,o="#updraftcentral_notice_container ."+(i=r+"_"+d+"_"+s+"_"+n),a.hasOwnProperty("failed")&&a.failed&&f(o).data("updraft_finished",!0),a.hasOwnProperty("e")&&a.e?(f(o+" .raw").html("<strong>"+udclion.error+":</strong> "+a.e),console.log("UDCentral: UpdraftPlus: downloader ("+i+"): an error was returned (follows)"),console.log(a)):null!==a.p?(f(o+"_st .dlfileprogress").width(a.p+"%"),null!=a.a&&0<a.a&&(e=(new Date).getTime()-f(o).data("last_time_began"),90<a.a&&6e4<e&&(console.log("UDCentral: UpdraftPlus: "+i+": restarting download: file_age="+a.a+", since_last_restart_ms="+e),i={type:s,timestamp:d,findex:n},e=f('#updraftcentral_dashboard_existingsites .updraftcentral_site_row[data-site_id="'+r+'"'),f(o).data("last_time_began",(new Date).getTime()),UpdraftCentral.send_site_rpc("updraftplus.downloader",i,e,function(t,e,a){"ok"!=e&&(f(o+" .raw").html(udclion.updraftplus.backup_start_failed),console.log("code="+e+", error_code="+a),console.log(t))}))),a.hasOwnProperty("m")&&null!=a.m&&(a.p<100?f(o+" .raw").html(a.m):(msg=template_replace("updraftplus-downloaded",{file_ready:udclion.updraftplus.file_ready,download_to_computer:udclion.updraftplus.download_to_computer,and_then:udclion.updraftplus.and_then,you_should:udclion.updraftplus.you_should,backup_timestamp:d,site_id:r,what:s,findex:n,delete_from_server:udclion.updraftplus.delete_from_server}),f(o).data("updraft_finished",!0),f(o+" .raw").html(msg)))):null!=a.m?f(o+" .raw").html(a.m):f(o+" .raw").html(udclion.updraftplus.backup_start_failed))})}),this.backupnow_go=function(t,e,a,r,n,d,s,i){var o;n&&n.hasOwnProperty("_listener_title")&&(o=n._listener_title,delete n._listener_title);d={backupnow_nodb:t,backupnow_nofiles:e,backupnow_nocloud:a,backupnow_label:d,extradata:n};""!=r&&(d.onlythisfileentity=r),""!=s&&(d.onlythesetableentities=s),""!=i&&(d.onlythesecloudservices=i),d.always_keep=void 0!==n.always_keep?n.always_keep:0,d.incremental=void 0!==n.incremental?n.incremental:0,UpdraftCentral.send_site_rpc("updraftplus.backupnow",d,UpdraftCentral.$site_row,function(t,e,a){var r;"ok"==e&&!1!==t&&t.hasOwnProperty("data")&&(t.data.hasOwnProperty("nonce")?(r='<div class="backup_state">'+udclion.updraftplus.backupstarted+"</div>",e=t.data.nonce,u[e]=0,UpdraftCentral.create_dashboard_listener("updraftplus_backup",UpdraftCentral.$site_row,r,{job_id:t.data.nonce},o)):UpdraftCentral.add_dashboard_notice("<h2>"+UpdraftCentral.$site_row.data("site_description")+"</h2>"+udclion.updraftplus.backup_start_failed,"error"))})};var h=0,g=0;function n(c){c.find(".updraftcentral_row_extracontents").css("opacity","0.3"),UpdraftCentral.send_site_rpc("updraftplus.get_settings",{include_database_decrypter:0,include_adverts:0,include_save_button:1},c,function(r,t,e){if(c.find(".updraftcentral_row_extracontents").css("opacity","1.0"),"ok"==t&&r){if(c.find(".updraftcentral_row_extracontents").html('<div class="updraft_site_settings_output"><button class="btn btn-refresh updraftcentral_site_backup_settings"><span class="dashicons dashicons-image-rotate "></span></button>'+UpdraftCentral_Library.sanitize_html(r.data.settings)+"</div>"),r.data.hasOwnProperty("remote_storage_templates")&&r.data.hasOwnProperty("remote_storage_options")){var a,n="";for(a in r.data.remote_storage_templates)if(void 0!==r.data.remote_storage_options[a]){var d,s,o=Handlebars.compile(r.data.remote_storage_templates[a]),u=!0;for(d in r.data.remote_storage_options[a])"default"!==d&&(void 0===(s=r.data.remote_storage_options[a][d]).instance_conditional_logic&&(s.instance_conditional_logic={type:"",rules:[]}),s.instance_conditional_logic.day_of_the_week_options=udclion.updraftplus.conditional_logic.day_of_the_week_options,s.instance_conditional_logic.logic_options=udclion.updraftplus.conditional_logic.logic_options,s.instance_conditional_logic.operand_options=udclion.updraftplus.conditional_logic.operand_options,s.instance_conditional_logic.operator_options=udclion.updraftplus.conditional_logic.operator_options,s.first_instance=u,void 0===s.instance_enabled&&(s.instance_enabled=1),n+=o(s),u=!1)}else n+=r.data.remote_storage_templates[a];f("#remote-storage-holder").append(n)}function l(t){var e=Handlebars.compile(r.data.remote_storage_templates[t]),a=r.data.remote_storage_options[t].default;a.instance_id="s-"+function(t){for(var e="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<t;r++)e+=a.charAt(Math.floor(Math.random()*a.length));return e}(32),a.instance_enabled=1,a.instance_conditional_logic={type:"",rules:[],day_of_the_week_options:udclion.updraftplus.conditional_logic.day_of_the_week_options,logic_options:udclion.updraftplus.conditional_logic.logic_options,operand_options:udclion.updraftplus.conditional_logic.operand_options,operator_options:udclion.updraftplus.conditional_logic.operator_options};a=e(a);f(a).hide().insertAfter("."+t+"_add_instance_container:first").show("slow")}var p;f(".updraftcentral_row_extracontents #remote-storage-holder").on("click",".updraftplusmethod a.updraft_add_instance",function(t){t.preventDefault(),l(f(this).data("method"))}),f(".updraftcentral_row_extracontents #remote-storage-holder").on("click",".updraftplusmethod a.updraft_delete_instance",function(t){t.preventDefault();var e=f(this).data("method"),t=f(this).data("instance_id");1===f("."+e+"_updraft_remote_storage_border").length&&l(e),f("."+e+"-"+t).hide("slow",function(){f(this).remove()})}),f(".updraftcentral_row_extracontents #remote-storage-holder").on("change","input[class='updraft_instance_toggle']",function(){f(this).is(":checked")?f(this).siblings("label").html(udclion.updraftplus.instance_enabled):f(this).siblings("label").html(udclion.updraftplus.instance_disabled)}),jQuery(".updraftcentral_row_extracontents #remote-storage-holder").on("change","select[class='logic_type']",function(){updraft_settings_form_changed=!0,""!==this.value?(jQuery("div.logic",jQuery(this).parents("tr.updraftplusmethod")).show(),jQuery(this).parents("tr.updraftplusmethod").find("div.logic ul.rules > li").each(function(){jQuery(this).find("select").each(function(){jQuery(this).prop("disabled",!1)})})):(jQuery(this).parents("tr.updraftplusmethod").find("div.logic ul.rules > li").each(function(){jQuery(this).find("select").each(function(){jQuery(this).prop("disabled",!0)})}),jQuery(this).parents("tr.updraftplusmethod").find("div.logic").hide())}),jQuery(".updraftcentral_row_extracontents #remote-storage-holder").on("change","select[class='conditional_logic_operand']",function(){if(updraft_settings_form_changed=!0,jQuery(this).parent().find("select:nth(2)").empty(),"day_of_the_week"===jQuery(this).val())for(i=0;i<udclion.updraftplus.conditional_logic.day_of_the_week_options.length;i++)jQuery(this).parent().find("select:nth(2)").append(jQuery('<option value="'+udclion.updraftplus.conditional_logic.day_of_the_week_options[i].index+'"></option>').text(udclion.updraftplus.conditional_logic.day_of_the_week_options[i].value));else if("day_of_the_month"===jQuery(this).val())for(i=1;i<=31;i++)jQuery(this).parent().find("select:nth(2)").append(jQuery('<option value="'+i+'"></option>').text(i))}),jQuery(".updraftcentral_row_extracontents #remote-storage-holder").on("click","div.conditional_remote_backup ul.rules li span",function(){updraft_settings_form_changed=!0;var t=jQuery(this).parents("ul.rules");jQuery(this).hasClass("remove-rule")&&jQuery(this).parent().slideUp(function(){jQuery(this).remove(),jQuery(t).find("> li").length<2&&jQuery("li:nth(0) span.remove-rule",t).remove()})}),jQuery(".updraftcentral_row_extracontents #remote-storage-holder").on("click","div.conditional_remote_backup input.add-new-rule",function(){var t=jQuery(this).parent().find("ul.rules");jQuery(t).find("> li").length<2&&jQuery(t).find("li:nth(0)").append('<span class="remove-rule"><svg viewbox="0 0 25 25"><line x1="6.5" y1="18.5" x2="18.5" y2="6.5" fill="none" stroke="#FF6347" stroke-width="3" vector-effect="non-scaling-stroke" ></line><line y1="6.5" x1="6.5" y2="18.5" x2="18.5" fill="none" stroke="#FF6347" stroke-width="3" vector-effect="non-scaling-stroke" ></line></svg></span>'),$cloned_item=jQuery(t).find("> li").last().clone(),jQuery($cloned_item).find("> select").each(function(){jQuery(this).prop("name",jQuery(this).prop("name").replace(/\[instance_conditional_logic\]\[rules\]\[[0-9]+\]/gi,"[instance_conditional_logic][rules]["+jQuery(t).data("rules")+"]"))}),jQuery(t).append($cloned_item),jQuery(t).data("rules",parseInt(jQuery(t).data("rules"))+1),jQuery($cloned_item).find('select[name*="[operand]"]').trigger("change")}),c.find('.updraftcentral_row_extracontents #remote-storage-container > input[type="checkbox"]').each(function(){var t=jQuery(this);t.attr("aria-label",udclion.updraftplus.backup_using+" "+t.val()+"?")}),k(),function(){D=0;var r=f("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .updraft_servicecheckbox:checked");f(r).each(function(t,e){var a=f(e).val();"updraft_servicecheckbox_none"!=f(e).attr("id")&&D++,f("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .remote-tab-"+a).show(),t==f(r).length-1&&O(a)}),0<D?f("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .updraftplusmethod.none").hide():(f("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .updraftplusmethod:not(.none)").hide(),f("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .updraftplusmethod.none").show());var t=f("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .updraft_servicecheckbox");"function"==typeof t.labelauty&&t.labelauty()}(),h=b=0,r.data.hasOwnProperty("meta")&&((p=r.data.meta).hasOwnProperty("retain_rules")&&p.retain_rules.hasOwnProperty("files")&&(_=p.retain_rules.files,t=p.retain_rules.db,y=v=0,f.each(_,function(t,e){C("files",e.after_howmany,e.after_period,e.every_howmany,e.every_period)}),f.each(t,function(t,e){C("db",e.after_howmany,e.after_period,e.every_howmany,e.every_period)})),p.hasOwnProperty("extra_dbs")&&f.each(p.extra_dbs,function(t,e){e.hasOwnProperty("host")&&m(e.host,e.user,e.name,e.pass,e.prefix)})),r.data.hasOwnProperty("updraftplus_version")&&(g=r.data.updraftplus_version),P("uploads"),P("others"),P("wpcore"),Q=f("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output #updraft_report_cell .updraft_reportbox").length+2,f("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output #updraft_include_more_paths input.updraft_include_more_path").each(function(t,e){e=f(e).data(void 0);h<e&&(h=e)}),f('#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output input[type="submit"]').removeClass().addClass("btn btn-primary-outline"),f("#updraftcentral_dashboard_existingsites .updraft_site_settings_output").on("change keyup paste",".updraft_webdav_settings",function(){var r=[],n="";f(".updraft_webdav_settings").each(function(t,e){var a,e=f(e).attr("id");e&&"updraft_webdav_settings_"==e.substring(0,24)?(a=e.substring(24),r[a]=this.value):e&&"updraft_webdav_"==e.substring(0,15)&&(a=e.substring(15),id_split=a.split("_"),a=id_split[0],n=id_split[1],void 0===r[n]&&(r[n]=[]),r[n][a]=this.value)});var t,e="@",a="/",d=":",s=":";for(n in r)(0<=r[n].host.indexOf("@")||""===r[n].host)&&(e=""),0<=r[n].host.indexOf("/")?f("#updraft_webdav_host_error").show():f("#updraft_webdav_host_error").hide(),0!=r[n].path.indexOf("/")&&""!==r[n].path||(a=""),""!==r[n].user&&""!==r[n].pass||(d=""),""!==r[n].host&&""!==r[n].port||(s=""),t=r[n].webdav+r[n].user+d+r[n].pass+e+encodeURIComponent(r[n].host)+s+r[n].port+a+r[n].path,masked_webdav_url=r[n].webdav+r[n].user+d+r[n].pass.replace(/./gi,"*")+e+encodeURIComponent(r[n].host)+s+r[n].port+a+r[n].path,""==n?f("#updraftcentral_dashboard .updraft_site_settings_output #updraft_webdav_settings_url").val(t):(f("#updraftcentral_dashboard .updraft_site_settings_output #updraft_webdav_url_"+n).val(t),f("#updraftcentral_dashboard .updraft_site_settings_output #updraft_webdav_masked_url_"+n).val(masked_webdav_url))})}var _})}var b=0;function m(t,e,a,r,n){b++,f(template_replace("updraftplus-settings-extra-db",{updraft_extra_dbs:b,remove:udclion.updraftplus.remove,backup_external_database:udclion.updraftplus.backup_external_database,host:udclion.updraftplus.host,database:udclion.updraftplus.database,username:udclion.updraftplus.username,password:udclion.updraftplus.password,table_prefix:udclion.updraftplus.table_prefix,backup_tables_with_prefixes:udclion.updraftplus.backup_tables_with_prefixes,test_connection:udclion.updraftplus.test_connection},{host_attr:t,user_attr:e,name_attr:a,pass_attr:r,prefix_attr:n})).appendTo(f("#updraft_backupextradbs")).fadeIn()}function a(){UpdraftCentral.register_row_clicker(".row_backupnow, .updraftcentral_site_backup_now",function(t){e(t,"new")}),UpdraftCentral.register_row_clicker(".row_backupnow, .updraftcentral_site_backup_now_increment",function(t){e(t,"incremental")}),UpdraftCentral.register_modal_listener("#backupnow_includefiles_showmoreoptions",function(t){t.preventDefault(),f("#updraftcentral_modal #backupnow_includefiles_moreoptions").slideToggle()}),UpdraftCentral.register_modal_listener("#backupnow_database_showmoreoptions",function(t){t.preventDefault(),f("#updraftcentral_modal #backupnow_database_moreoptions").slideToggle()}),UpdraftCentral.register_modal_listener("#backupnow_includecloud_showmoreoptions",function(t){t.preventDefault(),f("#updraftcentral_modal #backupnow_includecloud_moreoptions").slideToggle()})}function _(n){n.find(".updraftcentral_row_extracontents").css("opacity","0.3");var t=navigator.userAgent.match(/Opera|OPR\//)?1:0;UpdraftCentral.send_site_rpc("updraftplus.get_fragment",{fragment:"panel_download_and_restore",data:{include_opera_warning:t,include_uploader:0,will_immediately_calculate_disk_space:0,include_header:1}},n,function(t,e,a){var r;n.find(".updraftcentral_row_extracontents").css("opacity","1.0"),"ok"==e&&t&&(n.find(".updraftcentral_row_extracontents").html('<div class="updraft_existing_backups_output"><button class="btn btn-refresh updraftcentral_site_backups_manage"><span class="dashicons dashicons-image-rotate" ></span></button>'+UpdraftCentral_Library.sanitize_html(t.data.output)+"</div>"),d(n),o.count()&&(r=setInterval(function(){if(f("table.existing-backups-table").length)switch(clearInterval(r),p){case"single":var t=o.get_items();o.clear(),t.length&&f('tr.updraft_existing_backups_row[data-nonce="'+t[0]+'"]').find("a.updraft-delete-link").trigger("click");break;case"multiple":t=l.get_items();if(l.clear(),o.clear(),t.length){for(var e=0;e<t.length;e++)f('tr.updraft_existing_backups_row[data-nonce="'+t[e]+'"]').find("input.delete_backup_item").prop("checked",!0);f("button#btn-backup-bulk-delete").trigger("click")}}},1e3)))})}function e(t,l){UpdraftCentral.send_site_rpc("updraftplus.get_fragment","backupnow_modal_contents",t,function(t,e,a){var r,n;"ok"==e&&t&&(e=!(t.data.output.hasOwnProperty("error")&&t.data.output.error)&&udclion.updraftplus.backupnow,n=!1,t.data.output.hasOwnProperty("backupnow_file_entities")&&(r=t.data.output.backupnow_file_entities),t.data.output.hasOwnProperty("incremental_installed")&&(n=t.data.output.incremental_installed),UpdraftCentral.open_modal(udclion.updraftplus.backupnow,t.data.output.html,function(){var t=f("#updraftcentral_modal #backupnow_includedb").is(":checked")?0:1,e=f("#updraftcentral_modal #backupnow_includefiles").is(":checked")?0:1,a=f("#updraftcentral_modal #backupnow_includecloud").is(":checked")?0:1,r="incremental"==l?1:0,n="";f('#updraftcentral_modal #backupnow_includefiles_moreoptions input[type="checkbox"]').each(function(t){var e;!f(this).is(":checked")||"updraft_include_"==(e=f(this).attr("name")).substring(0,16)&&(e=e.substring(16),""!=n&&(n+=","),n+=e)});var d="",s=!1;f('#backupnow_database_moreoptions input[type="checkbox"]').each(function(t){f(this).is(":checked")||(s=!0)});var d=!s||jQuery("input[name^='updraft_include_tables_']").serializeArray(),i=!1,o="";jQuery('#backupnow_includecloud_moreoptions input[type="checkbox"]').each(function(t){jQuery(this).is(":checked")||(i=!0)});var o=!i||jQuery("input[name^='updraft_include_remote_service_']").serializeArray(),u=f("#always_keep").is(":checked")?1:0;if(""!=n||0!=e)if(""!=d||0!=t){if(""==o&&0==a)return alert(udclion.updraftplus.nocloudserviceschosen),void jQuery("#backupnow_includecloud_moreoptions").show();s||(d=null),i||(o=null),t&&e?UpdraftCentral_Library.dialog.alert(udclion.updraftplus.excludedeverything):(UpdraftCentral.close_modal(),UpdraftCentral_Module_UpdraftPlus.backupnow_go(t,e,a,n,{always_keep:u,incremental:r},f("#updraftcentral_modal #backupnow_label").val(),d,o))}else UpdraftCentral_Library.dialog.alert(udclion.updraftplus.notableschosen);else UpdraftCentral_Library.dialog.alert(udclion.updraftplus.nofileschosen)},e,function(){n||"incremental"!=l?jQuery("#updraftcentral_modal .incremental-backups-only").hide():(jQuery("#updraftcentral_modal .incremental-free-only").show(),l="new"),f("#updraftcentral_modal #backupnow_label").val(""),"incremental"==l?(c(!0,r),f("#updraftcentral_modal #backupnow_includedb").prop("checked",!1),f("#updraftcentral_modal #backupnow_includefiles").prop("checked",!0),f("#updraftcentral_modal #backupnow_includefiles_label").text(udclion.updraftplus.files_incremental_backup),f("#updraftcentral_modal .new-backups-only").hide(),f("#updraftcentral_modal .incremental-backups-only").show()):(c(!1,r),f("#updraftcentral_modal #backupnow_includedb").prop("checked",!0),f("#updraftcentral_modal #backupnow_includefiles_label").text(udclion.updraftplus.files_new_backup),f("#updraftcentral_modal .new-backups-only").show(),f("#updraftcentral_modal .incremental-backups-only").hide()),f("#updraftcentral_modal #backupnow_includefiles_moreoptions").hide(),f("#updraftcentral_modal #updraft_backupnow_gotosettings").contents().unwrap()},!0,"backup-now"))})}function c(t,e){t?jQuery(e).each(function(t,e){jQuery("#updraftcentral_modal #backupnow_files_updraft_include_"+e).prop("checked",!1),jQuery("#updraftcentral_modal #backupnow_files_updraft_include_"+e).prop("disabled",!0)}):jQuery('#updraftcentral_modal #backupnow_includefiles_moreoptions input[type="checkbox"]').each(function(t){var e=jQuery(this).attr("name");"updraft_include_"==e.substring(0,16)&&(e=e.substring(16),jQuery("#updraftcentral_modal #backupnow_files_updraft_include_"+e).prop("disabled",!1),jQuery(this).is(":checked")&&jQuery("#updraftcentral_modal #backupnow_files_updraft_include_"+e).prop("checked",!0))})}function w(t,e,a){var r=udclion.updraftplus.delete_areyousure_singular;-1<t.indexOf(",")&&(r=udclion.updraftplus.delete_areyousure_plural),UpdraftCentral.open_modal(udclion.updraftplus.deletebackupset,UpdraftCentral.template_replace("updraftplus-deletebackup",{nonce:e,timestamp:t,delete_question:r,also_delete_from_remote:udclion.updraftplus.also_delete_from_remote,deleting_please_allow_time:udclion.updraftplus.deleting_please_allow_time}),function(){var t=f("#updraft_delete_modal_contents").data("nonce").toString(),e=f("#updraft_delete_modal_contents").data("timestamp").toString(),a=0;f("#updraft_delete_modal_contents #updraft_delete_remote").is(":checked")&&(a=1),f("#updraftcentral_modal #updraft-delete-waitwarning").slideDown();var r=!!navigator.userAgent.match(/Opera|OPR\//);UpdraftCentral.send_site_rpc("updraftplus.deleteset",{backup_nonce:t,backup_timestamp:e,delete_remote:a,get_history_opts:{include_opera_warning:r,include_uploader:!1,will_immediately_calculate_disk_space:!1,include_header:!0}},UpdraftCentral.$site_row,function(t,e,a){f("#updraftcentral_modal #updraft-delete-waitwarning").slideUp(),"ok"!=e||!t||null!=(e=t.data).result&&("error"==e.result?UpdraftCentral_Library.dialog.alert("<h2>"+udclion.error+"</h2>"+e.message):"success"==e.result&&(_(UpdraftCentral.$site_row),UpdraftCentral.close_modal(),void 0===(t=e.message)&&(t=e.local_message+" "+e.backup_local,t+=", "+e.remote_message+" "+e.backup_remote,t+=", "+e.set_message+" "+e.backup_sets),UpdraftCentral_Library.dialog.alert("<h2>"+udclion.updraftplus.deleted+"</h2>"+t)))})},udclion.updraftplus.delete,function(){a?f("#updraft-delete-remote-section, #updraft_delete_remote").removeAttr("disabled").show():f("#updraft-delete-remote-section").remove()})}function k(){var t=0,e=f("#updraftcentral_dashboard_existingsites .updraft_site_settings_output .updraft_interval").val();"manual"==e?f("#updraftcentral_dashboard_existingsites .updraft_site_settings_output .updraft_files_timings").hide():f("#updraftcentral_dashboard_existingsites .updraft_site_settings_output .updraft_files_timings").show(),"weekly"==e||"fortnightly"==e||"monthly"==e?(r("updraft_startday_files",e),f("#updraftcentral_dashboard_existingsites .updraft_site_settings_output #updraft_startday_files").show()):(f("#updraftcentral_dashboard_existingsites .updraft_monthly_extra_words_updraft_startday_files").remove(),f("#updraftcentral_dashboard_existingsites .updraft_site_settings_output #updraft_startday_files").hide());var a=f("#updraftcentral_dashboard_existingsites .updraft_site_settings_output .updraft_interval_database").val();"manual"==a&&(t=1,f("#updraftcentral_dashboard_existingsites .updraft_site_settings_output .updraft_db_timings").hide()),"weekly"==a||"fortnightly"==a||"monthly"==a?(r("updraft_startday_db",a),f("#updraftcentral_dashboard_existingsites .updraft_site_settings_output #updraft_startday_db").show()):(f("#updraftcentral_dashboard_existingsites .updraft_monthly_extra_words_updraft_startday_db").remove(),f("#updraftcentral_dashboard_existingsites .updraft_site_settings_output #updraft_startday_db").hide()),a==e?(f("#updraftcentral_dashboard_existingsites .updraft_site_settings_output .updraft_db_timings").hide(),0==t?f("#updraftcentral_dashboard_existingsites .updraft_site_settings_output .updraft_same_schedules_message").show():f("#updraftcentral_dashboard_existingsites .updraft_site_settings_output .updraft_same_schedules_message").hide()):(f("#updraftcentral_dashboard_existingsites .updraft_site_settings_output .updraft_same_schedules_message").hide(),0==t&&f("#updraftcentral_dashboard_existingsites .updraft_site_settings_output .updraft_db_timings").show())}"notices"!=UpdraftCentral.get_dashboard_mode()&&a(),f("#updraftcentral_dashboard_existingsites").on("updraftcentral_dashboard_mode_set",function(t,e){e&&e.hasOwnProperty("new_mode")&&"notices"==e.new_mode||a()}),f("#updraftcentral_dashboard_existingsites").on("updraftcentral_dashboard_mode_set_backups",function(){UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_backupextradb_another",function(){m("","","","","")}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_backupextradbs .updraft_backupextradbs_row_delete",function(){f(this).parents(".updraft_backupextradbs_row").fadeOut("medium",function(){f(this).remove()})}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_backupextradbs .updraft_backupextradbs_row_testconnection",function(){var r=f(this).closest(".updraft_backupextradbs_row");r.find(".updraft_backupextradbs_testresultarea").html("<p><em>"+udclion.updraftplus.testing+"</em></p>");var t={row:r.attr("id"),host:r.find(".extradb_host").val(),user:r.find(".extradb_user").val(),pass:r.find(".extradb_pass").val(),name:r.find(".extradb_name").val(),prefix:r.find(".extradb_prefix").val()};UpdraftCentral.send_site_rpc("updraftplus.extradb_testconnection",t,UpdraftCentral.$site_row,function(t,e,a){"ok"==e&&t&&r.find(".updraft_backupextradbs_testresultarea").html(UpdraftCentral_Library.sanitize_html(t.data.m))},r)}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output .updraftplusmethod button.updraft-test-button",function(){var t=f(this),n=jQuery(this).data("instance_id"),d=t.data("method");!function(r,n){var t,e=r.closest(".updraftcentral_site_row"),a=r.data("method"),d=r.data("method_label"),s=r.data("instance_id");t=s?".updraftplusmethod."+a+"-"+s:".updraftplusmethod."+a;r.html(sprintf(udclion.updraftplus.testing_settings,d));var i={method:a};f("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output "+t+" input[data-updraft_settings_test], #updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .expertmode input[data-updraft_settings_test]").each(function(t,e){var a,r=f(e).data("updraft_settings_test"),n=f(e).attr("type");r&&(n||(console.log("UpdraftCentral: UpdraftPlus: settings test input item with no type found"),console.log(e),n="text"),a=null,"checkbox"==n?a=f(e).is(":checked")?1:0:"text"==n||"password"==n?a=f(e).val():(console.log("UpdraftCentral: UpdraftPlus: settings test input item with unrecognised type ("+n+") found"),console.log(e)),i[r]=a)}),f("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output "+t+" textarea[data-updraft_settings_test], #updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output "+t+" select[data-updraft_settings_test]").each(function(t,e){var a=f(e).data("updraft_settings_test");i[a]=f(e).val()}),"webdav"!==a||i.hasOwnProperty("url")&&null!==i.url||void 0!==(s=f('.updraftplusmethod.webdav input[name="updraft_webdav[settings]['+s+'][url]"]').val())&&s.length&&(i.url=s);UpdraftCentral.send_site_rpc("updraftplus.test_storage_settings",i,e,function(t,e,a){"ok"==e&&t&&(r.html(sprintf(udclion.updraftplus.test_settings,d)),void 0!==(n=void 0!==n&&0!=n?n.call(this,t,e,a,i):n)&&!1===n&&UpdraftCentral_Library.dialog.alert("<h2>"+sprintf(udclion.updraftplus.settings_test_result,d)+"</h2> "+t.data.output))},r.closest("td"))}(t,function(t,e,a,r){return"sftp"==d&&(void 0!==r&&r.hasOwnProperty("scp")&&r.scp?UpdraftCentral_Library.dialog.alert("<h2>"+sprintf(udclion.updraftplus.settings_test_result,"SCP")+"</h2> "+t.data.output):UpdraftCentral_Library.dialog.alert("<h2>"+sprintf(udclion.updraftplus.settings_test_result,"SFTP")+"</h2> "+t.data.output),t.hasOwnProperty("data")&&t.data&&t.data.hasOwnProperty("data")&&t.data.data&&void 0!==t.data.data.valid_md5_fingerprint&&f("#updraft_sftp_fingerprint_"+n).val(t.data.data.valid_md5_fingerprint),!0)})}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output #updraftplus-settings-save",function(n,d){var a=f(s+" input, "+s+" textarea, "+s+" select").serialize();f.each(f(s+" input[type=checkbox]").filter(function(t){return 0==f(this).prop("checked")}),function(t,e){a+="&"+f(e).attr("name")+"=0"}),spin_this=f(this).closest("td"),a+="&updraftplus_version="+g,UpdraftCentral.send_site_rpc("updraftplus.save_settings",a,n,function(t,e,a){var r;"ok"===e&&(r=t.data.backup_dir.writable,e=t.data.backup_dir.message,t.data.backup_dir.button_title,0==r?(f(s+"#updraft_writable_mess").html(e),f(s+".backupdirrow").show()):f(s+".backupdirrow").hide(),e=n.data("site_url"),f("#updraftcentral_notice_container .updraftplus_saved_settings").closest(".updraftcentral_notice").remove(),t=add_dashboard_notice("<h2>"+udclion.updraftplus.settings_saved+" - "+e+'</h2><div class="updraftplus_saved_settings" data-site_id="'+d+'">'+t.data.messages+"</div>","notice",!1),f("#updraft-central-content").animate({scrollTop:t.offset().top},1e3))},spin_this)}),UpdraftCentral.register_row_clicker(t+".backupdirrow a.updraft_backup_dir_reset",function(){f(s+"#updraft_dir").val("updraft")}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output .enableexpertmode",function(){f(".updraftcentral_row_extracontents .updraft_site_settings_output .expertmode").fadeIn(),f(".updraftcentral_row_extracontents .updraft_site_settings_output .enableexpertmode").off("click")}),UpdraftCentral.register_row_clicker(t+" a.updraft_authlink",function(t){var e,a=f(this).attr("href");void 0!==a&&(e=f(this).closest("td"),UpdraftCentral_Library.open_browser_at(t,{module:"direct_url",url:a},e))}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output .updraft_include_entity",function(){var t=f(this).data("toggle_exclude_field");t&&P(t,!1)},!1,"change"),UpdraftCentral.register_row_clicker(".updraft_existing_backups_output .updraft_existingbackup_date",function(t){var e=f(this).data("nonce"),a=f(this).data("timestamp");UpdraftCentral.send_site_rpc("updraftplus.rawbackup_history",{nonce:e,timestamp:a},UpdraftCentral.$site_row,function(t,e,a){"ok"==e&&!1!==t&&t.hasOwnProperty("data")&&t.data.hasOwnProperty("rawbackup")&&(UpdraftCentral.close_modal(),UpdraftCentral.open_modal(udclion.updraftplus.raw,t.data.rawbackup,!0,!1,null,!1,"modal-lg"))})},!1,"dblclick"),register_modal_listener("#always_keep_this_backup",function(t){var e=f(this).data("backup_key");UpdraftCentral.send_site_rpc("updraftplus.always_keep_this_backup",{backup_key:e,always_keep:f(this).is(":checked")?1:0},UpdraftCentral.$site_row,function(t,e,a){"ok"==e&&!1!==t&&t.hasOwnProperty("data")&&t.data.hasOwnProperty("rawbackup")&&(UpdraftCentral.close_modal(),UpdraftCentral.open_modal(udclion.updraftplus.raw,t.data.rawbackup,!0,!1))})},"change"),UpdraftCentral.register_row_clicker(".updraft_existing_backups_output .choose-components-button",function(e){var a=this,r=f(a).data("entities"),n=f(a).closest("td");r&&UpdraftCentral_Library.dialog.confirm("<h2>"+udclion.updraftplus.restore_backup+"</h2>"+udclion.updraftplus.pre_restore_message,function(t){t&&(UpdraftCentral_Library.open_browser_at(e,{module:"updraftplus",action:"initiate_restore",data:{entities:r,backup_timestamp:f(a).data("backup_timestamp"),showdata:f(a).data("showdata")}},n),o.add(f(a).data("backup_timestamp"),f(a).closest("tr.updraft_existing_backups_row").data("nonce")))})}),UpdraftCentral.register_row_clicker(".updraft_existing_backups_output .updraft_download_button",function(t){var e=t.data("site_id"),a=f(this).data("backup_timestamp"),r=f(this).data("what"),n=f(this).data("set_contents"),t=f(this).data("prettydate");f(this).closest("td");!function(u,t,e,a,l){a=(a="string"!=typeof a?a.toString():a).split(",");var p=f('#updraftcentral_notice_container .updraftcentral_listener_updraftplus_download[data-site_id="'+u+'"');0==p.length&&(p=!1);for(var r=0;r<a.length;r++){var n=a[r],d=u+"_"+t+"_"+e+"_"+n;if(f("."+d).length)return console.log("UDCentral: There already appears to be an active downloader for this entity (stid: "+d+")");UpdraftCentral.send_site_rpc("updraftplus.downloader",{type:e,timestamp:t,findex:n},UpdraftCentral.$site_row,function(t,e,a){var r,n,d,s,i,o;"ok"==e&&!1!==t&&t.hasOwnProperty("data")&&t.data.hasOwnProperty("result")?(r=t.data.result,n=(o=t.data.request).timestamp,d=o.type,s=parseInt(o.findex),e="."+(i=u+"_"+n+"_"+d+"_"+s),t="??",o=(new Date).getTime(),widgets_html=template_replace("updraftplus-downloader",{stid:i,download_verb:udclion.updraftplus.download_verb,what:d,itext:0==s?"":" ("+(s+1)+")",pretty_date:l||n,begun_looking:udclion.updraftplus.begun_looking,site_id:u,backup_timestamp:n,findex:s}),"downloaded"==r?t=template_replace("updraftplus-downloaded",{file_ready:udclion.updraftplus.file_ready,download_to_computer:udclion.updraftplus.download_to_computer,and_then:udclion.updraftplus.and_then,you_should:udclion.updraftplus.you_should,backup_timestamp:n,site_id:u,what:d,findex:s,delete_from_server:udclion.updraftplus.delete_from_server}):"needs_download"==r?t=udclion.updraftplus.needs_download:"download_failed"==r&&(t=udclion.updraftplus.download_failed),!1===p?p=UpdraftCentral.create_dashboard_listener("updraftplus_download",UpdraftCentral.$site_row,widgets_html):p.append(widgets_html),p.data("finished",!1),p.find(e).data("last_time_began",o),p.find(e+" .raw").html(t)):UpdraftCentral.add_dashboard_notice("<h2>"+UpdraftCentral.$site_row.data("site_description")+"</h2>"+udclion.updraftplus.download_start_failed,"error")})}}(e,a,r,n,t)}),UpdraftCentral.register_row_clicker(".updraft_existing_backups_output button.updraft-upload-link",function(t){f(this).hide();var e=f(this).data("nonce").toString(),a=f(this).data("key").toString();e?UpdraftCentral.send_site_rpc("updraftplus.upload_local_backup",{use_nonce:e,use_timestamp:a},UpdraftCentral.$site_row,function(t,e,a){"ok"==e&&!1!==t&&t.hasOwnProperty("data")&&(t.data.hasOwnProperty("nonce")?(e='<div class="backup_state">'+udclion.updraftplus.backupstarted+"</div>",UpdraftCentral.create_dashboard_listener("updraftplus_backup",UpdraftCentral.$site_row,e,{job_id:t.data.nonce},udclion.updraftplus.upload_backup)):UpdraftCentral.add_dashboard_notice("<h2>"+UpdraftCentral.$site_row.data("site_description")+"</h2>"+udclion.updraftplus.backup_start_failed,"error"))}):console.log("UDCentral: UpdraftPlus: A upload link was clicked, but the backup ID could not be found")}),UpdraftCentral.register_row_clicker(".updraft_existing_backups_output .updraft-delete-link",function(t){var e="0"!==(e=f(this).data("hasremote").toString()),a=f(this).data("nonce").toString(),r=f(this).data("key").toString();p="single",a?o.exists(r)?_(t):w(r,a,e):console.log("UDCentral: UpdraftPlus: A delete link was clicked, but the backup ID could not be found")}),UpdraftCentral.register_event_handler("click",".delete-backup-container input.delete_backup_item",function(t){0<f(".delete-backup-container input.delete_backup_item:checked").length?f("button#btn-backup-bulk-delete").removeClass("btn-secondary").addClass("btn-primary"):f("button#btn-backup-bulk-delete").removeClass("btn-primary").addClass("btn-secondary")}),UpdraftCentral.register_row_clicker(".updraft_existing_backups_output button#btn-backup-bulk-delete",function(t){var a,r=[],n=!1,d=!1;l.clear(),f(".delete-backup-container input.delete_backup_item:checked").each(function(){var t=f(this).closest("tr.updraft_existing_backups_row").find("a.updraft-delete-link"),e=t.data("key");void 0!==e&&e&&(r.push(e.toString()),a=t.data("nonce"),n=n||void 0!==t.data("hasremote")&&"0"!==t.data("hasremote"),o.exists(e)&&(d=!0),l.add(e,f(this).closest("tr.updraft_existing_backups_row").data("nonce")))}),p="multiple",r.length?d?_(t):w(r.join(),a,n):console.log("UDCentral: UpdraftPlus: The bulk delete button was clicked, but none of the backup IDs could be found")}),UpdraftCentral.register_row_clicker(".updraft_existing_backups_output a.updraft_diskspaceused_update",function(r){var t=this.closest("ul");UpdraftCentral.send_site_rpc("updraftplus.get_fragment",{fragment:"disk_usage",data:"updraft"},r,function(t,e,a){"ok"==e&&t&&r.find(".updraft_diskspaceused").html(UpdraftCentral_Library.sanitize_html(t.data.output))},t)}),UpdraftCentral.register_row_clicker(".updraft_existing_backups_output a.updraft_rescan_local",function(r){var t=this.closest("ul");r.find(".updraft_existing_backups").html('<div class="rescanning">'+udclion.updraftplus.rescanning+"</div>"),UpdraftCentral.send_site_rpc("updraftplus.rescan","rescan",r,function(t,e,a){"ok"==e&&t&&(r.find(".updraft_existing_backups").html(t.data.t),r.find(".updraft_existing_backups_output h2").html(t.data.n),d(r))},t)}),UpdraftCentral.register_row_clicker(".updraft_existing_backups_output a.updraft_rescan_remote",function(r){var t=this.closest("ul");r.find(".updraft_existing_backups").html('<div class="rescanning">'+udclion.updraftplus.rescanningremote+"</div>"),UpdraftCentral.send_site_rpc("updraftplus.rescan","remotescan",r,function(t,e,a){"ok"==e&&t&&(r.find(".updraft_existing_backups").html(t.data.t),r.find(".updraft_existing_backups_output h2").html(t.data.n),d(r))},t,90)}),UpdraftCentral.register_row_clicker(".updraftcentral_site_backups_manage",function(t){_(t)},!0),UpdraftCentral.register_row_clicker(".updraftcentral_site_backup_settings",function(t){n(t)},!0),UpdraftCentral.register_row_clicker(".updraft_site_settings_output select.updraft_interval, .updraft_site_settings_output select.updraft_interval_database",function(){k()},!1,"change"),UpdraftCentral.register_row_clicker(".updraft_authlink",function(r){var t=this.closest("ul"),e={remote_method:f(this).data("remote_method"),instance_id:f(this).data("instance_id")};UpdraftCentral.send_site_rpc("updraftplus.auth_remote_method",e,r,function(t,e,a){"ok"==e&&!1!==t&&("error"==(t=t.data).result?UpdraftCentral_Library.dialog.alert("<h2>"+udclion.error+"</h2>"+t.message):"success"==t.result&&n(r))},t)},!0),UpdraftCentral.register_row_clicker(".updraft_deauthlink",function(r){var t=this.closest("ul"),e={remote_method:f(this).data("remote_method"),instance_id:f(this).data("instance_id")};UpdraftCentral.send_site_rpc("updraftplus.deauth_remote_method",e,r,function(t,e,a){"ok"==e&&!1!==t&&("error"==(t=t.data).result?UpdraftCentral_Library.dialog.alert("<h2>"+udclion.error+"</h2>"+t.message):"success"==t.result&&n(r))},t)},!0),UpdraftCentral.register_row_clicker(".updraft_site_settings_output #updraft_retain_db_addnew",function(){C("db",12,604800,1,604800)}),UpdraftCentral.register_row_clicker(".updraft_site_settings_output #updraft_retain_files_addnew",function(){C("files",12,604800,1,604800)}),UpdraftCentral.register_row_clicker(".updraft_site_settings_output .updraft_retain_rules_delete, .updraft_site_settings_output .updraft_retain_rules_delete",function(){f(this).parent(".updraft_retain_rules").slideUp(function(){f(this).remove()})}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_report_cell .updraft_reportbox .updraft_reportbox_delete",function(){f(this).closest(".updraft_reportbox").fadeOut("medium",function(){f(this).remove()})}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_report_cell .updraft_report_another",function(){f("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output #updraft_report_cell .updraft_report_another_p").before(template_replace("updraftplus-settings-report-email",{index:Q,send_only_on_warnings:udclion.updraftplus.send_only_on_warnings,whole_backup:udclion.updraftplus.whole_backup,email_size_limits:udclion.updraftplus.email_size_limits,db_backup:udclion.updraftplus.db_backup})),f("#updraft_reportbox_"+Q).fadeIn(),Q++}),UpdraftCentral.register_event_handler("change",".updraft_report_wholebackup .updraft_report_checkbox",function(){var t=f(this).closest(".updraft_reportbox").find(".updraft_report_dbbackup");f(this).is(":checked")?t.removeClass("updraft_report_disabled").find(".updraft_report_checkbox").removeProp("disabled"):(t.find(".updraft_report_checkbox").prop("checked",!1),t.addClass("updraft_report_disabled").find(".updraft_report_checkbox").prop("disabled",!0))}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_include_more",function(){f("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output #updraft_include_more").is(":checked")?f("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output #updraft_include_more_options").slideDown():f("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output #updraft_include_more_options").slideUp()},!1,"change"),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_include_more_paths_another",function(){h++,f(template_replace("updraftplus-settings-more-paths",{index:h,enter_the_directory:udclion.updraftplus.enter_the_directory,remove:udclion.updraftplus.remove})).appendTo(f(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_include_more_paths")).slideDown()}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_include_more_options .updraftplus-morefiles-row-delete",function(){var t=f(this).closest(".updraftplus-morefiles-row");f(t).slideUp("medium",function(){f(this).remove()})}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output .updraft_servicecheckbox",function(){var t=f(this).attr("id");"updraft_servicecheckbox_"!=t.substring(0,24)||null!=(t=t.substring(24))&&""!=t&&(f(this).is(":checked")?(D++,f("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .remote-tab-"+t).fadeIn(),O(t)):(D--,f("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .remote-tab-"+t).hide(),1==f("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .remote-tab-"+t).data("active")&&O(f("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .remote-tab:visible").last().attr("name")))),D<=0?f("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .updraftplusmethod.none").fadeIn():f("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .updraftplusmethod.none").hide()},!1,"change"),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output .remote-tab",function(){O(f(this).attr("name"))}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output .updraft_servicecheckbox:not(.multi)",function(){var t=f(this).attr("value");f(this).is(":not(:checked)")?(f("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .updraftplusmethod."+t).hide(),f("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .updraftplusmethod.none").fadeIn()):f("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .updraft_servicecheckbox").not(this).prop("checked",!1)},!1,"change"),UpdraftCentral.register_row_clicker(t+"#updraftvault_settings_cell .updraftvault_backtostart",function(){f(s+"#updraftvault_settings_showoptions").slideUp(),f(s+"#updraftvault_settings_connect").slideUp(),f(s+"#updraftvault_settings_connected").slideUp(),f(s+"#updraftvault_settings_default").slideDown()}),UpdraftCentral.register_row_clicker(t+"#updraftvault_settings_connect input",function(t,e,a){13==a.which&&(f(s+"#updraftvault_connect_go").click(),a.preventDefault())},!1,"keypress"),UpdraftCentral.register_row_clicker(t+"#updraftvault_settings_cell #updraftvault_recountquota",function(){f(s+"#updraftvault_recountquota").html(udclion.updraftplus.counting),UpdraftCentral.send_site_rpc("updraftplus.vault_recountquota",{instance_id:f("#updraftvault_settings_connect").data("instance_id")},UpdraftCentral.$site_row,function(t,e,a){f(s+"#updraftvault_recountquota").html(udclion.updraftplus.update_quota_count),"ok"==e&&t&&t.hasOwnProperty("data")&&t.data.hasOwnProperty("html")&&(f(s+"#updraftvault_settings_connected").html(t.data.html),t.data.hasOwnProperty("connected")&&(t.data.connected?(f(s+"#updraftvault_settings_default").hide(),f(s+"#updraftvault_settings_connected").show()):(f(s+"#updraftvault_settings_connected").hide(),f(s+"#updraftvault_settings_default").show())))})}),UpdraftCentral.register_row_clicker(t+"#updraftvault_settings_cell #updraftvault_disconnect",function(){f(s+"#updraftvault_disconnect").html(udclion.updraftplus.disconnecting),UpdraftCentral.send_site_rpc("updraftplus.vault_disconnect",{instance_id:f("#updraftvault_settings_connect").data("instance_id")},UpdraftCentral.$site_row,function(t,e,a){f(s+"#updraftvault_disconnect").html(udclion.updraftplus.disconnect),"ok"==e&&t.hasOwnProperty("data")&&(f(s+"#updraftvault_disconnect").html(udclion.updraftplus.disconnect),t.data.hasOwnProperty("html")&&(f(s+"#updraftvault_settings_connected").html(t.data.html).slideUp(),f(s+"#updraftvault_settings_default").slideDown()))})}),UpdraftCentral.register_row_clicker(t+"#updraftvault_connect",function(){f(s+"#updraftvault_settings_default").slideUp(),f(s+"#updraftvault_settings_connect").slideDown()}),UpdraftCentral.register_row_clicker(t+"#updraftvault_showoptions",function(){f(s+"#updraftvault_settings_default").slideUp(),f(s+"#updraftvault_settings_showoptions").slideDown()}),UpdraftCentral.register_row_clicker(t+"#updraft_s3_newapiuser",function(r){var t=this.closest("td");UpdraftCentral.send_site_rpc("updraftplus.get_fragment",{fragment:"s3_new_api_user_form",data:null},r,function(t,e,a){"ok"==e&&t&&UpdraftCentral.open_modal(udclion.updraftplus.create_new_iam_user_and_bucket,t.data.output,function(){f("#updraftcentral_modal #updraft-s3newapiuser-results").empty();var t={adminaccesskey:f("#updraftcentral_modal #updraft_s3newapiuser_adminaccesskey").val(),adminsecret:f("#updraftcentral_modal #updraft_s3newapiuser_adminsecret").val(),newuser:f("#updraftcentral_modal #updraft_s3newapiuser_newuser").val(),bucket:f("#updraftcentral_modal #updraft_s3newapiuser_bucket").val(),region:f("#updraftcentral_modal #updraft_s3newapiuser_region").val(),useservercerts:f("#updraftcentral_modal #updraft_ssl_useservercerts").val(),disableverify:f("#updraftcentral_modal #updraft_ssl_disableverify").val(),nossl:f("#updraftcentral_modal #updraft_ssl_nossl").val(),allowdelete:f("#updraftcentral_modal #updraft_s3newapiuser_allowdelete").is(":checked")?1:0,allowdownload:f("#updraftcentral_modal #updraft_s3newapiuser_allowdownload").is(":checked")?1:0},e=f("#updraftcentral_modal");UpdraftCentral.send_site_rpc("updraftplus.s3_newuser",t,r,function(t,e,a){"ok"==e&&t&&(1==t.data.e?f("#updraftcentral_modal #updraft-s3newapiuser-results").html('<p style="color:red;">'+UpdraftCentral_Library.sanitize_html(t.data.m)+"</p>"):0==t.data.e&&(f("#updraftcentral_modal #updraft-s3newapiuser-results").html('<p style="color:green;">'+UpdraftCentral_Library.sanitize_html(t.data.m)+"</p>"),f(s+"#updraft_s3_apikey").val(t.data.k),f(s+"#updraft_s3_apisecret").val(t.data.s),f(s+"#updraft_s3_rrs").prop(":checked",t.data.r),f(s+"#updraft_s3_path").val(t.data.c),f(s+"#updraft_s3_newapiuser").html(udclion.updraftplus.now_using_iam),UpdraftCentral.close_modal()))},e)},udclion.updraftplus.create)},t)}),UpdraftCentral.register_row_clicker(t+"#updraft_cloudfiles_newapiuser",function(d){var t=this.closest("td");UpdraftCentral.send_site_rpc("updraftplus.get_fragment",{fragment:"cloudfiles_new_api_user_form",data:null},d,function(t,e,a){"ok"==e&&(t=UpdraftCentral.template_replace("updraftplus-cloudfiles_new_api_user",t.data.output),UpdraftCentral.open_modal(udclion.updraftplus.new_api_user,UpdraftCentral_Library.sanitize_html(t),function(){var t=f(this).closest(".modal-dialog").find(".form-table"),e={adminuser:t.find(".adminuser").val(),adminapikey:t.find(".adminapikey").val(),newuser:t.find(".newuser").val(),container:t.find(".container").val(),newemail:t.find(".newemail").val(),location:t.find(".location").val(),region:t.find(".region").val()},t=f(".modal-dialog");UpdraftCentral.send_site_rpc("updraftplus.cloudfiles_newuser",e,d,function(t,e,a){if("ok"==e){UpdraftCentral.close_modal();var r=t.data.u,n=t.data.k,e=t.data.c;d.find("#updraft_cloudfiles_user").val(r),d.find("#updraft_cloudfiles_apikey").val(n),d.find("#updraft_cloudfiles_path").val(e)}else if("error"===a)return UpdraftCentral_Library.dialog.alert("<h3>"+udclion.error+"</h3>"+t.m),!0},t)},udclion.updraftplus.create))},t)}),UpdraftCentral.register_row_clicker(t+"#updraftvault_connect_go",function(){f(s+"#updraftvault_connect_go").html(udclion.updraftplus.connecting);var t={email:f(s+"#updraftvault_email").val(),pass:f(s+"#updraftvault_pass").val(),instance_id:f(s+"#updraftvault_settings_connect").data("instance_id")};UpdraftCentral.send_site_rpc("updraftplus.vault_connect",t,UpdraftCentral.$site_row,function(t,e,a){f(s+"#updraftvault_connect_go").html(udclion.updraftplus.connect),"ok"==e&&t.hasOwnProperty("data")&&(t.data.hasOwnProperty("e")?(UpdraftCentral_Library.dialog.alert("<h2>"+udclion.error+"</h2><p>"+t.data.e+"</p>"),t.data.hasOwnProperty("code")&&"no_quota"==t.data.code&&(f(s+"#updraftvault_settings_connect").slideUp(),f(s+"#updraftvault_settings_default").slideDown())):t.data.hasOwnProperty("connected")&&t.data.connected&&t.data.hasOwnProperty("html")?(f(s+"#updraftvault_settings_connect").slideUp(),f(s+"#updraftvault_settings_connected").html(t.data.html).slideDown()):(console.log(t),UpdraftCentral_Library.dialog.alert("<h2>"+udclion.error+"</h2><p>"+udclion.js_exception_occurred+"</p>")))})})}),f("#updraftcentral_notice_container").on("click",".updraftplus_saved_settings a.updraft_authlink",function(t){var e,a,r=f(this).attr("href");void 0!==r&&(e=f(this).closest(".updraftplus_saved_settings").data("site_id"),(a=f('#updraftcentral_dashboard_existingsites .updraftcentral_site_row[data-site_id="'+e+'"')).length<1?console.log("UpdraftCentral: UpdraftPlus: site row not found for the link clicked (site_id="+e+")"):(t.preventDefault(),t=f(this).closest(".updraftplus_saved_settings"),UpdraftCentral_Library.open_browser_at(a,{module:"direct_url",url:r},t)))}),f("#updraftcentral_notice_container").on("click",".updraftcentral_listener .updraftplus_downloader_closebutton",function(t){t.preventDefault();t=f(this).closest(".updraftcentral_listener");f(this).closest(".updraftplus_downloader").fadeOut().remove(),t.find(".updraftplus_downloader").length<1&&(console.log(t),t.clearQueue().slideUp("slow",function(){f(this).remove()}))}),f("#updraftcentral_notice_container").on("click",".updraftcentral_listener .updraft_downloaded",function(t){var e,a,r=f(this).data("site_id"),n=f('#updraftcentral_dashboard_existingsites .updraftcentral_site_row[data-site_id="'+r+'"');n.length<1||(e=f(this).data("backup_timestamp"),a=f(this).data("what"),r=f(this).data("findex"),UpdraftCentral_Library.open_browser_at(n,{module:"updraftplus",action:"download_file",data:{backup_timestamp:e,what:a,findex:r}},null))}),f("#updraftcentral_notice_container").on("click",".updraftcentral_listener .updraft_delete_downloaded_backup",function(t){t.preventDefault();var r=this,e=f(this).data("site_id"),a=f('#updraftcentral_dashboard_existingsites .updraftcentral_site_row[data-site_id="'+e+'"'),n=f(this).data("findex"),d=f(this).data("what"),t=f(this).data("backup_timestamp");UpdraftCentral.send_site_rpc("updraftplus.delete_downloaded",{timestamp:t,site_id:e,type:d,findex:n},a,function(t,e,a){"ok"==e&&!1!==t&&t.hasOwnProperty("data")&&f(r).closest(".raw").html(udclion.updraftplus.entity_deleted)})}),f("#updraftcentral_notice_container, #updraftcentral_dashboard_existingsites").on("click",".updraftcentral_listener .updraft-log-link, .updraft_existing_backups_output .updraft-log-link",function(t){t.preventDefault();var r,e=f(this).data("jobid");e?(t=f(this).closest(".updraftcentral_listener, .updraftcentral_site_row").data("site_id"),t=f('#updraftcentral_dashboard_existingsites .updraftcentral_site_row[data-site_id="'+t+'"'),r=e,UpdraftCentral.send_site_rpc("updraftplus.get_log",r,t,function(t,e,a){"ok"==e&&t&&UpdraftCentral.open_modal(udclion.updraftplus.logfile,'<pre id="updraft_poppedlog">'+UpdraftCentral_Library.sanitize_html(t.data.log)+"</pre>",function(){UpdraftCentral_Library.download_inner_html("log."+r+".txt","updraft_poppedlog")},udclion.updraftplus.downloadlog,function(){},null,!0,"modal-lg")})):(console.log(this),console.log("UpdraftPlus: A log link was clicked, but the Job ID could not be found"))}),f("#updraftcentral_notice_container").on("click",".updraftcentral_listener .updraft_jobinfo_delete",function(t){t.preventDefault();var e,r,a=f(this).data("jobid");a?(t=(e=f(this).closest(".updraftcentral_listener")).data("site_id"),t=f('#updraftcentral_dashboard_existingsites .updraftcentral_site_row[data-site_id="'+t+'"'),r=e,UpdraftCentral.send_site_rpc("updraftplus.activejobs_delete",a,t,function(t,e,a){"ok"==e&&t&&(e="",e=t.hasOwnProperty("data")&&t.data.hasOwnProperty("c")?"deleted"==t.data.c?udclion.updraftplus.delete_deleted:"not_found"==t.data.c?udclion.updraftplus.delete_not_found:(console.log("UDCentral: UpdraftPlus: abort job: unknown response"),console.log(t.data),UpdraftCentral_Library.sanitize_html(t.data.m)):(console.log("UDCentral: UpdraftPlus: abort job: unknown response"),console.log(t.data),udclion.js_exception_occurred),f(r).find(".backup_state:first").html(e))})):(console.log("UpdraftPlus: A stop job link was clicked, but the Job ID could not be found"),console.log(this))});var v,y,x=!1,U=!1;function r(t,e){var a="#updraftcentral_dashboard_existingsites .updraft_site_settings_output #"+t,r="monthly"==e,n=!1;10<f(a+" option").length&&(n=!0),(r||n)&&(r&&n?"monthly"==e&&(f("#updraftcentral_dashboard_existingsites .updraft_site_settings_output .updraft_monthly_extra_words_"+t).remove(),f(a).before('<span class="updraft_monthly_extra_words_'+t+'">'+udclion.updraftplus.day+" </span>").after('<span class="updraft_monthly_extra_words_'+t+'"> '+udclion.updraftplus.in_the_month+" </span>")):(f("#updraftcentral_dashboard_existingsites .updraft_site_settings_output .updraft_monthly_extra_words_"+t).remove(),r?(x=f(a+" option:selected").val(),f(a).html(udclion.updraftplus.mday_selector).before('<span class="updraft_monthly_extra_words_'+t+'">'+udclion.updraftplus.day+" </span>").after('<span class="updraft_monthly_extra_words_'+t+'"> '+udclion.updraftplus.in_the_month+" </span>"),t=!1===U?1:U,f(a+" option:eq("+(t-=1)+")").prop("selected",!0)):(U=f(a+" option:selected").val(),f(a).html(udclion.updraftplus.day_selector),f(a+" option:eq("+(!1===x?1:x)+")").prop("selected",!0))))}function C(t,e,a,r,n){var d="updraft_retain_"+t+"_rules",s="db"==t?++v:++y;f("#"+d).append('<div style="float:left; clear:left;" class="updraft_retain_rules '+d+'_entry">'+udclion.updraftplus.for_backups_older_than+" "+j(t,s,"after",e,a)+" keep no more than 1 backup every "+j(t,s,"every",r,n)+' <span title="'+udclion.updraftplus.delete+'" class="updraft_retain_rules_delete"><span class="dashicons dashicons-no"></span></span></div>')}function j(t,e,a,r,n){a="updraft_retain_extrarules["+t+"]["+e+"]["+a+"-",a='<input type="number" min="1" step="1" class="additional-rule-width" name="'+a+'howmany]" value="'+r+'"> \t\t<select name="'+a+'period]">\t\t<option value="3600"';return 3600==n&&(a+=' selected="selected"'),a+=">"+udclion.updraftplus.hours+'</option>\t\t<option value="86400"',86400==n&&(a+=' selected="selected"'),a+=">"+udclion.updraftplus.days+'</option>\t\t<option value="604800"',604800==n&&(a+=' selected="selected"'),a+=">"+udclion.updraftplus.weeks+"</option>\t\t</select>"}function P(t,e){f(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_include_"+t).is(":checked")?e?f(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_include_"+t+"_exclude").show():f(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_include_"+t+"_exclude").slideDown():e?f(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_include_"+t+"_exclude").hide():f(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_include_"+t+"_exclude").slideUp()}var Q=1;function O(t){var e="#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output";f(e+" .updraftplusmethod").hide(),f(e+" .remote-tab").data("active",!1),f(e+" .remote-tab").removeClass("nav-tab-active"),f(e+" .updraftplusmethod."+t).show(),f(e+" .remote-tab-"+t).data("active",!0),f(e+" .remote-tab-"+t).addClass("nav-tab-active")}var D=0}jQuery(function(t){UpdraftCentral_Module_UpdraftPlus=new UpdraftCentral_UpdraftPlus_Module,jQuery(document).keyup(function(t){32!==t.keyCode&&13!==t.keyCode||!jQuery(document.activeElement).is("input.labelauty + label")||(t=jQuery(document.activeElement).attr("for"))&&jQuery("#"+t).change()}),Handlebars.registerHelper("maskPassword",function(t){return t.replace(/./gi,"*")}),Handlebars.registerHelper("encodeURIComponent",function(t){return encodeURIComponent(t)}),Handlebars.registerHelper("ifCond",function(t,e,a,r){switch(e){case"==":return t==a?r.fn(this):r.inverse(this);case"===":return t===a?r.fn(this):r.inverse(this);case"!=":return t!=a?r.fn(this):r.inverse(this);case"!==":return t!==a?r.fn(this):r.inverse(this);case"<":return t<a?r.fn(this):r.inverse(this);case"<=":return t<=a?r.fn(this):r.inverse(this);case">":return a<t?r.fn(this):r.inverse(this);case">=":return a<=t?r.fn(this):r.inverse(this);case"&&":return t&&a?r.fn(this):r.inverse(this);case"||":return t||a?r.fn(this):r.inverse(this);case"typeof":return t===typeof a?r.fn(this):r.inverse(this);case"not_typeof":return t!==typeof a?r.fn(this):r.inverse(this);default:return r.inverse(this)}}),Handlebars.registerHelper("for",function(t,e,a,r){for(var n="",d=t;d<e;d+=a)n+=r.fn(d);return n}),Handlebars.registerHelper("set_var",function(t,e,a){a.data.root||(a.data.root={}),a.data.root[t]=e}),Handlebars.registerHelper("get_length",function(t){return void 0!==t&&!1==t instanceof Array?Object.keys(t).length:!0==t instanceof Array?t.length:0})});