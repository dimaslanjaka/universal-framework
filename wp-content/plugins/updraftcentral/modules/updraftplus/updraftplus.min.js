function UpdraftCentral_UpdraftPlus_Module(){var h=jQuery,t=".updraftcentral_row_extracontents .updraft_site_settings_output ",s="#updraftcentral_dashboard_existingsites "+t,u={},o=new UpdraftCentral_Collection,l=new UpdraftCentral_Collection,_="single";function d(t){var a=[],e=(t.find("tr.updraft_existing_backups_row").each(function(){var t=h(this).data("key"),e=h(this).find("button.updraft_download_button");e.length&&(e=e[0].closest("td"),-1===h.inArray(t,a)&&(a.push(t),h(e).prepend('<a class="show-backup-data" data-key="'+t+'"><span class="dashicons dashicons-arrow-right"></span> '+udclion.updraftplus.select_backup_data+"</a>"),h(e).find("button.updraft_download_button").wrapAll('<span class="backup-data-'+t+' hide-backup-data"></span>')))}),UpdraftCentral.register_event_handler("click","a.show-backup-data",function(){var t=h(this).data("key");h(this).find("span.dashicons").toggleClass("dashicons-arrow-right dashicons-arrow-down"),h(this).parent().find(".backup-label-container-"+t).toggleClass("hide-backup-data"),h(this).parent().find(".backup-data-"+t).toggleClass("hide-backup-data")}),t.find(".updraftcentral_row_extracontents div.backup_date_label"));e.length||(t.find(".updraftcentral_row_extracontents td.updraft_existingbackup_date").each(function(){h(this).wrapInner('<div class="backup_date_label"></div>')}),e=t.find(".updraftcentral_row_extracontents div.backup_date_label")),e.length&&(e.prepend('<div class="delete-backup-container"><input type="checkbox" class="delete_backup_item" name="delete_backup" value="1" /></div>'),t.find(".updraftcentral_row_extracontents div.updraft_existing_backups").append('<button id="btn-backup-bulk-delete" class="btn btn-secondary">'+udclion.updraftplus.delete_selected+"</button>")),($table=function(t,e,a){var t=t.find(".updraftcentral_row_extracontents table.existing-backups-table"),r=t.find("thead th.backup-date"),n=t.find("tbody td.updraft_existingbackup_date");void 0!==a&&a&&n.next("td").attr("class","updraft_existingbackup_data");return h('<th class="backup-'+e+'">'+udclion.updraftplus.backup+" "+e+"</th>").insertAfter(r),h('<td class="updraft_existingbackup_'+e+'"></td>').insertAfter(n),t}(t,"storage",!0)).find("tr.updraft_existing_backups_row").each(function(){var t=h(this);t.find(".backup_date_label img.stored_icon").each(function(){h(this).appendTo(t.find("td.updraft_existingbackup_storage"))})}),t.find(".updraftcentral_row_extracontents table.existing-backups-table").find("tr.updraft_existing_backups_row").each(function(){var t=h(this),e=t.find("td.updraft_existingbackup_data a.show-backup-data"),a="backup-label-container-"+e.data("key");h('<div class="'+a+' hide-backup-data"></div>').insertAfter(e),t.find(".backup_date_label br").wrap("<span></span>"),t.find(".backup_date_label .clear-right ~ span").appendTo(t.find("div."+a))})}UpdraftCentral.register_listener_processor("updraftplus_backup",function(t,e,a){return 0<h(t).find(".updraft_finished").length?(1<UpdraftCentral.get_debug_level()&&console.log("UDCentral: UpdraftPlus backup listener: job finished"),0):(t=h(t).data("job_id"),u.hasOwnProperty(t)||(u[t]=0),u[t]++,u[t]<30||0==u[t]%3?{call:"updraftplus.backup_progress",data:{job_id:t}}:null)}),UpdraftCentral.register_listener_processor("updraftplus.backup_progress",function(t,e,a,r){var n="";r.hasOwnProperty("l")&&(n+="<strong>"+udclion.updraftplus.lastlogline+":</strong> "+r.l+"<br>"),r.hasOwnProperty("j")&&(n+=r.j),h(t).find(".backup_state:first").html(UpdraftCentral_Library.sanitize_html(n)),r="<div class='text-center' id='info"+a+"'>"+("undefined"===jQuery.type(h(t).find(".updraft_percentage").data("info"))?udclion.updraftplus.missing_data_attributes:UpdraftCentral_Library.sanitize_html(h(t).find(".updraft_percentage").data("info")))+"</div>",r+="<progress class='progress progress-updraftcentral' value='"+("undefined"===jQuery.type(h(t).find(".updraft_percentage").data("progress"))?"0":UpdraftCentral_Library.quote_attribute(h(t).find(".updraft_percentage").data("progress")))+"' max='100' ></progress>",h(t).find(".curstage").html(r)}),UpdraftCentral.register_listener_processor("updraftplus_download",function(t,e,n){var d=[],s=null;return h(t).find(".updraftplus_downloader").each(function(t,e){h(e).data("updraft_finished")?null===s&&(s=!0):s=!1;var a=h(e).data("findex"),r=h(e).data("what"),e=h(e).data("backup_timestamp");d.push(n+","+e+","+r+","+a)}),s?(console.log("UDCentral: UpdraftPlus download listener: job finished - will not poll any more"),1):{call:"updraftplus.get_download_status",data:d}}),UpdraftCentral.register_listener_processor("updraftplus.get_download_status",function(t,e,a,r){h.each(r,function(t,e){var a,r,n,d,s,i,o;e.hasOwnProperty("base")&&(r=(e=e).base,e.f,n=e.findex,e.m,e.hasOwnProperty("p")&&e.p,e.s,e.t,d=e.timestamp,s=e.what,o="#updraftcentral_notice_container ."+(i=r+"_"+d+"_"+s+"_"+n),e.hasOwnProperty("failed")&&e.failed&&h(o).data("updraft_finished",!0),e.hasOwnProperty("e")&&e.e?(h(o+" .raw").html("<strong>"+udclion.error+":</strong> "+e.e),console.log("UDCentral: UpdraftPlus: downloader ("+i+"): an error was returned (follows)"),console.log(e)):null!==e.p?(h(o+"_st .dlfileprogress").width(e.p+"%"),null!=e.a&&0<e.a&&(a=(new Date).getTime()-h(o).data("last_time_began"),90<e.a&&6e4<a&&(console.log("UDCentral: UpdraftPlus: "+i+": restarting download: file_age="+e.a+", since_last_restart_ms="+a),i={type:s,timestamp:d,findex:n},a=h('#updraftcentral_dashboard_existingsites .updraftcentral_site_row[data-site_id="'+r+'"'),h(o).data("last_time_began",(new Date).getTime()),UpdraftCentral.send_site_rpc("updraftplus.downloader",i,a,function(t,e,a){"ok"!=e&&(h(o+" .raw").html(udclion.updraftplus.backup_start_failed),console.log("code="+e+", error_code="+a),console.log(t))}))),e.hasOwnProperty("m")&&null!=e.m&&(e.p<100?h(o+" .raw").html(e.m):(msg=template_replace("updraftplus-downloaded",{file_ready:udclion.updraftplus.file_ready,download_to_computer:udclion.updraftplus.download_to_computer,and_then:udclion.updraftplus.and_then,you_should:udclion.updraftplus.you_should,backup_timestamp:d,site_id:r,what:s,findex:n,delete_from_server:udclion.updraftplus.delete_from_server}),h(o).data("updraft_finished",!0),h(o+" .raw").html(msg)))):null!=e.m?h(o+" .raw").html(e.m):h(o+" .raw").html(udclion.updraftplus.backup_start_failed))})}),this.backupnow_go=function(t,e,a,r,n,d,s,i){n&&n.hasOwnProperty("_listener_title")&&(o=n._listener_title,delete n._listener_title);var o,t={backupnow_nodb:t,backupnow_nofiles:e,backupnow_nocloud:a,backupnow_label:d,extradata:n};""!=r&&(t.onlythisfileentity=r),""!=s&&(t.onlythesetableentities=s),""!=i&&(t.onlythesecloudservices=i),t.always_keep=void 0!==n.always_keep?n.always_keep:0,t.incremental=void 0!==n.incremental?n.incremental:0,UpdraftCentral.send_site_rpc("updraftplus.backupnow",t,UpdraftCentral.$site_row,function(t,e,a){var r;"ok"==e&&!1!==t&&t.hasOwnProperty("data")&&(t.data.hasOwnProperty("nonce")?(e='<div class="backup_state">'+udclion.updraftplus.backupstarted+"</div>",r=t.data.nonce,u[r]=0,UpdraftCentral.create_dashboard_listener("updraftplus_backup",UpdraftCentral.$site_row,e,{job_id:t.data.nonce},o)):UpdraftCentral.add_dashboard_notice("<h2>"+UpdraftCentral.$site_row.data("site_description")+"</h2>"+udclion.updraftplus.backup_start_failed,"error"))})};var g=0,w=0;function n(f){f.find(".updraftcentral_row_extracontents").css("opacity","0.3"),UpdraftCentral.send_site_rpc("updraftplus.get_settings",{include_database_decrypter:0,include_adverts:0,include_save_button:1},f,function(r,t,p){if(f.find(".updraftcentral_row_extracontents").css("opacity","1.0"),"ok"==t&&r){if(f.find(".updraftcentral_row_extracontents").html('<div class="updraft_site_settings_output"><button class="btn btn-refresh updraftcentral_site_backup_settings"><span class="dashicons dashicons-image-rotate "></span></button>'+UpdraftCentral_Library.sanitize_html(r.data.settings)+"</div>"),r.data.hasOwnProperty("remote_storage_templates")&&r.data.hasOwnProperty("remote_storage_options")){var e,a="";for(e in r.data.remote_storage_templates)if(void 0!==r.data.remote_storage_options[e]){var n,d,_=Handlebars.compile(r.data.remote_storage_templates[e]),s=!0;for(n in r.data.remote_storage_options[e])"default"!==n&&(void 0===(d=r.data.remote_storage_options[e][n]).instance_conditional_logic&&(d.instance_conditional_logic={type:"",rules:[]}),d.instance_conditional_logic.day_of_the_week_options=udclion.updraftplus.conditional_logic.day_of_the_week_options,d.instance_conditional_logic.logic_options=udclion.updraftplus.conditional_logic.logic_options,d.instance_conditional_logic.operand_options=udclion.updraftplus.conditional_logic.operand_options,d.instance_conditional_logic.operator_options=udclion.updraftplus.conditional_logic.operator_options,d.first_instance=s,void 0===d.instance_enabled&&(d.instance_enabled=1),a+=_(d),s=!1)}else a+=r.data.remote_storage_templates[e];h("#remote-storage-holder").append(a)}function o(t){var e=Handlebars.compile(r.data.remote_storage_templates[t]),a=r.data.remote_storage_options[t].default,e=(a.instance_id="s-"+function(t){for(var e="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<t;r++)e+=a.charAt(Math.floor(Math.random()*a.length));return e}(32),a.instance_enabled=1,a.instance_conditional_logic={type:"",rules:[],day_of_the_week_options:udclion.updraftplus.conditional_logic.day_of_the_week_options,logic_options:udclion.updraftplus.conditional_logic.logic_options,operand_options:udclion.updraftplus.conditional_logic.operand_options,operator_options:udclion.updraftplus.conditional_logic.operator_options},e(a));h(e).hide().insertAfter("."+t+"_add_instance_container:first").show("slow")}h(".updraftcentral_row_extracontents #remote-storage-holder").on("click",".updraftplusmethod a.updraft_add_instance",function(t){t.preventDefault(),o(h(this).data("method"))}),h(".updraftcentral_row_extracontents #remote-storage-holder").on("click",".updraftplusmethod a.updraft_delete_instance",function(t){t.preventDefault();var t=h(this).data("method"),e=h(this).data("instance_id");1===h("."+t+"_updraft_remote_storage_border").length&&o(t),h("."+t+"-"+e).hide("slow",function(){h(this).remove()})}),h(".updraftcentral_row_extracontents #remote-storage-holder").on("change","input[class='updraft_instance_toggle']",function(){h(this).is(":checked")?h(this).siblings("label").html(udclion.updraftplus.instance_enabled):h(this).siblings("label").html(udclion.updraftplus.instance_disabled)}),jQuery(".updraftcentral_row_extracontents #remote-storage-holder").on("change","select[class='logic_type']",function(){updraft_settings_form_changed=!0,""!==this.value?(jQuery("div.logic",jQuery(this).parents("tr.updraftplusmethod")).show(),jQuery(this).parents("tr.updraftplusmethod").find("div.logic ul.rules > li").each(function(){jQuery(this).find("select").each(function(){jQuery(this).prop("disabled",!1)})})):(jQuery(this).parents("tr.updraftplusmethod").find("div.logic ul.rules > li").each(function(){jQuery(this).find("select").each(function(){jQuery(this).prop("disabled",!0)})}),jQuery(this).parents("tr.updraftplusmethod").find("div.logic").hide())}),jQuery(".updraftcentral_row_extracontents #remote-storage-holder").on("change","select[class='conditional_logic_operand']",function(){if(updraft_settings_form_changed=!0,jQuery(this).parent().find("select:nth(2)").empty(),"day_of_the_week"===jQuery(this).val())for(i=0;i<udclion.updraftplus.conditional_logic.day_of_the_week_options.length;i++)jQuery(this).parent().find("select:nth(2)").append(jQuery('<option value="'+udclion.updraftplus.conditional_logic.day_of_the_week_options[i].index+'"></option>').text(udclion.updraftplus.conditional_logic.day_of_the_week_options[i].value));else if("day_of_the_month"===jQuery(this).val())for(i=1;i<=31;i++)jQuery(this).parent().find("select:nth(2)").append(jQuery('<option value="'+i+'"></option>').text(i))}),jQuery(".updraftcentral_row_extracontents #remote-storage-holder").on("click","div.conditional_remote_backup ul.rules li span",function(){updraft_settings_form_changed=!0;var t=jQuery(this).parents("ul.rules");jQuery(this).hasClass("remove-rule")&&jQuery(this).parent().slideUp(function(){jQuery(this).remove(),jQuery(t).find("> li").length<2&&jQuery("li:nth(0) span.remove-rule",t).remove()})}),jQuery(".updraftcentral_row_extracontents #remote-storage-holder").on("click","div.conditional_remote_backup input.add-new-rule",function(){var t=jQuery(this).parent().find("ul.rules");jQuery(t).find("> li").length<2&&jQuery(t).find("li:nth(0)").append('<span class="remove-rule"><svg viewbox="0 0 25 25"><line x1="6.5" y1="18.5" x2="18.5" y2="6.5" fill="none" stroke="#FF6347" stroke-width="3" vector-effect="non-scaling-stroke" ></line><line y1="6.5" x1="6.5" y2="18.5" x2="18.5" fill="none" stroke="#FF6347" stroke-width="3" vector-effect="non-scaling-stroke" ></line></svg></span>'),$cloned_item=jQuery(t).find("> li").last().clone(),jQuery($cloned_item).find("> select").each(function(){jQuery(this).prop("name",jQuery(this).prop("name").replace(/\[instance_conditional_logic\]\[rules\]\[[0-9]+\]/gi,"[instance_conditional_logic][rules]["+jQuery(t).data("rules")+"]"))}),jQuery(t).append($cloned_item),jQuery(t).data("rules",parseInt(jQuery(t).data("rules"))+1),jQuery($cloned_item).find('select[name*="[operand]"]').trigger("change")}),f.find('.updraftcentral_row_extracontents #remote-storage-container > input[type="checkbox"]').each(function(){var t=jQuery(this);t.attr("aria-label",udclion.updraftplus.backup_using+" "+t.val()+"?")}),y(),m=0,l=h("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .updraft_servicecheckbox:checked"),h(l).each(function(t,e){var a=h(e).val();"updraft_servicecheckbox_none"!=h(e).attr("id")&&m++,h("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .remote-tab-"+a).show(),t==h(l).length-1&&D(a)}),0<m?h("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .updraftplusmethod.none").hide():(h("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .updraftplusmethod:not(.none)").hide(),h("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .updraftplusmethod.none").show()),"function"==typeof(t=h("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .updraft_servicecheckbox")).labelauty&&t.labelauty(),g=k=0,r.data.hasOwnProperty("meta")&&((t=r.data.meta).hasOwnProperty("retain_rules")&&t.retain_rules.hasOwnProperty("files")&&(u=t.retain_rules.files,c=t.retain_rules.db,U=x=0,h.each(u,function(t,e){b("files",e.after_howmany,e.after_period,e.every_howmany,e.every_period)}),h.each(c,function(t,e){b("db",e.after_howmany,e.after_period,e.every_howmany,e.every_period)})),t.hasOwnProperty("extra_dbs")&&h.each(t.extra_dbs,function(t,e){e.hasOwnProperty("host")&&v(e.host,e.user,e.name,e.pass,e.prefix)})),r.data.hasOwnProperty("updraftplus_version")&&(w=r.data.updraftplus_version),Q("uploads"),Q("others"),Q("wpcore"),O=h("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output #updraft_report_cell .updraft_reportbox").length+2,h("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output #updraft_include_more_paths input.updraft_include_more_path").each(function(t,e){e=h(e).data(void 0);g<e&&(g=e)}),h('#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output input[type="submit"]').removeClass().addClass("btn btn-primary-outline"),h("#updraftcentral_dashboard_existingsites .updraft_site_settings_output").on("change keyup paste",".updraft_webdav_settings",function(){var t,r=[],n="",e=(h(".updraft_webdav_settings").each(function(t,e){var a,e=h(e).attr("id");e&&"updraft_webdav_settings_"==e.substring(0,24)?(a=e.substring(24),r[a]=this.value):e&&"updraft_webdav_"==e.substring(0,15)&&(a=e.substring(15),a=(id_split=a.split("_"))[0],n=id_split[1],void 0===r[n]&&(r[n]=[]),r[n][a]=this.value)}),"@"),a="/",d=":",s=":";for(n in r)(0<=r[n].host.indexOf("@")||""===r[n].host)&&(e=""),0<=r[n].host.indexOf("/")?h("#updraft_webdav_host_error").show():h("#updraft_webdav_host_error").hide(),0!=r[n].path.indexOf("/")&&""!==r[n].path||(a=""),""!==r[n].user&&""!==r[n].pass||(d=""),""!==r[n].host&&""!==r[n].port||(s=""),t=r[n].webdav+r[n].user+d+r[n].pass+e+encodeURIComponent(r[n].host)+s+r[n].port+a+r[n].path,masked_webdav_url=r[n].webdav+r[n].user+d+r[n].pass.replace(/./gi,"*")+e+encodeURIComponent(r[n].host)+s+r[n].port+a+r[n].path,""==n?h("#updraftcentral_dashboard .updraft_site_settings_output #updraft_webdav_settings_url").val(t):(h("#updraftcentral_dashboard .updraft_site_settings_output #updraft_webdav_url_"+n).val(t),h("#updraftcentral_dashboard .updraft_site_settings_output #updraft_webdav_masked_url_"+n).val(masked_webdav_url))})}var u,c,l})}var k=0;function v(t,e,a,r,n){k++,h(template_replace("updraftplus-settings-extra-db",{updraft_extra_dbs:k,remove:udclion.updraftplus.remove,backup_external_database:udclion.updraftplus.backup_external_database,host:udclion.updraftplus.host,database:udclion.updraftplus.database,username:udclion.updraftplus.username,password:udclion.updraftplus.password,table_prefix:udclion.updraftplus.table_prefix,backup_tables_with_prefixes:udclion.updraftplus.backup_tables_with_prefixes,test_connection:udclion.updraftplus.test_connection},{host_attr:t,user_attr:e,name_attr:a,pass_attr:r,prefix_attr:n})).appendTo(h("#updraft_backupextradbs")).fadeIn()}function a(){UpdraftCentral.register_row_clicker(".row_backupnow, .updraftcentral_site_backup_now",function(t){e(t,"new")}),UpdraftCentral.register_row_clicker(".row_backupnow, .updraftcentral_site_backup_now_increment",function(t){e(t,"incremental")}),UpdraftCentral.register_modal_listener("#backupnow_includefiles_showmoreoptions",function(t){t.preventDefault(),h("#updraftcentral_modal #backupnow_includefiles_moreoptions").slideToggle()}),UpdraftCentral.register_modal_listener("#backupnow_database_showmoreoptions",function(t){t.preventDefault(),h("#updraftcentral_modal #backupnow_database_moreoptions").slideToggle()}),UpdraftCentral.register_modal_listener("#backupnow_includecloud_showmoreoptions",function(t){t.preventDefault(),h("#updraftcentral_modal #backupnow_includecloud_moreoptions").slideToggle()})}function p(n){n.find(".updraftcentral_row_extracontents").css("opacity","0.3");var t=navigator.userAgent.match(/Opera|OPR\//)?1:0;UpdraftCentral.send_site_rpc("updraftplus.get_fragment",{fragment:"panel_download_and_restore",data:{include_opera_warning:t,include_uploader:0,will_immediately_calculate_disk_space:0,include_header:1}},n,function(t,e,a){var r;n.find(".updraftcentral_row_extracontents").css("opacity","1.0"),"ok"==e&&t&&(n.find(".updraftcentral_row_extracontents").html('<div class="updraft_existing_backups_output"><button class="btn btn-refresh updraftcentral_site_backups_manage"><span class="dashicons dashicons-image-rotate" ></span></button>'+UpdraftCentral_Library.sanitize_html(t.data.output)+"</div>"),d(n),o.count()&&(r=setInterval(function(){if(h("table.existing-backups-table").length)switch(clearInterval(r),_){case"single":var t=o.get_items();o.clear(),t.length&&h('tr.updraft_existing_backups_row[data-nonce="'+t[0]+'"]').find("a.updraft-delete-link").trigger("click");break;case"multiple":t=l.get_items();if(l.clear(),o.clear(),t.length){for(var e=0;e<t.length;e++)h('tr.updraft_existing_backups_row[data-nonce="'+t[e]+'"]').find("input.delete_backup_item").prop("checked",!0);h("button#btn-backup-bulk-delete").trigger("click")}}},1e3)))})}function e(t,l){UpdraftCentral.send_site_rpc("updraftplus.get_fragment","backupnow_modal_contents",t,function(t,e,a){var r,n;"ok"==e&&t&&(e=!(t.data.output.hasOwnProperty("error")&&t.data.output.error)&&udclion.updraftplus.backupnow,n=!1,t.data.output.hasOwnProperty("backupnow_file_entities")&&(r=t.data.output.backupnow_file_entities),t.data.output.hasOwnProperty("incremental_installed")&&(n=t.data.output.incremental_installed),UpdraftCentral.open_modal(udclion.updraftplus.backupnow,t.data.output.html,function(){var t=h("#updraftcentral_modal #backupnow_includedb").is(":checked")?0:1,e=h("#updraftcentral_modal #backupnow_includefiles").is(":checked")?0:1,a=h("#updraftcentral_modal #backupnow_includecloud").is(":checked")?0:1,r="incremental"==l?1:0,n="",d=(h('#updraftcentral_modal #backupnow_includefiles_moreoptions input[type="checkbox"]').each(function(t){var e;!h(this).is(":checked")||"updraft_include_"==(e=h(this).attr("name")).substring(0,16)&&(e=e.substring(16),""!=n&&(n+=","),n+=e)}),""),s=!1,i=(h('#backupnow_database_moreoptions input[type="checkbox"]').each(function(t){h(this).is(":checked")||(s=!0)}),d=!s||jQuery("input[name^='updraft_include_tables_']").serializeArray(),!1),o="",u=(jQuery('#backupnow_includecloud_moreoptions input[type="checkbox"]').each(function(t){jQuery(this).is(":checked")||(i=!0)}),o=!i||jQuery("input[name^='updraft_include_remote_service_']").serializeArray(),h("#always_keep").is(":checked")?1:0);if(""!=n||0!=e)if(""!=d||0!=t){if(""==o&&0==a)return alert(udclion.updraftplus.nocloudserviceschosen),void jQuery("#backupnow_includecloud_moreoptions").show();s||(d=null),i||(o=null),t&&e?UpdraftCentral_Library.dialog.alert(udclion.updraftplus.excludedeverything):(UpdraftCentral.close_modal(),UpdraftCentral_Module_UpdraftPlus.backupnow_go(t,e,a,n,{always_keep:u,incremental:r},h("#updraftcentral_modal #backupnow_label").val(),d,o))}else UpdraftCentral_Library.dialog.alert(udclion.updraftplus.notableschosen);else UpdraftCentral_Library.dialog.alert(udclion.updraftplus.nofileschosen)},e,function(){n||"incremental"!=l?jQuery("#updraftcentral_modal .incremental-backups-only").hide():(jQuery("#updraftcentral_modal .incremental-free-only").show(),l="new"),h("#updraftcentral_modal #backupnow_label").val(""),"incremental"==l?(c(!0,r),h("#updraftcentral_modal #backupnow_includedb").prop("checked",!1),h("#updraftcentral_modal #backupnow_includefiles").prop("checked",!0),h("#updraftcentral_modal #backupnow_includefiles_label").text(udclion.updraftplus.files_incremental_backup),h("#updraftcentral_modal .new-backups-only").hide(),h("#updraftcentral_modal .incremental-backups-only").show()):(c(!1,r),h("#updraftcentral_modal #backupnow_includedb").prop("checked",!0),h("#updraftcentral_modal #backupnow_includefiles_label").text(udclion.updraftplus.files_new_backup),h("#updraftcentral_modal .new-backups-only").show(),h("#updraftcentral_modal .incremental-backups-only").hide()),h("#updraftcentral_modal #backupnow_includefiles_moreoptions").hide(),h("#updraftcentral_modal #updraft_backupnow_gotosettings").contents().unwrap()},!0,"backup-now"))})}function c(t,e){t?jQuery(e).each(function(t,e){jQuery("#updraftcentral_modal #backupnow_files_updraft_include_"+e).prop("checked",!1),jQuery("#updraftcentral_modal #backupnow_files_updraft_include_"+e).prop("disabled",!0)}):jQuery('#updraftcentral_modal #backupnow_includefiles_moreoptions input[type="checkbox"]').each(function(t){var e=jQuery(this).attr("name");"updraft_include_"==e.substring(0,16)&&(e=e.substring(16),jQuery("#updraftcentral_modal #backupnow_files_updraft_include_"+e).prop("disabled",!1),jQuery(this).is(":checked")&&jQuery("#updraftcentral_modal #backupnow_files_updraft_include_"+e).prop("checked",!0))})}function f(t,e,a){var r=udclion.updraftplus.delete_areyousure_singular;-1<t.indexOf(",")&&(r=udclion.updraftplus.delete_areyousure_plural),UpdraftCentral.open_modal(udclion.updraftplus.deletebackupset,UpdraftCentral.template_replace("updraftplus-deletebackup",{nonce:e,timestamp:t,delete_question:r,also_delete_from_remote:udclion.updraftplus.also_delete_from_remote,deleting_please_allow_time:udclion.updraftplus.deleting_please_allow_time}),function(){var t=h("#updraft_delete_modal_contents").data("nonce").toString(),e=h("#updraft_delete_modal_contents").data("timestamp").toString(),a=0,r=(h("#updraft_delete_modal_contents #updraft_delete_remote").is(":checked")&&(a=1),h("#updraftcentral_modal #updraft-delete-waitwarning").slideDown(),!!navigator.userAgent.match(/Opera|OPR\//));UpdraftCentral.send_site_rpc("updraftplus.deleteset",{backup_nonce:t,backup_timestamp:e,delete_remote:a,get_history_opts:{include_opera_warning:r,include_uploader:!1,will_immediately_calculate_disk_space:!1,include_header:!0}},UpdraftCentral.$site_row,function(t,e,a){h("#updraftcentral_modal #updraft-delete-waitwarning").slideUp(),"ok"!=e||!t||null!=(e=t.data).result&&("error"==e.result?UpdraftCentral_Library.dialog.alert("<h2>"+udclion.error+"</h2>"+e.message):"success"==e.result&&(p(UpdraftCentral.$site_row),UpdraftCentral.close_modal(),void 0===(t=e.message)&&(t=e.local_message+" "+e.backup_local,t=(t+=", "+e.remote_message+" "+e.backup_remote)+", "+e.set_message+" "+e.backup_sets),UpdraftCentral_Library.dialog.alert("<h2>"+udclion.updraftplus.deleted+"</h2>"+t)))})},udclion.updraftplus.delete,function(){a?(h("#updraft-delete-remote-section, #updraft_delete_remote").prop("disabled",!1),h("#updraft-delete-remote-section, #updraft_delete_remote").show()):h("#updraft-delete-remote-section").remove()})}function y(){var t=0,e=h("#updraftcentral_dashboard_existingsites .updraft_site_settings_output .updraft_interval").val(),a=("manual"==e?h("#updraftcentral_dashboard_existingsites .updraft_site_settings_output .updraft_files_timings").hide():h("#updraftcentral_dashboard_existingsites .updraft_site_settings_output .updraft_files_timings").show(),"weekly"==e||"fortnightly"==e||"monthly"==e?(r("updraft_startday_files",e),h("#updraftcentral_dashboard_existingsites .updraft_site_settings_output #updraft_startday_files").show()):(h("#updraftcentral_dashboard_existingsites .updraft_monthly_extra_words_updraft_startday_files").remove(),h("#updraftcentral_dashboard_existingsites .updraft_site_settings_output #updraft_startday_files").hide()),h("#updraftcentral_dashboard_existingsites .updraft_site_settings_output .updraft_interval_database").val());"manual"==a&&(t=1,h("#updraftcentral_dashboard_existingsites .updraft_site_settings_output .updraft_db_timings").hide()),"weekly"==a||"fortnightly"==a||"monthly"==a?(r("updraft_startday_db",a),h("#updraftcentral_dashboard_existingsites .updraft_site_settings_output #updraft_startday_db").show()):(h("#updraftcentral_dashboard_existingsites .updraft_monthly_extra_words_updraft_startday_db").remove(),h("#updraftcentral_dashboard_existingsites .updraft_site_settings_output #updraft_startday_db").hide()),a==e?(h("#updraftcentral_dashboard_existingsites .updraft_site_settings_output .updraft_db_timings").hide(),0==t?h("#updraftcentral_dashboard_existingsites .updraft_site_settings_output .updraft_same_schedules_message").show():h("#updraftcentral_dashboard_existingsites .updraft_site_settings_output .updraft_same_schedules_message").hide()):(h("#updraftcentral_dashboard_existingsites .updraft_site_settings_output .updraft_same_schedules_message").hide(),0==t&&h("#updraftcentral_dashboard_existingsites .updraft_site_settings_output .updraft_db_timings").show())}"notices"!=UpdraftCentral.get_dashboard_mode()&&a(),h("#updraftcentral_dashboard_existingsites").on("updraftcentral_dashboard_mode_set",function(t,e){e&&e.hasOwnProperty("new_mode")&&"notices"==e.new_mode||a()}),h("#updraftcentral_dashboard_existingsites").on("updraftcentral_dashboard_mode_set_backups",function(){UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_backupextradb_another",function(){v("","","","","")}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_backupextradbs .updraft_backupextradbs_row_delete",function(){h(this).parents(".updraft_backupextradbs_row").fadeOut("medium",function(){h(this).remove()})}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_backupextradbs .updraft_backupextradbs_row_testconnection",function(){var r=h(this).closest(".updraft_backupextradbs_row"),t=(r.find(".updraft_backupextradbs_testresultarea").html("<p><em>"+udclion.updraftplus.testing+"</em></p>"),{row:r.attr("id"),host:r.find(".extradb_host").val(),user:r.find(".extradb_user").val(),pass:r.find(".extradb_pass").val(),name:r.find(".extradb_name").val(),prefix:r.find(".extradb_prefix").val()});UpdraftCentral.send_site_rpc("updraftplus.extradb_testconnection",t,UpdraftCentral.$site_row,function(t,e,a){"ok"==e&&t&&r.find(".updraft_backupextradbs_testresultarea").html(UpdraftCentral_Library.sanitize_html(t.data.m))},r)}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output .updraftplusmethod button.updraft-test-button",function(){var t,e=h(this),n=jQuery(this).data("instance_id"),d=e.data("method"),r=e,s=function(t,e,a,r){return"sftp"==d&&(void 0!==r&&r.hasOwnProperty("scp")&&r.scp?UpdraftCentral_Library.dialog.alert("<h2>"+sprintf(udclion.updraftplus.settings_test_result,"SCP")+"</h2> "+t.data.output):UpdraftCentral_Library.dialog.alert("<h2>"+sprintf(udclion.updraftplus.settings_test_result,"SFTP")+"</h2> "+t.data.output),t.hasOwnProperty("data")&&t.data&&t.data.hasOwnProperty("data")&&t.data.data&&void 0!==t.data.data.valid_md5_fingerprint&&h("#updraft_sftp_fingerprint_"+n).val(t.data.data.valid_md5_fingerprint),!0)},e=r.closest(".updraftcentral_site_row"),a=r.data("method"),i=r.data("method_label"),o=r.data("instance_id"),u=(t=o?".updraftplusmethod."+a+"-"+o:".updraftplusmethod."+a,r.html(sprintf(udclion.updraftplus.testing_settings,i)),{method:a});h("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output "+t+" input[data-updraft_settings_test], #updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .expertmode input[data-updraft_settings_test]").each(function(t,e){var a,r=h(e).data("updraft_settings_test"),n=h(e).attr("type");r&&(n||(console.log("UpdraftCentral: UpdraftPlus: settings test input item with no type found"),console.log(e),n="text"),a=null,"checkbox"==n?a=h(e).is(":checked")?1:0:"text"==n||"password"==n?a=h(e).val():(console.log("UpdraftCentral: UpdraftPlus: settings test input item with unrecognised type ("+n+") found"),console.log(e)),u[r]=a)}),h("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output "+t+" textarea[data-updraft_settings_test], #updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output "+t+" select[data-updraft_settings_test]").each(function(t,e){var a=h(e).data("updraft_settings_test");u[a]=h(e).val()}),"webdav"!==a||u.hasOwnProperty("url")&&null!==u.url||void 0!==(t=h('.updraftplusmethod.webdav input[name="updraft_webdav[settings]['+o+'][url]"]').val())&&t.length&&(u.url=t),UpdraftCentral.send_site_rpc("updraftplus.test_storage_settings",u,e,function(t,e,a){"ok"==e&&t&&(r.html(sprintf(udclion.updraftplus.test_settings,i)),void 0!==(s=void 0!==s&&0!=s?s.call(this,t,e,a,u):s)&&!1===s&&UpdraftCentral_Library.dialog.alert("<h2>"+sprintf(udclion.updraftplus.settings_test_result,i)+"</h2> "+t.data.output))},r.closest("td"))}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output #updraftplus-settings-save",function(n,d){var a=h(s+" input, "+s+" textarea, "+s+" select").serialize();h.each(h(s+" input[type=checkbox]").filter(function(t){return 0==h(this).prop("checked")}),function(t,e){a+="&"+h(e).attr("name")+"=0"}),spin_this=h(this).closest("td"),a+="&updraftplus_version="+w,UpdraftCentral.send_site_rpc("updraftplus.save_settings",a,n,function(t,e,a){var r;"ok"===e&&(e=t.data.backup_dir.writable,r=t.data.backup_dir.message,t.data.backup_dir.button_title,0==e?(h(s+"#updraft_writable_mess").html(r),h(s+".backupdirrow").show()):h(s+".backupdirrow").hide(),e=n.data("site_url"),h("#updraftcentral_notice_container .updraftplus_saved_settings").closest(".updraftcentral_notice").remove(),r=add_dashboard_notice("<h2>"+udclion.updraftplus.settings_saved+" - "+e+'</h2><div class="updraftplus_saved_settings" data-site_id="'+d+'">'+t.data.messages+"</div>","notice",!1),h("#updraft-central-content").animate({scrollTop:r.offset().top},1e3))},spin_this)}),UpdraftCentral.register_row_clicker(t+".backupdirrow a.updraft_backup_dir_reset",function(){h(s+"#updraft_dir").val("updraft")}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output .enableexpertmode",function(){h(".updraftcentral_row_extracontents .updraft_site_settings_output .expertmode").fadeIn(),h(".updraftcentral_row_extracontents .updraft_site_settings_output .enableexpertmode").off("click")}),UpdraftCentral.register_row_clicker(t+" a.updraft_authlink",function(t){var e,a=h(this).attr("href");void 0!==a&&(e=h(this).closest("td"),UpdraftCentral_Library.open_browser_at(t,{module:"direct_url",url:a},e))}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output .updraft_include_entity",function(){var t=h(this).data("toggle_exclude_field");t&&Q(t,!1)},!1,"change"),UpdraftCentral.register_row_clicker(".updraft_existing_backups_output .updraft_existingbackup_date",function(t){var e=h(this).data("nonce"),a=h(this).data("timestamp");UpdraftCentral.send_site_rpc("updraftplus.rawbackup_history",{nonce:e,timestamp:a},UpdraftCentral.$site_row,function(t,e,a){"ok"==e&&!1!==t&&t.hasOwnProperty("data")&&t.data.hasOwnProperty("rawbackup")&&(UpdraftCentral.close_modal(),UpdraftCentral.open_modal(udclion.updraftplus.raw,t.data.rawbackup,!0,!1,null,!1,"modal-lg"))})},!1,"dblclick"),register_modal_listener("#always_keep_this_backup",function(t){var e=h(this).data("backup_key");UpdraftCentral.send_site_rpc("updraftplus.always_keep_this_backup",{backup_key:e,always_keep:h(this).is(":checked")?1:0},UpdraftCentral.$site_row,function(t,e,a){"ok"==e&&!1!==t&&t.hasOwnProperty("data")&&t.data.hasOwnProperty("rawbackup")&&(UpdraftCentral.close_modal(),UpdraftCentral.open_modal(udclion.updraftplus.raw,t.data.rawbackup,!0,!1))})},"change"),UpdraftCentral.register_row_clicker(".updraft_existing_backups_output .choose-components-button",function(e){var a=this,r=h(a).data("entities"),n=h(a).closest("td");r&&UpdraftCentral_Library.dialog.confirm("<h2>"+udclion.updraftplus.restore_backup+"</h2>"+udclion.updraftplus.pre_restore_message,function(t){t&&(UpdraftCentral_Library.open_browser_at(e,{module:"updraftplus",action:"initiate_restore",data:{entities:r,backup_timestamp:h(a).data("backup_timestamp"),showdata:h(a).data("showdata")}},n),o.add(h(a).data("backup_timestamp"),h(a).closest("tr.updraft_existing_backups_row").data("nonce")))})}),UpdraftCentral.register_row_clicker(".updraft_existing_backups_output .updraft_download_button",function(t){var t=t.data("site_id"),e=h(this).data("backup_timestamp"),o=h(this).data("what"),p=h(this).data("set_contents"),_=h(this).data("prettydate"),u=(h(this).closest("td"),t),a=e,r=o,n=p,c=_,l=(n=(n="string"!=typeof n?n.toString():n).split(","),h('#updraftcentral_notice_container .updraftcentral_listener_updraftplus_download[data-site_id="'+u+'"'));0==l.length&&(l=!1);for(var d=0;d<n.length;d++){var s=n[d],i=u+"_"+a+"_"+r+"_"+s;if(h("."+i).length)return void console.log("UDCentral: There already appears to be an active downloader for this entity (stid: "+i+")");UpdraftCentral.send_site_rpc("updraftplus.downloader",{type:r,timestamp:a,findex:s},UpdraftCentral.$site_row,function(t,e,a){var r,n,d,s,i,o;"ok"==e&&!1!==t&&t.hasOwnProperty("data")&&t.data.hasOwnProperty("result")?(e=t.data.result,r=(t=t.data.request).timestamp,n=t.type,t=parseInt(t.findex),s="."+(d=u+"_"+r+"_"+n+"_"+t),i="??",o=(new Date).getTime(),widgets_html=template_replace("updraftplus-downloader",{stid:d,download_verb:udclion.updraftplus.download_verb,what:n,itext:0==t?"":" ("+(t+1)+")",pretty_date:c||r,begun_looking:udclion.updraftplus.begun_looking,site_id:u,backup_timestamp:r,findex:t}),"downloaded"==e?i=template_replace("updraftplus-downloaded",{file_ready:udclion.updraftplus.file_ready,download_to_computer:udclion.updraftplus.download_to_computer,and_then:udclion.updraftplus.and_then,you_should:udclion.updraftplus.you_should,backup_timestamp:r,site_id:u,what:n,findex:t,delete_from_server:udclion.updraftplus.delete_from_server}):"needs_download"==e?i=udclion.updraftplus.needs_download:"download_failed"==e&&(i=udclion.updraftplus.download_failed),!1===l?l=UpdraftCentral.create_dashboard_listener("updraftplus_download",UpdraftCentral.$site_row,widgets_html):l.append(widgets_html),l.data("finished",!1),l.find(s).data("last_time_began",o),l.find(s+" .raw").html(i)):UpdraftCentral.add_dashboard_notice("<h2>"+UpdraftCentral.$site_row.data("site_description")+"</h2>"+udclion.updraftplus.download_start_failed,"error")})}}),UpdraftCentral.register_row_clicker(".updraft_existing_backups_output button.updraft-upload-link",function(t){h(this).hide();var e=h(this).data("nonce").toString(),a=h(this).data("key").toString();e?UpdraftCentral.send_site_rpc("updraftplus.upload_local_backup",{use_nonce:e,use_timestamp:a},UpdraftCentral.$site_row,function(t,e,a){"ok"==e&&!1!==t&&t.hasOwnProperty("data")&&(t.data.hasOwnProperty("nonce")?(e='<div class="backup_state">'+udclion.updraftplus.backupstarted+"</div>",UpdraftCentral.create_dashboard_listener("updraftplus_backup",UpdraftCentral.$site_row,e,{job_id:t.data.nonce},udclion.updraftplus.upload_backup)):UpdraftCentral.add_dashboard_notice("<h2>"+UpdraftCentral.$site_row.data("site_description")+"</h2>"+udclion.updraftplus.backup_start_failed,"error"))}):console.log("UDCentral: UpdraftPlus: A upload link was clicked, but the backup ID could not be found")}),UpdraftCentral.register_row_clicker(".updraft_existing_backups_output .updraft-delete-link",function(t){var e="0"!==h(this).data("hasremote").toString(),a=h(this).data("nonce").toString(),r=h(this).data("key").toString();_="single",a?o.exists(r)?p(t):f(r,a,e):console.log("UDCentral: UpdraftPlus: A delete link was clicked, but the backup ID could not be found")}),UpdraftCentral.register_event_handler("click",".delete-backup-container input.delete_backup_item",function(t){0<h(".delete-backup-container input.delete_backup_item:checked").length?h("button#btn-backup-bulk-delete").removeClass("btn-secondary").addClass("btn-primary"):h("button#btn-backup-bulk-delete").removeClass("btn-primary").addClass("btn-secondary")}),UpdraftCentral.register_row_clicker(".updraft_existing_backups_output button#btn-backup-bulk-delete",function(t){var a,r=[],n=!1,d=!1;l.clear(),h(".delete-backup-container input.delete_backup_item:checked").each(function(){var t=h(this).closest("tr.updraft_existing_backups_row").find("a.updraft-delete-link"),e=t.data("key");void 0!==e&&e&&(r.push(e.toString()),a=t.data("nonce"),n=n||void 0!==t.data("hasremote")&&"0"!=t.data("hasremote"),o.exists(e)&&(d=!0),l.add(e,h(this).closest("tr.updraft_existing_backups_row").data("nonce")))}),_="multiple",r.length?d?p(t):f(r.join(),a,n):console.log("UDCentral: UpdraftPlus: The bulk delete button was clicked, but none of the backup IDs could be found")}),UpdraftCentral.register_row_clicker(".updraft_existing_backups_output a.updraft_diskspaceused_update",function(r){var t=this.closest("ul");UpdraftCentral.send_site_rpc("updraftplus.get_fragment",{fragment:"disk_usage",data:"updraft"},r,function(t,e,a){"ok"==e&&t&&r.find(".updraft_diskspaceused").html(UpdraftCentral_Library.sanitize_html(t.data.output))},t)}),UpdraftCentral.register_row_clicker(".updraft_existing_backups_output a.updraft_rescan_local",function(r){var t=this.closest("ul");r.find(".updraft_existing_backups").html('<div class="rescanning">'+udclion.updraftplus.rescanning+"</div>"),UpdraftCentral.send_site_rpc("updraftplus.rescan","rescan",r,function(t,e,a){"ok"==e&&t&&(r.find(".updraft_existing_backups").html(t.data.t),r.find(".updraft_existing_backups_output h2").html(t.data.n),d(r))},t)}),UpdraftCentral.register_row_clicker(".updraft_existing_backups_output a.updraft_rescan_remote",function(r){var t=this.closest("ul");r.find(".updraft_existing_backups").html('<div class="rescanning">'+udclion.updraftplus.rescanningremote+"</div>"),UpdraftCentral.send_site_rpc("updraftplus.rescan","remotescan",r,function(t,e,a){"ok"==e&&t&&(r.find(".updraft_existing_backups").html(t.data.t),r.find(".updraft_existing_backups_output h2").html(t.data.n),d(r))},t,90)}),UpdraftCentral.register_row_clicker(".updraftcentral_site_backups_manage",function(t){p(t)},!0),UpdraftCentral.register_row_clicker(".updraftcentral_site_backup_settings",function(t){n(t)},!0),UpdraftCentral.register_row_clicker(".updraft_site_settings_output select.updraft_interval, .updraft_site_settings_output select.updraft_interval_database",function(){y()},!1,"change"),UpdraftCentral.register_row_clicker(".updraft_authlink",function(r){var t=this.closest("ul"),e={remote_method:h(this).data("remote_method"),instance_id:h(this).data("instance_id")};UpdraftCentral.send_site_rpc("updraftplus.auth_remote_method",e,r,function(t,e,a){"ok"==e&&!1!==t&&("error"==(e=t.data).result?UpdraftCentral_Library.dialog.alert("<h2>"+udclion.error+"</h2>"+e.message):"success"==e.result&&n(r))},t)},!0),UpdraftCentral.register_row_clicker(".updraft_deauthlink",function(r){var t=this.closest("ul"),e={remote_method:h(this).data("remote_method"),instance_id:h(this).data("instance_id")};UpdraftCentral.send_site_rpc("updraftplus.deauth_remote_method",e,r,function(t,e,a){"ok"==e&&!1!==t&&("error"==(e=t.data).result?UpdraftCentral_Library.dialog.alert("<h2>"+udclion.error+"</h2>"+e.message):"success"==e.result&&n(r))},t)},!0),UpdraftCentral.register_row_clicker(".updraft_site_settings_output #updraft_retain_db_addnew",function(){b("db",12,604800,1,604800)}),UpdraftCentral.register_row_clicker(".updraft_site_settings_output #updraft_retain_files_addnew",function(){b("files",12,604800,1,604800)}),UpdraftCentral.register_row_clicker(".updraft_site_settings_output .updraft_retain_rules_delete, .updraft_site_settings_output .updraft_retain_rules_delete",function(){h(this).parent(".updraft_retain_rules").slideUp(function(){h(this).remove()})}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_report_cell .updraft_reportbox .updraft_reportbox_delete",function(){h(this).closest(".updraft_reportbox").fadeOut("medium",function(){h(this).remove()})}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_report_cell .updraft_report_another",function(){h("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output #updraft_report_cell .updraft_report_another_p").before(template_replace("updraftplus-settings-report-email",{index:O,send_only_on_warnings:udclion.updraftplus.send_only_on_warnings,whole_backup:udclion.updraftplus.whole_backup,email_size_limits:udclion.updraftplus.email_size_limits,db_backup:udclion.updraftplus.db_backup})),h("#updraft_reportbox_"+O).fadeIn(),O++}),UpdraftCentral.register_event_handler("change",".updraft_report_wholebackup .updraft_report_checkbox",function(){var t=h(this).closest(".updraft_reportbox").find(".updraft_report_dbbackup");h(this).is(":checked")?t.removeClass("updraft_report_disabled").find(".updraft_report_checkbox").removeProp("disabled"):(t.find(".updraft_report_checkbox").prop("checked",!1),t.addClass("updraft_report_disabled").find(".updraft_report_checkbox").prop("disabled",!0))}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_include_more",function(){h("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output #updraft_include_more").is(":checked")?h("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output #updraft_include_more_options").slideDown():h("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output #updraft_include_more_options").slideUp()},!1,"change"),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_include_more_paths_another",function(){g++,h(template_replace("updraftplus-settings-more-paths",{index:g,enter_the_directory:udclion.updraftplus.enter_the_directory,remove:udclion.updraftplus.remove})).appendTo(h(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_include_more_paths")).slideDown()}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_include_more_options .updraftplus-morefiles-row-delete",function(){var t=h(this).closest(".updraftplus-morefiles-row");h(t).slideUp("medium",function(){h(this).remove()})}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output .updraft_servicecheckbox",function(){var t=h(this).attr("id");"updraft_servicecheckbox_"!=t.substring(0,24)||null!=(t=t.substring(24))&&""!=t&&(h(this).is(":checked")?(m++,h("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .remote-tab-"+t).fadeIn(),D(t)):(m--,h("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .remote-tab-"+t).hide(),1==h("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .remote-tab-"+t).data("active")&&D(h("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .remote-tab:visible").last().attr("name")))),m<=0?h("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .updraftplusmethod.none").fadeIn():h("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .updraftplusmethod.none").hide()},!1,"change"),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output .remote-tab",function(){D(h(this).attr("name"))}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents .updraft_site_settings_output .updraft_servicecheckbox:not(.multi)",function(){var t=h(this).attr("value");h(this).is(":not(:checked)")?(h("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .updraftplusmethod."+t).hide(),h("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .updraftplusmethod.none").fadeIn()):h("#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output .updraft_servicecheckbox").not(this).prop("checked",!1)},!1,"change"),UpdraftCentral.register_row_clicker(t+"#updraftvault_settings_cell .updraftvault_backtostart",function(){h(s+"#updraftvault_settings_showoptions").slideUp(),h(s+"#updraftvault_settings_connect").slideUp(),h(s+"#updraftvault_settings_connected").slideUp(),h(s+"#updraftvault_settings_default").slideDown()}),UpdraftCentral.register_row_clicker(t+"#updraftvault_settings_connect input",function(t,e,a){13==a.which&&(h(s+"#updraftvault_connect_go").trigger("click"),a.preventDefault())},!1,"keypress"),UpdraftCentral.register_row_clicker(t+"#updraftvault_settings_cell #updraftvault_recountquota",function(){h(s+"#updraftvault_recountquota").html(udclion.updraftplus.counting),UpdraftCentral.send_site_rpc("updraftplus.vault_recountquota",{instance_id:h("#updraftvault_settings_connect").data("instance_id")},UpdraftCentral.$site_row,function(t,e,a){h(s+"#updraftvault_recountquota").html(udclion.updraftplus.update_quota_count),"ok"==e&&t&&t.hasOwnProperty("data")&&t.data.hasOwnProperty("html")&&(h(s+"#updraftvault_settings_connected").html(t.data.html),t.data.hasOwnProperty("connected")&&(t.data.connected?(h(s+"#updraftvault_settings_default").hide(),h(s+"#updraftvault_settings_connected").show()):(h(s+"#updraftvault_settings_connected").hide(),h(s+"#updraftvault_settings_default").show())))})}),UpdraftCentral.register_row_clicker(t+"#updraftvault_settings_cell #updraftvault_disconnect",function(){h(s+"#updraftvault_disconnect").html(udclion.updraftplus.disconnecting),UpdraftCentral.send_site_rpc("updraftplus.vault_disconnect",{instance_id:h("#updraftvault_settings_connect").data("instance_id")},UpdraftCentral.$site_row,function(t,e,a){h(s+"#updraftvault_disconnect").html(udclion.updraftplus.disconnect),"ok"==e&&t.hasOwnProperty("data")&&(h(s+"#updraftvault_disconnect").html(udclion.updraftplus.disconnect),t.data.hasOwnProperty("html")&&(h(s+"#updraftvault_settings_connected").html(t.data.html).slideUp(),h(s+"#updraftvault_settings_default").slideDown()))})}),UpdraftCentral.register_row_clicker(t+"#updraftvault_connect",function(){h(s+"#updraftvault_settings_default").slideUp(),h(s+"#updraftvault_settings_connect").slideDown()}),UpdraftCentral.register_row_clicker(t+"#updraftvault_showoptions",function(){h(s+"#updraftvault_settings_default").slideUp(),h(s+"#updraftvault_settings_showoptions").slideDown()}),UpdraftCentral.register_row_clicker(t+"#updraft_s3_newapiuser",function(r){var t=this.closest("td");UpdraftCentral.send_site_rpc("updraftplus.get_fragment",{fragment:"s3_new_api_user_form",data:null},r,function(t,e,a){"ok"==e&&t&&UpdraftCentral.open_modal(udclion.updraftplus.create_new_iam_user_and_bucket,t.data.output,function(){h("#updraftcentral_modal #updraft-s3newapiuser-results").empty();var t={adminaccesskey:h("#updraftcentral_modal #updraft_s3newapiuser_adminaccesskey").val(),adminsecret:h("#updraftcentral_modal #updraft_s3newapiuser_adminsecret").val(),newuser:h("#updraftcentral_modal #updraft_s3newapiuser_newuser").val(),bucket:h("#updraftcentral_modal #updraft_s3newapiuser_bucket").val(),region:h("#updraftcentral_modal #updraft_s3newapiuser_region").val(),useservercerts:h("#updraftcentral_modal #updraft_ssl_useservercerts").val(),disableverify:h("#updraftcentral_modal #updraft_ssl_disableverify").val(),nossl:h("#updraftcentral_modal #updraft_ssl_nossl").val(),allowdelete:h("#updraftcentral_modal #updraft_s3newapiuser_allowdelete").is(":checked")?1:0,allowdownload:h("#updraftcentral_modal #updraft_s3newapiuser_allowdownload").is(":checked")?1:0},e=h("#updraftcentral_modal");UpdraftCentral.send_site_rpc("updraftplus.s3_newuser",t,r,function(t,e,a){"ok"==e&&t&&(1==t.data.e?h("#updraftcentral_modal #updraft-s3newapiuser-results").html('<p style="color:red;">'+UpdraftCentral_Library.sanitize_html(t.data.m)+"</p>"):0==t.data.e&&(h("#updraftcentral_modal #updraft-s3newapiuser-results").html('<p style="color:green;">'+UpdraftCentral_Library.sanitize_html(t.data.m)+"</p>"),h(s+"#updraft_s3_apikey").val(t.data.k),h(s+"#updraft_s3_apisecret").val(t.data.s),h(s+"#updraft_s3_rrs").prop(":checked",t.data.r),h(s+"#updraft_s3_path").val(t.data.c),h(s+"#updraft_s3_newapiuser").html(udclion.updraftplus.now_using_iam),UpdraftCentral.close_modal()))},e)},udclion.updraftplus.create)},t)}),UpdraftCentral.register_row_clicker(t+"#updraft_cloudfiles_newapiuser",function(d){var t=this.closest("td");UpdraftCentral.send_site_rpc("updraftplus.get_fragment",{fragment:"cloudfiles_new_api_user_form",data:null},d,function(t,e,a){"ok"==e&&(e=UpdraftCentral.template_replace("updraftplus-cloudfiles_new_api_user",t.data.output),UpdraftCentral.open_modal(udclion.updraftplus.new_api_user,UpdraftCentral_Library.sanitize_html(e),function(){var t=h(this).closest(".modal-dialog").find(".form-table"),t={adminuser:t.find(".adminuser").val(),adminapikey:t.find(".adminapikey").val(),newuser:t.find(".newuser").val(),container:t.find(".container").val(),newemail:t.find(".newemail").val(),location:t.find(".location").val(),region:t.find(".region").val()},e=h(".modal-dialog");UpdraftCentral.send_site_rpc("updraftplus.cloudfiles_newuser",t,d,function(t,e,a){if("ok"==e){UpdraftCentral.close_modal();var e=t.data.u,r=t.data.k,n=t.data.c;d.find("#updraft_cloudfiles_user").val(e),d.find("#updraft_cloudfiles_apikey").val(r),d.find("#updraft_cloudfiles_path").val(n)}else if("error"===a)return UpdraftCentral_Library.dialog.alert("<h3>"+udclion.error+"</h3>"+t.m),!0},e)},udclion.updraftplus.create))},t)}),UpdraftCentral.register_row_clicker(t+"#updraftvault_connect_go",function(){h(s+"#updraftvault_connect_go").html(udclion.updraftplus.connecting);var t={email:h(s+"#updraftvault_email").val(),pass:h(s+"#updraftvault_pass").val(),instance_id:h(s+"#updraftvault_settings_connect").data("instance_id")};UpdraftCentral.send_site_rpc("updraftplus.vault_connect",t,UpdraftCentral.$site_row,function(t,e,a){h(s+"#updraftvault_connect_go").html(udclion.updraftplus.connect),"ok"==e&&t.hasOwnProperty("data")&&(t.data.hasOwnProperty("e")?(UpdraftCentral_Library.dialog.alert("<h2>"+udclion.error+"</h2><p>"+t.data.e+"</p>"),t.data.hasOwnProperty("code")&&"no_quota"==t.data.code&&(h(s+"#updraftvault_settings_connect").slideUp(),h(s+"#updraftvault_settings_default").slideDown())):t.data.hasOwnProperty("connected")&&t.data.connected&&t.data.hasOwnProperty("html")?(h(s+"#updraftvault_settings_connect").slideUp(),h(s+"#updraftvault_settings_connected").html(t.data.html).slideDown()):(console.log(t),UpdraftCentral_Library.dialog.alert("<h2>"+udclion.error+"</h2><p>"+udclion.js_exception_occurred+"</p>")))})})}),h("#updraftcentral_notice_container").on("click",".updraftplus_saved_settings a.updraft_authlink",function(t){var e,a,r=h(this).attr("href");void 0!==r&&(a=h(this).closest(".updraftplus_saved_settings").data("site_id"),(e=h('#updraftcentral_dashboard_existingsites .updraftcentral_site_row[data-site_id="'+a+'"')).length<1?console.log("UpdraftCentral: UpdraftPlus: site row not found for the link clicked (site_id="+a+")"):(t.preventDefault(),a=h(this).closest(".updraftplus_saved_settings"),UpdraftCentral_Library.open_browser_at(e,{module:"direct_url",url:r},a)))}),h("#updraftcentral_notice_container").on("click",".updraftcentral_listener .updraftplus_downloader_closebutton",function(t){t.preventDefault();t=h(this).closest(".updraftcentral_listener");h(this).closest(".updraftplus_downloader").fadeOut().remove(),t.find(".updraftplus_downloader").length<1&&(console.log(t),t.clearQueue().slideUp("slow",function(){h(this).remove()}))}),h("#updraftcentral_notice_container").on("click",".updraftcentral_listener .updraft_downloaded",function(t){var e,a,r,n=h(this).data("site_id"),n=h('#updraftcentral_dashboard_existingsites .updraftcentral_site_row[data-site_id="'+n+'"');n.length<1||(e=h(this).data("backup_timestamp"),a=h(this).data("what"),r=h(this).data("findex"),UpdraftCentral_Library.open_browser_at(n,{module:"updraftplus",action:"download_file",data:{backup_timestamp:e,what:a,findex:r}},null))}),h("#updraftcentral_notice_container").on("click",".updraftcentral_listener .updraft_delete_downloaded_backup",function(t){t.preventDefault();var r=this,t=h(this).data("site_id"),e=h('#updraftcentral_dashboard_existingsites .updraftcentral_site_row[data-site_id="'+t+'"'),a=h(this).data("findex"),n=h(this).data("what"),d=h(this).data("backup_timestamp");UpdraftCentral.send_site_rpc("updraftplus.delete_downloaded",{timestamp:d,site_id:t,type:n,findex:a},e,function(t,e,a){"ok"==e&&!1!==t&&t.hasOwnProperty("data")&&h(r).closest(".raw").html(udclion.updraftplus.entity_deleted)})}),h("#updraftcentral_notice_container, #updraftcentral_dashboard_existingsites").on("click",".updraftcentral_listener .updraft-log-link, .updraft_existing_backups_output .updraft-log-link",function(t){t.preventDefault();var e,r,t=h(this).data("jobid");t?(e=h(this).closest(".updraftcentral_listener, .updraftcentral_site_row").data("site_id"),e=h('#updraftcentral_dashboard_existingsites .updraftcentral_site_row[data-site_id="'+e+'"'),r=t,UpdraftCentral.send_site_rpc("updraftplus.get_log",r,e,function(t,e,a){"ok"==e&&t&&UpdraftCentral.open_modal(udclion.updraftplus.logfile,'<pre id="updraft_poppedlog">'+UpdraftCentral_Library.sanitize_html(t.data.log)+"</pre>",function(){UpdraftCentral_Library.download_inner_html("log."+r+".txt","updraft_poppedlog")},udclion.updraftplus.downloadlog,function(){},null,!0,"modal-lg")})):(console.log(this),console.log("UpdraftPlus: A log link was clicked, but the Job ID could not be found"))}),h("#updraftcentral_notice_container").on("click",".updraftcentral_listener .updraft_jobinfo_delete",function(t){t.preventDefault();var e,a,r,t=h(this).data("jobid");t?(a=(e=h(this).closest(".updraftcentral_listener")).data("site_id"),a=h('#updraftcentral_dashboard_existingsites .updraftcentral_site_row[data-site_id="'+a+'"'),r=e,UpdraftCentral.send_site_rpc("updraftplus.activejobs_delete",t,a,function(t,e,a){"ok"==e&&t&&(e="",e=t.hasOwnProperty("data")&&t.data.hasOwnProperty("c")?"deleted"==t.data.c?udclion.updraftplus.delete_deleted:"not_found"==t.data.c?udclion.updraftplus.delete_not_found:(console.log("UDCentral: UpdraftPlus: abort job: unknown response"),console.log(t.data),UpdraftCentral_Library.sanitize_html(t.data.m)):(console.log("UDCentral: UpdraftPlus: abort job: unknown response"),console.log(t.data),udclion.js_exception_occurred),h(r).find(".backup_state:first").html(e))})):(console.log("UpdraftPlus: A stop job link was clicked, but the Job ID could not be found"),console.log(this))});var x,U,C=!1,j=!1;function r(t,e){var a="#updraftcentral_dashboard_existingsites .updraft_site_settings_output #"+t,r="monthly"==e,n=!1;10<h(a+" option").length&&(n=!0),(r||n)&&(r&&n?"monthly"==e&&(h("#updraftcentral_dashboard_existingsites .updraft_site_settings_output .updraft_monthly_extra_words_"+t).remove(),h(a).before('<span class="updraft_monthly_extra_words_'+t+'">'+udclion.updraftplus.day+" </span>").after('<span class="updraft_monthly_extra_words_'+t+'"> '+udclion.updraftplus.in_the_month+" </span>")):(h("#updraftcentral_dashboard_existingsites .updraft_site_settings_output .updraft_monthly_extra_words_"+t).remove(),r?(C=h(a+" option:selected").val(),h(a).html(udclion.updraftplus.mday_selector).before('<span class="updraft_monthly_extra_words_'+t+'">'+udclion.updraftplus.day+" </span>").after('<span class="updraft_monthly_extra_words_'+t+'"> '+udclion.updraftplus.in_the_month+" </span>"),n=!1===j?1:j,h(a+" option:eq("+(n-=1)+")").prop("selected",!0)):(j=h(a+" option:selected").val(),h(a).html(udclion.updraftplus.day_selector),h(a+" option:eq("+(!1===C?1:C)+")").prop("selected",!0))))}function b(t,e,a,r,n){var d="updraft_retain_"+t+"_rules",s="db"==t?++x:++U;h("#"+d).append('<div style="float:left; clear:left;" class="updraft_retain_rules '+d+'_entry">'+udclion.updraftplus.for_backups_older_than+" "+P(t,s,"after",e,a)+" keep no more than 1 backup every "+P(t,s,"every",r,n)+' <span title="'+udclion.updraftplus.delete+'" class="updraft_retain_rules_delete"><span class="dashicons dashicons-no"></span></span></div>')}function P(t,e,a,r,n){t="updraft_retain_extrarules["+t+"]["+e+"]["+a+"-",e='<input type="number" min="1" step="1" class="additional-rule-width" name="'+t+'howmany]" value="'+r+'"> \t\t<select name="'+t+'period]">\t\t<option value="3600"';return 3600==n&&(e+=' selected="selected"'),e+=">"+udclion.updraftplus.hours+'</option>\t\t<option value="86400"',86400==n&&(e+=' selected="selected"'),e+=">"+udclion.updraftplus.days+'</option>\t\t<option value="604800"',604800==n&&(e+=' selected="selected"'),e+=">"+udclion.updraftplus.weeks+"</option>\t\t</select>"}function Q(t,e){h(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_include_"+t).is(":checked")?e?h(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_include_"+t+"_exclude").show():h(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_include_"+t+"_exclude").slideDown():e?h(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_include_"+t+"_exclude").hide():h(".updraftcentral_row_extracontents .updraft_site_settings_output #updraft_include_"+t+"_exclude").slideUp()}var O=1;function D(t){var e="#updraftcentral_dashboard_existingsites .updraftcentral_row_extracontents .updraft_site_settings_output";h(e+" .updraftplusmethod").hide(),h(e+" .remote-tab").data("active",!1),h(e+" .remote-tab").removeClass("nav-tab-active"),h(e+" .updraftplusmethod."+t).show(),h(e+" .remote-tab-"+t).data("active",!0),h(e+" .remote-tab-"+t).addClass("nav-tab-active")}var m=0}jQuery(function(t){UpdraftCentral_Module_UpdraftPlus=new UpdraftCentral_UpdraftPlus_Module,jQuery(document).on("keyup",function(t){32!==t.keyCode&&13!==t.keyCode||!jQuery(document.activeElement).is("input.labelauty + label")||(t=jQuery(document.activeElement).attr("for"))&&jQuery("#"+t).trigger("change")}),Handlebars.registerHelper("maskPassword",function(t){return t.replace(/./gi,"*")}),Handlebars.registerHelper("encodeURIComponent",function(t){return encodeURIComponent(t)}),Handlebars.registerHelper("ifCond",function(t,e,a,r){switch(e){case"==":return t==a?r.fn(this):r.inverse(this);case"===":return t===a?r.fn(this):r.inverse(this);case"!=":return t!=a?r.fn(this):r.inverse(this);case"!==":return t!==a?r.fn(this):r.inverse(this);case"<":return t<a?r.fn(this):r.inverse(this);case"<=":return t<=a?r.fn(this):r.inverse(this);case">":return a<t?r.fn(this):r.inverse(this);case">=":return a<=t?r.fn(this):r.inverse(this);case"&&":return t&&a?r.fn(this):r.inverse(this);case"||":return t||a?r.fn(this):r.inverse(this);case"typeof":return t===typeof a?r.fn(this):r.inverse(this);case"not_typeof":return t!==typeof a?r.fn(this):r.inverse(this);default:return r.inverse(this)}}),Handlebars.registerHelper("for",function(t,e,a,r){for(var n="",d=t;d<e;d+=a)n+=r.fn(d);return n}),Handlebars.registerHelper("set_var",function(t,e,a){a.data.root||(a.data.root={}),a.data.root[t]=e}),Handlebars.registerHelper("get_length",function(t){return void 0!==t&&!1==t instanceof Array?Object.keys(t).length:!0==t instanceof Array?t.length:0})});