jQuery(function(r){r("#updraftcentral_dashboard_existingsites").on("updraftcentral_dashboard_mode_set_advancedtools",function(){UpdraftCentral.register_row_clicker(".updraftcentral_site_advanced_settings",function(a){UpdraftCentral.send_site_rpc("updraftplus.get_advanced_settings",{suppress_plugins_for_debugging:!0},a,function(t,e,n){"ok"===e&&a.find(".updraftcentral_row_extracontents").empty().append(UpdraftCentral_Library.sanitize_html(t.data))})},!0),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_menu .advanced_tools_button",function(t){var e;e=this.id,r('.expertmode .advanced_settings_container .advanced_tools:not(".'+e+'")').hide(),r(".expertmode .advanced_settings_container .advanced_tools."+e).fadeIn("slow"),r(".expertmode .advanced_settings_container .advanced_tools_button:not(#"+e+")").removeClass("active"),r(".expertmode .advanced_settings_container .advanced_tools_button#"+e).addClass("active")}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content a.updraft_diskspaceused_update",function(a){a.find(".updraft_diskspaceused").html("<em>"+udclion.advancedtools.calculating+"</em>"),UpdraftCentral.send_site_rpc("updraftplus.get_fragment",{fragment:"disk_usage",data:"updraft"},a,function(t,e,n){"ok"==e&&t&&a.find(".updraft_diskspaceused").html(UpdraftCentral_Library.sanitize_html(t.data.output))})}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content .site_info #updraftplus-phpinfo",function(t,e){UpdraftCentral.send_site_rpc("core.phpinfo",null,t,function(t,e,n){var a;"ok"==e&&t.data&&(a="",r.each(t.data,function(t,e){a+="<h3>"+t+"</h3>\n<table>\n",r.each(e,function(t,e){e.constructor===Array?a+="<tr><td>"+t+"</td><td>"+e[0]+"</td><td>"+e[1]+"</td></tr>\n":"string"==typeof e?r.isNumeric(t)?a+="<tr><td></td><td>"+e+"</td></tr>\n":a+="<tr><td>"+t+"</td><td>"+e+"</td></tr>\n":(console.log("UpdraftCentral: phpinfo: Unrecognised output for key "+t+" (follows)"),console.log(e))}),a+="</table>\n"}),UpdraftCentral.open_modal(udclion.advancedtools.php_info,'<div id="updraftcentral_phpinfo_results">'+a+"</div>",null,!1,null,!0,"modal-lg"))},r(this))}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content .site_info #updraftplus_httpget_go",function(t,e){data=r("#updraftplus_httpget_uri").val(),UpdraftCentral.send_site_rpc("updraftplus.http_get",data,t,function(t,e,n){UpdraftCentral.open_modal(udclion.advancedtools.response,"<p>"+UpdraftCentral_Library.sanitize_html(t.data.response)+"</p>",null,!1,null,!0)})}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content .site_info #updraftplus_httpget_gocurl",function(t,e){var n=r("#updraftplus_httpget_uri").val();UpdraftCentral.send_site_rpc("updraftplus.http_get_curl",n,t,function(t,e,n){UpdraftCentral.open_modal(udclion.advancedtools.response,"<p><pre>"+UpdraftCentral_Library.sanitize_html(t.data.response)+"</pre></p>",null,!1,null,!0,"modal-lg")})}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content .site_info #updraftplus_callwpaction_go",function(t,e){var n={wpaction:r("#updraftplus_callwpaction").val()};UpdraftCentral.send_site_rpc("core.call_wordpress_action",n,t,function(t,e,n){UpdraftCentral.open_modal(udclion.advancedtools.response,"<p>"+UpdraftCentral_Library.sanitize_html(t.data.response)+"</p>",null,!1,null,!0)})}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content .site_info #updraft_reset_sid",function(t,e){UpdraftCentral.send_site_rpc("updraftplus.reset_site_id",null,t,function(t,e,n){r("#updraft_show_sid").text(t.data)})}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content .site_info #updraftplus-rawbackuphistory",function(t,e){UpdraftCentral.send_site_rpc("updraftplus.show_raw_backup_and_file_list",null,t,function(t,e,n){UpdraftCentral.open_modal(udclion.advancedtools.raw_backup_history,'<pre><div id="raw_backup_modal">'+UpdraftCentral_Library.sanitize_html(t.data)+"</div></pre>",null,!1,null,!0,"modal-lg")})}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content .lock_admin .change_lock_settings",function(t,e){var a={old_password:r("#updraft_unlockadmin_oldpassword").val(),password:r("#updraft_unlockadmin_password").val(),session_length:r("#updraft_unlockadmin_session_length").val(),support_url:r("#updraft_unlockadmin_support_url").val()};UpdraftCentral.send_site_rpc("updraftplus.change_lock_settings",a,t,function(t,e,n){r("#updraft_unlockadmin_oldpassword").val(a.password),message=""==a.password?udclion.advancedtools.settings_unlocked:udclion.advancedtools.password_changed_to+" '"+a.password+"' ",UpdraftCentral.open_modal(udclion.advancedtools.lock_changed,"<p>"+message+"</p>",null,!1,null,!0)})}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content .updraft_central .updraft_debugrow .updraftcentral_key_delete",function(a,t){var e=r(this).data("key_id");UpdraftCentral.send_site_rpc("updraftplus.delete_key",e,a,function(t,e,n){a.find("#updraftcentral_keys").replaceWith(t.data.keys_table)})}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content .updraft_central #updraftcentral_view_log",function(t,e){UpdraftCentral.send_site_rpc("updraftplus.fetch_log",null,t,function(t,e,n){UpdraftCentral.open_modal(udclion.advancedtools.log,"<pre>"+UpdraftCentral_Library.sanitize_html(t.data.log_contents)+"</pre>",function(){},!1,null,!1,"modal-lg")})}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content .search_replace #search_replace_form .search_and_replace",function(t,e){var n={search:t.find("#search").val(),replace:t.find("#replace").val(),pagesize:t.find("#pagesize").val(),whichtables:t.find("#whichtables").val(),show_return_link:!1,show_heading:!1};UpdraftCentral.send_site_rpc("updraftplus.search_replace",n,t,function(t,e,n){UpdraftCentral.open_modal(udclion.advancedtools.response,"<h2>"+udclion.advancedtools.search_replace+"</h2><pre>"+UpdraftCentral_Library.sanitize_html(t.data.log)+"</pre>",null,!1,null,!0)})}),UpdraftCentral.register_modal_listener(".return_to_updraft",function(t){t.preventDefault(),UpdraftCentral.close_modal()}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content .total_size .count",function(t){var a=r(this).data("type");jQuery("#updraft_diskspaceused_"+a).html("<em>"+udclion.advancedtools.calculating+"</em>");var e=r(this).closest(".updraftcentral_site_row");UpdraftCentral.send_site_rpc("core.count",a,e,function(t,e,n){jQuery("#updraft_diskspaceused_"+a).html(t.data)})}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content #updraftplus-settings-export",function(a,t){UpdraftCentral.send_site_rpc("updraftplus.get_settings",{include_database_decrypter:0,include_adverts:0,include_save_button:1},a,function(t,e,n){!function(t,e){var n=function(t){r("body").append('<div class="hidden_udp_settings" style="display:none;">'+t+"</div>");var n=r(".hidden_udp_settings input[name!='action'], .hidden_udp_settings textarea, .hidden_udp_settings select").serialize();return r.each(r(".hidden_udp_settings input[type=checkbox]").filter(function(t){return 0==r(this).prop("checked")}),function(t,e){n+="&"+r(e).attr("name")+"=0"}),r(".hidden_udp_settings").remove(),n}(t).split("&"),d={};r.each(n,function(t,e){var n=e.split("="),a=decodeURIComponent(n[0]);if(0<=a.indexOf("option_page")||0<=a.indexOf("_wpnonce")||0<=a.indexOf("_wp_http_referer"))return!0;0<=a.indexOf("[")?(e=a.match(/\[(.*)\]/).pop(),a=a.substring(0,a.indexOf("[")),e&&"0"!==e?(void 0===d[a]&&(d[a]={}),d[a][e]=decodeURIComponent(n[1])):(void 0===d[a]&&(d[a]=[]),d[a].push(decodeURIComponent(n[1])))):d[a]=decodeURIComponent(n[1])});t=new Date;n=JSON.stringify({version:"1.12.19",epoch_date:t.getTime(),local_date:t.toLocaleString(),network_site_url:e.data("site_url"),data:d}),r("body").append('<div id="udc_exported_settings" style="display:none;">'+n+"</div>"),UpdraftCentral_Library.download_inner_html("updraftplus-settings.json","udc_exported_settings","text/json"),r("#udc_exported_settings").remove()}(UpdraftCentral_Library.sanitize_html(t.data.settings),a)})}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content #updraftplus-settings-import",function(t,e){var n,a=document.getElementById("import_settings");0!=a.files.length?(n=a.files[0],(a=new FileReader).onload=function(){var t,e;t=this.result,e=decodeURIComponent(t),e=JSON.parse(e),UpdraftCentral_Library.dialog.confirm(udclion.advancedtools.importing_data_from+" "+e.network_site_url+"\n"+udclion.advancedtools.exported_on+" "+e.local_date+"\n"+udclion.advancedtools.continue_import,function(t){t&&(e=e.data,UpdraftCentral.send_site_rpc("updraftplus.save_settings",e,$site_row,function(t,e,n){message="ok"===e?udclion.advancedtools.import_success:udclion.advancedtools.import_failed,UpdraftCentral.open_modal(udclion.advancedtools.import_settings,"<p>"+message+"</p>",null,!1,null,!0)}))})},a.readAsText(n)):UpdraftCentral_Library.dialog.alert(udclion.advancedtools.import_select_file)}),UpdraftCentral.register_row_clicker(".advanced_settings_container .advanced_settings_content .updraft_wipe_settings",function(t,e){UpdraftCentral.send_site_rpc("updraftplus.wipe_settings",null,t,function(t,e,n){message=1==t.data?udclion.advancedtools.settings_wiped:udclion.advancedtools.wipe_settings_error,UpdraftCentral.open_modal(udclion.advancedtools.wipe_settings,"<p>"+message+"</p>",null,!1,null,!0)})})})});