function UpdraftCentral_WPO_Management(){var s,r,f,g,m,h=this,w=jQuery,l=new UpdraftCentral_Queue,p=new UpdraftCentral_Collection,n=UpdraftCentral.get_debug_level(),_="WP-Optimize",d="wp-optimize",c="WP-Optimize Premium",u="wp-optimize-premium",v={};function b(t,e,i){var n=!1,o=!1,a=i;return s=i,r=d,t||(n=!0,-1!==a.indexOf("Premium")&&(a=a.replace(" Premium",""))),a={action:{install_and_activate:n,activate:o=!e&&t?!0:o,messages:{not_installed:vsprintf(udclion.plugin_not_installed,[a]),install_and_activate:udclion.plugin_install_and_activate,not_activated:vsprintf(udclion.plugin_not_activated,[s]),activate:udclion.plugin_activate}}},UpdraftCentral.template_replace("wpo-wpo-not_active",a)}function i(n,o){var a="",s=D(n);UpdraftCentral.set_loading(s),F(n,_,d).then(function(t){var i;t.installed&&t.active?h.load_contents(n,o):(h.current_section=o,!t.installed||t.installed&&!t.active?(i=!(!t.installed||t.active),F(n,c,u).then(function(t){var e;t.installed&&t.active?h.load_contents(n,o):(e=!(!t.installed||t.active),a=!e&&i?b(!0,!1,_):b(t.installed,t.active,c),UpdraftCentral.done_loading(s,a))}).fail(function(t){P(t),UpdraftCentral.done_loading(s,a)})):!t.active&&t.installed&&(a=b(t.installed,t.active,_),UpdraftCentral.done_loading(s,a)))}).fail(function(t){P(t),UpdraftCentral.done_loading(s,a)})}function z(){0===w(".wpo_scheduled_event:visible").length?(w(".wpo_auto_event_heading_container").hide(),w(".wpo_no_schedules").show()):(w(".wpo_auto_event_heading_container").show(),w(".wpo_no_schedules").hide()),0!==w(".wpo_scheduled_event:visible").length||0!==w(".wpo_auto_event:visible").length||w("#save_settings_reminder").is(":visible")?w(".wpo_no_schedules").hide():w(".wpo_no_schedules").show()}function y(){w(".wpo_auto_optimizations").select2({placeholder:g.select_optimizations}),w(".wpo_auto_optimizations").off("select2:open").on("select2:open",function(){w.fullscreen.isFullScreen()&&w(document.body).children("span.select2-container--open").appendTo("#updraftcentral_dashboard")}),w(".wpo_auto_optimizations").off("select2:opening select2:closing").on("select2:opening select2:closing",function(t){w(this).parent().find(".select2-search__field").prop("disabled",!0)})}function k(t){confirm(g.are_you_sure_you_want_to_remove_logging_destination)&&(t.closest(".wpo_logging_row, .wpo_add_logger_form").remove(),w(".wpo_logger_type").each(function(){U(w(this))}),0==w("#wp-optimize-logging-options .wpo_logging_row").length&&w("#wp-optimize-logging-options").hide(),C())}function C(){var t=w("#wp-optimize-logger-settings .save_settings_reminder");t.is(":visible")||t.slideDown("normal")}function U(t){var e,i,n,o=(n=[],w(".wpo_logging_row, .wpo_logger_type").each(function(){var t=w(this).is("select")?w(this).val():w(this).data("id");t&&n.push(t)}),n);for(e in o)i=o[e],g.loggers_classes_info[i].allow_multiple?w('option[value="'+i+'"]',t).show():w('option[value="'+i+'"]',t).hide()}function x(t){var e,i,n;if(t)for(e in t)t.hasOwnProperty(e)&&(i=["#wp-optimize-settings-",t[e].dom_id].join(""),n=t[e].info?t[e].info.join("<br>"):"",w(i+" .wp-optimize-settings-optimization-info").html(n))}function j(){var e=[];return w('#wpo_settings_sites_list input[type="checkbox"]').each(function(){var t=w(this);t.is(":checked")&&e.push(t.attr("value"))}),e}function O(t,e){var i,n=0,o=0;e.each(function(){w(this).is(":checked")&&o++,n++}),t.next().is("label")&&t.next().data("label")&&(e=(i=t.next()).data("label"),n==o?i.text(e):i.text(e.replace("all",[o," of ",n].join("")))),n==o?t.prop("checked",!0):t.prop("checked",!1)}function D(t){var e=t.find(".updraftcentral_row_extracontents"),t=e.find(".updraftcentral_wpo_rows");return t=0===t.length?w('<div class="updraftcentral_wpo_rows"></div>').appendTo(e):t}function P(t){var e;void 0===t.data||null!==(e=t.data)&&void 0!==e.message&&(void 0===(t=udclion.wpo[e.message])&&void 0===(t=udclion[e.message])&&(t=udclion.unknown_response),void 0!==e.values?UpdraftCentral_Library.dialog.alert("<h2>"+udclion.error+"</h2><p>"+vsprintf(t,e.values)+"</p>"):UpdraftCentral_Library.dialog.alert("<h2>"+udclion.error+"</h2><p>"+t+"</p>"))}function $(t){var i="";return"object"==(t=void 0===t?"string":t)?i=w(".updraftcentral_wpo_rows form input[name!='action'], .updraftcentral_wpo_rows form textarea, .updraftcentral_wpo_rows form select").serializeJSON({useIntKeysAsArrayIndex:!0}):(i=w(".updraftcentral_wpo_rows form input[name!='action'], .updraftcentral_wpo_rows form textarea, .updraftcentral_wpo_rows form select").serialize(),w.each(w(".updraftcentral_wpo_rows form input[type=checkbox]").filter(function(t){return 0==w(this).prop("checked")}),function(t,e){i+="&"+w(e).attr("name")+"=0"})),i}function q(){w("#enable-schedule").is(":checked")?w("#wp-optimize-auto-options").css("opacity","1"):w("#wp-optimize-auto-options").css("opacity","0.5")}function S(){w("#wp-optimize-logger-updraft_ring_logger").is(":checked")?w("#additional_options_updraft_ring_logger").show():w("#additional_options_updraft_ring_logger").hide()}function M(){w("#wp-optimize-logger-updraft_slack_logger").is(":checked")?w("#additional_options_updraft_slack_logger").show():w("#additional_options_updraft_slack_logger").hide()}function W(t,e){var i=w.Deferred();return T({name:"do_optimization",arguments:t},e).then(function(t){i.resolve(t)}).fail(function(t){i.reject(t)}),i.promise()}function T(t,e){var n=w.Deferred();return UpdraftCentral.send_site_rpc("wpoptimize."+t.name,t.arguments,e,function(t,e,i){"ok"!==e||void 0===t.data||null===t.data||t.data.error?n.reject(t):n.resolve(t.data)}),n.promise()}function F(t,e,i){return UpdraftCentral.is_plugin_active(t,e,i)}function a(i,t){!0!==w(".optimization_button_"+i).prop("disabled")&&(w("#optimization_checkbox_"+i).hide(),w("#optimization_spinner_"+i).show(),w(".optimization_button_"+i).prop("disabled",!0),w("#optimization_info_"+i).html("..."),"optimizetables"==i?w(f).each(function(t){var e=w(this).find("td");table_type=e.eq(5).text(),table=e.eq(1).text(),optimizable=e.eq(5).data("optimizable"),""!=table&&"1"==optimizable&&(e={optimization_id:i,optimization_table:e.eq(1).text(),optimization_table_type:table_type},l.enqueue(e))}):l.enqueue(i),function a(s){if(l.get_lock()){0<n&&console.log("WP-Optimize: process_queue(): got queue lock");var r=l.peek();if("object"==typeof r?r=(data=r).optimization_id:data={},void 0===r)return w(document).trigger("updraftcentral_wpo_opimization_end",[s]),0<n&&console.log("WP-Optimize: process_queue(): queue is apparently empty - exiting"),void l.unlock();0<n&&console.log("WP-Optimize: process_queue(): processing item: "+r),l.dequeue(),W({optimization_id:r,data:data},s).then(function(t){if(w("#optimization_spinner_"+r).hide(),w("#optimization_checkbox_"+r).show(),w(".optimization_button_"+r).prop("disabled",!1),t){for(var e="",i=0,n=t.errors.length;i<n;i++)e+='<span class="error">'+t.errors[i]+"</span><br>";for(i=0,n=t.messages.length;i<n;i++)e+=t.errors[i]+"<br>";for(var o,i=0,n=t.result.output.length;i<n;i++)e+=t.result.output[i]+"<br>";w("#optimization_info_"+r).html(e),t.hasOwnProperty("status_box_contents")&&(w("#wp_optimize_status_box").css("opacity","1").find(".inside").html(t.status_box_contents),w("a#wp_optimize_status_box_refresh").attr("href","#"),UpdraftCentral.register_event_handler("click","a#wp_optimize_status_box_refresh",function(){h.load_contents(s,"wp_optimize")})),t.hasOwnProperty("table_list")&&w("#wpoptimize_table_list tbody").replaceWith(t.table_list),t.hasOwnProperty("total_size")&&w("#optimize_current_db_size").html(t.total_size),"optimizetables"===r&&data.optimization_table&&(o=l.peek(),l.is_empty()||void 0===o.optimization_table?(w("#optimization_spinner_"+r).hide(),w("#optimization_checkbox_"+r).show(),w(".optimization_button_"+r).prop("disabled",!1),w("#optimization_info_"+r).html(udclion.wpo.optimization_complete)):(w("#optimization_checkbox_"+r).hide(),w("#optimization_spinner_"+r).show(),w(".optimization_button_"+r).prop("disabled",!0))),t.result.meta&&t.result.meta.hasOwnProperty("awaiting_mod")&&(0<(o=t.result.meta.awaiting_mod)?w("#adminmenu .awaiting-mod .pending-count").remove(o):w("#adminmenu .awaiting-mod").remove())}setTimeout(function(){l.unlock(),a(s)},10)})}else 0<n&&console.log("WP-Optimize: process_queue(): queue is currently locked - exiting")}(t))}w("#updraftcentral_dashboard_existingsites").on("updraftcentral_dashboard_mode_set_wpo",function(){UpdraftCentral.register_row_clicker(".updraftcentral_site_wp_optimize",function(t){i(t,"wp_optimize")},!0),UpdraftCentral.register_row_clicker(".updraftcentral_site_table_information",function(t){i(t,"table_information")},!0),UpdraftCentral.register_row_clicker(".updraftcentral_site_settings",function(t){i(t,"settings")},!0),UpdraftCentral.register_row_clicker("#btn-activate",function(e){var t,i,n=D(e);UpdraftCentral.set_loading(n),t=s,i=r,UpdraftCentral.activate_plugin(e,t,i).then(function(t){t.activated&&h.load_contents(e,h.current_section)}).fail(function(t){P(t),UpdraftCentral.done_loading(n)})},!0),UpdraftCentral.register_row_clicker("#btn-install-activate",function(e){var i=D(e);UpdraftCentral.set_loading(i),UpdraftCentral.install_activate_plugin(e,_,d).then(function(t){(t.installed||t.activated)&&h.load_contents(e,h.current_section)}).fail(function(t){P(t),UpdraftCentral.done_loading(i)})},!0)}),w(document).on("updraftcentral_wpo_opimization_start",function(t,e){void 0!==e&&D(e).css("opacity","0.3")}),w(document).on("updraftcentral_wpo_opimization_end",function(t,e){void 0!==e&&(D(e).css("opacity","1.0"),T({name:"optimizations_done",arguments:{}},e),e.find("table#optimizations_list tr").each(function(){var t=w(this).data("optimization_id");w(this).find("#optimization_spinner_"+t).is(":visible")&&(w(this).find("#optimization_spinner_"+t).hide(),w(this).find("#optimization_checkbox_"+t).show(),w(this).find(".optimization_button_"+t).prop("disabled",!1),"optimizetables"===t&&w(this).find("#optimization_info_"+t).html(udclion.wpo.optimization_complete))}))}),w("#updraftcentral_dashboard_existingsites").on("updraftcentral_listener_finished_updraftplus_backup",function(t,e){t.preventDefault(),void 0!==e.site_id?(t="site_"+e.site_id,p.exists(t)&&((e=p.item(t)).autobackup_complete||(t=e.autobackup_options,e.autobackup_complete=!0,void 0!==t&&void 0!==t.callback&&t.callback.apply(null,[])))):0<n&&console.log("WP-Optimize: unexpected site id was returned - exiting")}),this.toggle_feature=function(t,e,i){var n,o=D(i);void 0!==e&&e.length&&(e="enable"===(e=(e=e.attr("id").split("-"))[e.length-1]),UpdraftCentral.set_loading(o),t=t,e=e,i=i,n=w.Deferred(),T({name:"enable_or_disable_feature",arguments:{type:t,enable:e?1:0}},i).then(function(t){n.resolve(t)}).fail(function(t){n.reject(t)}),n.promise().then(function(t){void 0!==t.output&&t.output.length&&UpdraftCentral_Library.dialog.alert("<h2>"+udclion.wpo.feature_update_heading+"</h2><p>"+t.output[0]+"</p>")}).fail(function(t){P(t)}).always(function(){UpdraftCentral.done_loading(o)}))},this.save_settings=function(t){var e,i,n,o=D(t),a=$(),s=(i=0,w("#wpo_auto_events .wpo_auto_event").each(function(){0===w(this).find("ul.select2-selection__rendered > li.select2-selection__choice").length&&i++}),i);if(!function(){var t=!0,e=g.fill_all_settings_fields;w("ul.select2-selection__rendered").each(function(){0===w(this).find("li.select2-selection__choice").length?(t=!1,e=g.fill_all_fields,w(this).closest(".select2-selection--multiple").addClass("wpo_error_field")):w(this).closest(".select2-selection--multiple").removeClass("wpo_error_field")}),w(".wpo_schedule_type, .wpo_logger_addition_option, .wpo_logger_type").each(function(){!function(t,e){var i=t.val(),t=t.data("validate");if(!t&&e)return""!=w.trim(i);if(t&&!e&&""==w.trim(i))return!0;var n=!0;switch(t){case"email":for(var o=/\S+@\S+\.\S+/,a=i.split(","),s="",r=0;r<a.length;r++)""!=(s=w.trim(a[r]))&&o.test(s)||(n=!1);break;case"url":n=(o=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,}))\.?)(?::\d{2,5})?(?:[/?#]\S*)?$/i).test(i)}return n}(w(this),!0)?(t=!1,w(this).addClass("wpo_error_field")):w(this).removeClass("wpo_error_field")}),t?w("#wp-optimize-logger-settings .save_settings_reminder").slideUp():w("#wp-optimize-settings-save-results").show().addClass("wpo_alert_notice").text(e).delay(5e3).fadeOut(3e3,function(){w(this).removeClass("wpo_alert_notice")});return t}())return!1;0<s?UpdraftCentral_Library.dialog.alert("<h2>"+udclion.wpo.save_settings_heading+"</h2><p>"+udclion.wpo.empty_schedule+"</p>"):(UpdraftCentral.set_loading(o),s=a,a=t,n=w.Deferred(),T({name:"save_settings",arguments:s},a).then(function(t){n.resolve(t)}).fail(function(t){n.reject(t)}),n.promise().then(function(t){void 0!==t.save_results&&(e=t.save_results)}).fail(function(t){P(t)}).always(function(){UpdraftCentral.done_loading(o).then(function(){void 0!==e&&(void 0!==e.errors&&e.errors.length?UpdraftCentral_Library.dialog.alert("<h2>"+udclion.wpo.save_settings_heading+"</h2><p>"+e.errors[0]+"</p>"):(UpdraftCentral_Library.dialog.alert("<h2>"+udclion.wpo.save_settings_heading+"</h2><p>"+e.messages[0]+"</p>"),h.load_contents(t,"settings")))})}))},this.run_optimization_single=function(t,i){w(document).trigger("updraftcentral_wpo_opimization_start",[i]),h.pre_optimization_run(i,!1,function(){var e=w(t).closest(".wp-optimize-settings").data("optimization_id");e?h.pre_save_options(i,function(t){w("#wpo_settings_sites_list").length?h.save_sites_list({"wpo-sites":j()},i).then(function(t){a(e,i)}):a(e,i)}):console.log("Optimization ID corresponding to pressed button not found")})},this.run_optimization_all=function(o){w(document).trigger("updraftcentral_wpo_opimization_start",[o]),h.pre_optimization_run(o,!0,function(){h.pre_save_options(o,function(n){if(w("#wpo_settings_sites_list").length)h.save_sites_list({"wpo-sites":j()},o).then(function(t){for(var e in n){var i=n[e];void 0!==i.active&&1==i.active&&a(e,o)}});else for(var t in n){var e=n[t];void 0!==e.active&&1==e.active&&a(t,o)}})})},this.pre_save_options=function(t,e){var i,n,o,a=(i={},$optimizations=w("#optimizations_list .optimization_checkbox:checked"),$optimizations.sort(function(t,e){return t=w(t).closest(".wp-optimize-settings").data("optimization_run_sort_order"),(e=w(e).closest(".wp-optimize-settings").data("optimization_run_sort_order"))<t?1:t<e?-1:0}),$optimizations.each(function(t){var e=w(this).closest(".wp-optimize-settings").data("optimization_id");e?i[e]={active:1}:console.log("Optimization ID corresponding to pressed button not found")}),i);n=a,t=t,o=w.Deferred(),T({name:"save_manual_run_optimization_options",arguments:n},t).then(function(t){o.resolve(t)}).fail(function(t){o.reject(t)}),o.promise().then(function(t){e.apply(null,[a])}).fail(function(t){P(t)})},this.pre_optimization_run=function(n,t,o){if(void 0!==t&&t&&!1===confirm(udclion.wpo.warning))return void D(n).css("opacity","1.0");var e,i,a=!1;w("#enable-auto-backup").is(":checked")&&(a=!0),e=a,t=n,i=w.Deferred(),T({name:"save_auto_backup_option",arguments:{auto_backup:e}},t).then(function(t){i.resolve(t)}).fail(function(t){i.reject(t)}),i.promise().then(function(t){var e,i="site_"+n.data("site_id");p.exists(i)&&(e=p.item(i),a&&!e.autobackup_complete?(i={_listener_title:"<h2>"+n.data("site_description")+" - "+udclion.wpo.automatic_backup+"</h2>"},e.autobackup_options={callback:o},UpdraftCentral.set_current_site_row(n),UpdraftCentral_Module_UpdraftPlus.backupnow_go(!1,!1,!1,"",i,udclion.wpo.automatic_backup,"")):o.apply(null,[]))}).fail(function(t){P(t)})},this.load_contents=function(_,d){var c="",u=D(_),t="site_"+_.data("site_id");p.exists(t)||(i=new UpdraftCentral_Site(_),p.add(t,i));var i={name:"get_"+d+"_contents",arguments:{}};UpdraftCentral.set_loading(u),T(i,_).then(function(t){void 0!==t&&(void 0!==t.content?(c=t.content,g=t.translations):c=t)}).fail(function(t){t=P(t)}).always(function(){UpdraftCentral.done_loading(u,c).then(function(){var i,t,n,o,a,s,r,l,p;c&&c.length?(w("img.optimization_spinner, img#wpo_import_spinner").attr("src",udclion.wpo.images+"spinner-2x.gif").attr("alt","").addClass("wp_uc_spinner"),u.find(".wpo_section .button").addClass("btn"),u.find(".wpo_section .button-primary").addClass("btn-primary"),u.find(".wpo_section .button-secondary").addClass("btn-secondary"),u.find("a#wp_optimize_status_box_refresh").attr("href","#"),void 0!==(n=u.find("input#wp-optimize-settings-save"))&&n.length&&(btn_save_clone=n.clone(),btn_save_clone.attr("type","button"),n.replaceWith(btn_save_clone)),void 0!==(o=u.find("input#wp-optimize"))&&o.length&&(btn_optimize_clone=o.clone(),btn_optimize_clone.attr("type","button"),o.replaceWith(btn_optimize_clone)),w("#optimizations_list .wp-optimize-settings-optimization-info a").each(function(){w(this).attr("target","_blank")}),q(),S(),M(),"wp_optimize"===d&&h.get_optimization_tables(_).then(function(t){t=w("<div>").html(t.table_list);f=t.find("tbody#the-list tr")}),s=w("#wpoptimize_table_list_filter"),r=w("#wpoptimize_table_list"),l=w("#wpoptimize_table_list tbody:last"),p=w("#wpoptimize_table_list_tables_not_found"),r.tablesorter({theme:"default",widgets:["zebra","rows","filter"],cssInfoBlock:"tablesorter-no-sort",headers:{7:{sorter:!1}},widgetOptions:{filter_external:s,filter_defaultFilter:{2:"~{query}"}}}),r.on("filterEnd",function(){""==w.trim(s.val())?l.show():l.hide(),0==w("#the-list tr:visible",r).length?p.show():p.hide()}),w("button.run-single-table-optimization").addClass("btn btn-secondary"),w("#optimize_current_db_size").closest("h3").addClass("updraftcentral-current-db-size"),w("#wpoptimize_table_list > tbody > tr").each(function(t){var e=w(this);t%2==1?e.addClass("even"):e.addClass("odd")}),w("#wpoptimize_table_list th > div.tablesorter-header-inner").each(function(){var t=w(this).html();w(this).closest("th").attr("data-label",t)}),i="",w("#wpo_settings_sites_list_cron").length&&(i="_cron"),O(w("#wpo_settings_sites_list"+i+" #wpo_all_sites"+i),w("#wpo_sitelist_moreoptions"+i+' input[type="checkbox"]')),UpdraftCentral.register_event_handler("click","#wpo_sitelist_show_moreoptions"+i,function(){w("#wpo_sitelist_moreoptions"+i).hasClass("wpo_always_visible")||w("#wpo_sitelist_moreoptions"+i).toggleClass("wpo_hidden")}),UpdraftCentral.register_event_handler("change","#wpo_settings_sites_list"+i+" #wpo_all_sites"+i,function(){var t=w(this),e=w("#wpo_sitelist_moreoptions"+i+' input[type="checkbox"]');t.is(":checked")?e.prop("checked",!0):e.prop("checked",!1),O(t,e)}),UpdraftCentral.register_event_handler("change","#wpo_sitelist_moreoptions"+i+' input[type="checkbox"]',function(){var t=w("#wpo_sitelist_moreoptions"+i+' input[type="checkbox"]');O(w("#wpo_settings_sites_list"+i+" #wpo_all_sites"+i),t)}),UpdraftCentral.register_event_handler("change",'#wpo_settings_sites_list input[type="checkbox"]',function(){var t,e;e=[(t=_).data("site_id"),j().join("_")].join("_"),v.hasOwnProperty(e)?x(v[e]):T({name:"get_optimizations_info",arguments:{"wpo-sites":j()}},t).then(function(t){void 0!==t&&!1!==t&&x(v[e]=t)})}),UpdraftCentral.register_event_handler("click","#wpoptimize_table_list .run-single-table-optimization",function(){var e=w(this),i=e.next(),n=i.next(),t={optimization_id:"optimizetables",optimization_table:e.data("table"),optimization_table_type:e.data("type")};i.removeClass("visibility-hidden"),W({optimization_id:"optimizetables",data:t},_).then(function(t){e.prop("disabled",!1),i.addClass("visibility-hidden"),n.show().removeClass("visibility-hidden").delay(3e3).fadeOut("slow")})}),UpdraftCentral.register_event_handler("click","#wpoptimize_table_list .run-single-table-delete",function(){if(!confirm(udclion.wpo.are_you_sure_you_want_to_remove_this_table))return!1;var n=w(this),t=n.next(),o=t.next(),a=n.data("table");data={optimization_id:"orphanedtables",optimization_table:a},t.removeClass("visibility-hidden");var e={optimization_id:"orphanedtables",data:data};h.pre_optimization_run(_,!1,function(){W(e,_).then(function(t){var i,e;t.result.meta.success?(i=n.closest("tr"),o.show().removeClass("visibility-hidden"),setTimeout(function(){i.fadeOut("slow",function(){var t,e;i.remove(),t=w("#wpoptimize_table_list"),e=!0,w("tr",t).each(function(){var t=w(this);if(0<w("button",t).length)return e=!1}),w("tr",t).each(function(){var t=w(this);e?w("td:last, th:last",t).hide():w("td:last, th:last",t).show()})})},500)):(e=vsprintf(udclion.wpo.table_was_not_deleted,[a]),t.result.meta.message&&(e+="("+t.result.meta.message+")"),UpdraftCentral_Library.dialog.alert("<h2>"+udclion.error+"</h2><p>"+e+"</p>"))}).always(function(){n.prop("disabled",!1),t.addClass("visibility-hidden")})})}),UpdraftCentral.register_event_handler("click","#wpo_import_settings_btn",function(){var t=w("#wpo_import_settings_file"),i=t.val(),n=t[0].files[0],t=new FileReader;if(w("#wpo_import_settings_btn").prop("disabled",!0),!/\.json$/.test(i))return e.preventDefault(),w("#wpo_import_settings_btn").prop("disabled",!1),w("#wpo_import_error_message").text(udclion.wpo.please_select_settings_file).slideDown(),!1;t.onload=function(){var t,e,i,n,o;t=this.result,e=_,i=w("#wpo_import_spinner"),n=w("#wpo_import_success_message"),o=w("#wpo_import_error_message"),t={name:"import_settings",arguments:{settings:t}},i.show(),T(t,e).then(function(t){i.hide(),t&&t.errors&&t.errors.length?(o.text(t.errors.join("<br>")),o.slideDown()):t&&t.messages&&t.messages.length&&(n.text(t.messages.join("<br>")),n.slideDown(),setTimeout(function(){h.load_contents(e,"settings")},2e3)),w("#wpo_import_settings_btn").prop("disabled",!1)})},t.readAsText(n)}),UpdraftCentral.register_event_handler("change","#wpo_import_settings_file",function(){w("#wpo_import_error_message").slideUp()}),UpdraftCentral.register_event_handler("click","#wpo_export_settings_btn",function(){var t,e,i,n,o,a;t=$("object"),i=document.body.appendChild(document.createElement("a")),n=new Date,o=n.getFullYear(),a=n.getMonth()<10?["0",n.getMonth()].join(""):n.getMonth(),n=n.getDay()<10?["0",n.getDay()].join(""):n.getDay(),e=e||["wpo-settings-",o,"-",a,"-",n,".json"].join(""),i.setAttribute("download",e),i.setAttribute("style","display:none;"),i.setAttribute("href","data:text/json;charset=UTF-8,"+encodeURIComponent(JSON.stringify(t))),i.click()}),UpdraftCentral.register_event_handler("click",".updraftcentral_wpo_rows input#innodb_force_optimize",function(){var t=w(this).closest("tr.wp-optimize-settings"),e=w(this).is(":checked");t.find("input.optimization_checkbox, button.wp-optimize-settings-optimization-run-button").each(function(){!e&&w(this).hasClass("optimization_checkbox")&&w(this).prop("checked",!1),w(this).prop("disabled",!e)})}),UpdraftCentral.register_event_handler("change",".updraftcentral_wpo_rows input#enable-schedule",function(){q()}),UpdraftCentral.register_event_handler("change",".updraftcentral_wpo_rows input#wp-optimize-logger-updraft_ring_logger",function(){S()}),UpdraftCentral.register_event_handler("change",".updraftcentral_wpo_rows input#wp-optimize-logger-updraft_slack_logger",function(){M()}),UpdraftCentral.register_event_handler("click",".updraftcentral_wpo_rows #wp_optimize_table_list_refresh",function(){h.load_contents(_,"table_information")}),UpdraftCentral.register_event_handler("click",'.updraftcentral_wpo_rows button[id^="wp-optimize-disable-enable-trackbacks-"]',function(){h.toggle_feature("trackbacks",w(this),_)}),UpdraftCentral.register_event_handler("click",'.updraftcentral_wpo_rows button[id^="wp-optimize-disable-enable-comments-"]',function(){h.toggle_feature("comments",w(this),_)}),UpdraftCentral.register_event_handler("click",".updraftcentral_wpo_rows input#wp-optimize-settings-save",function(){h.save_settings(_)}),UpdraftCentral.register_event_handler("click",".updraftcentral_wpo_rows a#wp_optimize_status_box_refresh",function(){h.load_contents(_,"wp_optimize")}),UpdraftCentral.register_event_handler("click",".updraftcentral_wpo_rows button.wp-optimize-settings-optimization-run-button",function(){h.run_optimization_single(this,_)}),UpdraftCentral.register_event_handler("click",".updraftcentral_wpo_rows input#wp-optimize",function(){0==w("#optimizations_list input.optimization_checkbox:checked").length?UpdraftCentral_Library.dialog.alert("<h2>"+udclion.error+"</h2><p>"+udclion.wpo.no_selected_items+"</p>"):h.run_optimization_all(_)}),void 0!==g&&(t=w("#wp-optimize-auto-options"),n=w('input[type="time"]'),o=w('input[type="date"]'),a=(new Date).toISOString().split("T")[0],m=w(".wpo_auto_event:last").data("count")||0,n.each(function(t,e){Modernizr.inputtypes.time||(w(e).timepicker({timeFormat:"H:i"}),w(e).addClass("no_date_time_support"),w(e).on("changeTime",function(){w(this).timepicker("hide")}))}),o.each(function(t,e){Modernizr.inputtypes.date||(w(e).datepicker({dateFormat:"yy-mm-dd",minDate:0}),w(e).addClass("no_date_time_support"))}),0!==w(".wpo_scheduled_event").length?w(".wpo_no_schedules").hide():w(".wpo_no_schedules").show(),y(),w("#wpo-add-event").on("click",function(t){m++;var e=UpdraftCentral.template_replace("schedule-optimizations",{optimizations:g.auto_optimizations,count:m}),i=UpdraftCentral.template_replace("schedule-schedule_types",{schedule_types:g.schedule_types,count:m}),n=UpdraftCentral.template_replace("schedule-action",{count:m}),o='<div class="wpo_auto_event wpo_cf" data-count="'+m+'">';o+=e+i+n,o+="</div>",w("#wpo_auto_events").prepend(o+'<div class="clear"></div>'),y()}),$logging=w("#wp-optimize-logger-settings"),$logging.find(".wpo_logging_header").append('<div class="clear"></div>'),$logging.find(".wpo_logging_row").append('<div class="clear"></div>'),$logging.find(".wpo_logging_row").each(function(){0===w(this).find(".wpo_logging_options_row").html().length&&w(this).find(".wpo_logging_options_row").html("&nbsp;")}),$logging.find("#wpo_add_logger_link").on("click",function(){w("#wp-optimize-logger-settings .save_settings_reminder").after(function(){var t,e=['<option value="">Select destination</option>'];for(t in g.loggers_classes_info)g.loggers_classes_info.hasOwnProperty(t)&&e.push(['<option value="',t,'">',g.loggers_classes_info[t].description,"</option>"].join(""));return['<div class="wpo_add_logger_form">','<select class="wpo_logger_type" name="wpo-logger-type[]">',e.join(""),"<select>",'<a href="#" class="wpo_delete_logger dashicons dashicons-no-alt"></a>','<div class="wpo_additional_logger_options"></div>',"</div>"].join("")}()),U(w(".wpo_logger_type").first()),$logging.find(".wpo_logger_type").on("change",function(){var t=w(this),e=t.val();t.parent().find(".wpo_additional_logger_options").html(function(t){if(!g.loggers_classes_info[t].options)return"";var e,i=g.loggers_classes_info[t].options,n=[],o="",a="";for(e in i)i.hasOwnProperty(e)&&(a=w.isArray(i[e])?(o=w.trim(i[e][0]),w.trim(i[e][1])):(o=w.trim(i[e]),""),n.push(['<input class="wpo_logger_addition_option" type="text" name="wpo-logger-options[',e,'][]" value="" ','placeholder="',o,'" ',""!==a?'data-validate="'+a+'"':"","/>"].join("")));return n.push('<input type="hidden" name="wpo-logger-options[active][]" value="1" />'),n.join("")}(e)),t.val()&&C()}),$logging.find(".wpo_add_logger_form a.wpo_delete_logger").on("click",function(){k(w(this))})}),$logging.find(".wpo_logging_row a.wpo_delete_logger").on("click",function(){k(w(this))}),$logging.find(".wpo_logging_actions_row .dashicons-edit").on("click",function(){var t=w(this),e=t.closest(".wpo_logging_row");return w(".wpo_additional_logger_options",e).removeClass("wpo_hidden"),w(".wpo_logging_options_row",e).text(""),w(".wpo_logging_status_row",e).text(""),t.hide(),!1}),$logging.find(".wpo_logging_row input.wpo_logger_active_checkbox").on("click",function(){var t=w(this).is(":checked")?1:0;w(this).closest("label").find('input[type="hidden"]').val(t)}),$auto_events=w("#wpo_auto_events"),$auto_events.find(".wpo_auto_event_heading_container").append('<div class="clear"></div>'),$auto_events.find(".wpo_scheduled_event").append('<div class="clear"></div>'),t.on("focus",'input[type="time"]',function(){var t=w(this).get(0);Modernizr.inputtypes.time||(w(t).timepicker({timeFormat:"H:i"}),w(t).on("changeTime",function(){w(this).timepicker("hide")}))}),t.on("keypress","input",function(t){if(13===t.keyCode)return!1}),t.on("focus",'input[type="date"]',function(){var t=w(this).get(0);Modernizr.inputtypes.date||w(t).datepicker({dateFormat:"yy-mm-dd",minDate:0})}),t.on("change",'select, input[type="date"], input[type="time"]',function(){w("#save_settings_reminder").slideDown(),z()}),t.on("change",".wpo_schedule_type",function(){var t=w(this).closest(".wpo_auto_event"),e=t.data("count")||m,i=w(this).val(),n="";Modernizr.inputtypes.date&&Modernizr.inputtypes.time||(n="no_date_time_support");e={date:g.date,time:g.time,day:g.day,day_number:g.day_number,days:g.days,date_value:"",time_value:"00:00",status:g.active,status_value:"checked",week_days:g.week_days,week:g.week,count:e,class_name:n,today:a},n=function(t,e){var i="";switch(t){case"wpo_once":i=UpdraftCentral.template_replace("schedule-once",{details:e});break;case"wpo_daily":i=UpdraftCentral.template_replace("schedule-daily",{details:e});break;case"wpo_weekly":i=UpdraftCentral.template_replace("schedule-weekly",{details:e});break;case"wpo_fortnightly":i=UpdraftCentral.template_replace("schedule-fortnightly",{details:e});break;case"wpo_monthly":i=UpdraftCentral.template_replace("schedule-monthly",{details:e})}return i}(i,e),i=UpdraftCentral.template_replace("schedule-status",{details:e}),e=UpdraftCentral.template_replace("schedule-action",{});w(this).next().html(""),t.find(".wpo_event_status").remove(),t.find(".wpo_event_actions").remove(),""!==n&&w(this).next().html(n),t.append(i+e)}),t.on("click",".wpo_edit_event",function(){var t=w(this).closest(".wpo_scheduled_event");t.hide(),t.next().append('<div class="clear"></div>').show(),z()}),t.on("click",".wpo_remove_event",function(){var t,e,i=w(this).data("count");!0===confirm(g.confirm_remove_task)&&(t=w(this).closest(".wpo_scheduled_event"),e=w(this).closest(".wpo_auto_event"),i==t.next().data("count")&&(t.next().remove(),t.remove()),i==e.prev().data("count")&&e.prev().remove(),e.remove(),w("#save_settings_reminder").slideDown(),z())})),UpdraftCentral.register_event_handler("click","#optimizations_list input#select_all_optimizations",function(){var t=!!w(this).is(":checked");w("#optimizations_list input.optimization_checkbox").each(function(){w(this).prop("checked",t)})})):(UpdraftCentral_Library.dialog.alert("<h2>"+udclion.error+"</h2><p>"+udclion.wpo.could_not_return_content+"</p>"),u.empty())})})},this.save_sites_list=function(t,e){var i=w.Deferred();return T({name:"save_site_settings",arguments:t},e).then(function(t){i.resolve(t)}).fail(function(t){i.reject(t)}),i.promise()},this.get_optimization_tables=function(t){var e=w.Deferred();return T({name:"get_table_list",arguments:{}},t).then(function(t){e.resolve(t)}).fail(function(t){e.reject(t)}),e.promise()}}jQuery(function(){new UpdraftCentral_WPO_Management});