function UpdraftCentral_Updates(){function a(){jQuery("#updraftcentral_modal ul#updates-sections-list li:first").addClass("selected")}var s,_,h=jQuery,e=".updraftcentral_row_extracontents",m=UpdraftCentral.get_debug_level(),r=50,d=!1,g=new UpdraftCentral_Credentials,v=new UpdraftCentral_Collection,l=new UpdraftCentral_Collection,p=new UpdraftCentral_Collection,u=new UpdraftCentral_Tasks_Runner({concurrency:1}),i=new UpdraftCentral_Collection,c=_=!1,f=new UpdraftCentral_Collection,y=new UpdraftCentral_Collection;function b(e){var t=UpdraftCentral.get_cached_response(e,"updates.get_updates");if(null!==t&&UpdraftCentral.is_data_good_to_use(t.created)){t=t.reply.data;if(void 0!==t&&t){e=h('.updraftcentral_site_row[data-site_id="'+e+'"');if(e.length){var a,s=e.find(".updraft_updates_count_container"),r={plugins:t.hasOwnProperty("plugins")?t.plugins:[],themes:t.hasOwnProperty("themes")?t.themes:[],core:t.hasOwnProperty("core")?t.core:[],translations:t.hasOwnProperty("translations")&&t.translations.hasOwnProperty("items")?t.translations.items:[]};if(s.length)if(0===r.core.length&&0===r.plugins.length&&0===r.themes.length&&0===r.translations.length)s.hasClass("updates_count_container_hidden")||s.addClass("updates_count_container_hidden");else for(var n in s.removeClass("updates_count_container_hidden"),r)(a=s.find(".updraft_available_"+n)).length&&(0===r[n].length?a.addClass("updates_count_item_hidden"):(a.removeClass("updates_count_item_hidden"),"plugins"!==n&&"themes"!==n||a.find(".updraft_"+n+"_count").html("("+r[n].length+")")))}}}}function w(s,e,t,r){for(var a=0,n=e.length;a<n;a++){var i,d=e[a];d&&d.hasOwnProperty("update")&&d.update.hasOwnProperty("package")&&d.update.package&&("string"==typeof(i=d.update.package)&&i.match(/^https?:\/\/((downloads|www)\.)?wordpress\.org\//)&&("plugin"==t?UpdraftCentral.get_wporg_metadata(t,d.update.slug,d,function(e,t){var a;e&&e.hasOwnProperty("sections")&&(a=s.find('.updraftcentral_row_extracontents .updates-plugin-update.updates-update[data-plugin-file="'+t.update.plugin+'"]'),(t=(a=c&&void 0!==r?r.find('.row.update-item[data-plugin-file="'+t.update.plugin+'"][data-website_id="'+s.data("site_id")+'"]'):a).data("plugin-info"))&&(t.update.hasOwnProperty("sections")&&t.update.sections||(t.update.sections={}),e.sections.hasOwnProperty("changelog")&&(t.update.sections.changelog=e.sections.changelog),e.sections.hasOwnProperty("description")&&(t.update.sections.description=e.sections.description),a.attr("data-plugin-info",JSON.stringify(t))))}):"theme"==t&&UpdraftCentral.get_wporg_metadata(t,d.update.theme,d,function(e,t){var a;e&&e.hasOwnProperty("sections")&&(a=s.find('.updraftcentral_row_extracontents .updates-theme-update.updates-update[data-theme="'+t.update.theme+'"]'),(t=(a=c&&void 0!==r?r.find('.row.update-item[data-theme="'+t.update.theme+'"][data-website_id="'+s.data("site_id")+'"]'):a).data("theme-info"))&&(e.sections.hasOwnProperty("changelog")&&(t.update.hasOwnProperty("sections")&&t.update.sections||(t.update.sections={}),t.update.sections.changelog=e.sections.changelog),a.attr("data-theme-info",JSON.stringify(t))))})))}}function k(e,t,a,s){var r=t.data("site_id"),t=v.item(r);0<m&&(console.log("UpdraftCentral: update error (follows)"),console.log(e)),a.find(".update-go").show(),a.find(".update-in-progress").hide();var n=t.site_description,i=t.site_url;n==i&&(n="");var d,o="";e.hasOwnProperty("messages")&&jQuery(e.messages).each(function(e,t){o+=t+"\n"}),0<m&&("unable_to_connect_to_filesystem"==e.error?console.log("UpdraftCentral: unable_to_connect_to_filesystem: filesystem credentials apparently wrong; will clear"):console.log("UpdraftCentral: update failed: will clear filesystem credentials in case they were wrong")),t.update_processing=!1,t.site_credentials=!1,v.update(r,t),e.hasOwnProperty("error_message")&&""!=e.error_message?d=e.error_message:udclion.updates.update_error_messages.hasOwnProperty(e.error)?d=udclion.updates.update_error_messages[e.error]:(d=udclion.updates.update_error_messages.update_failed,"update_failed"!=e.error&&(d+=" ("+e.error+")"));var u,l,p,t=jQuery("#updraftcentral_notice_container"),c=jQuery('#updraftcentral_notice_container > .updraftcentral_notice[data-site_id="'+r+'"]:first');u=t,l=jQuery.Deferred(),p=setInterval(function(){jQuery.trim(u.html()).length<1&&(clearInterval(p),l.resolve(!0))},1e3),setTimeout(function(){clearInterval(p),l.reject(!1)},1e4),l.promise().then(function(){c=UpdraftCentral.add_dashboard_notice(UpdraftCentral.template_replace("updates-update-error-container",{site_url:i,site_description:n}),"error",!1,{site_id:r})}).always(function(){c.find(".update-errors").append(UpdraftCentral.template_replace("updates-update-error",{error_message:d,error:e.error,messages:o,entity_info:s,entity:e}))})}function n(e,t){_?t.set_custom_status(udclion.updates.backup_currently_running_for+" "+e.site_description):t.set_custom_status(udclion.updates.backup_currently_running),e.hasOwnProperty("autobackup_requested")&&e.autobackup_requested?e.hasOwnProperty("autobackup_complete")&&e.autobackup_complete?0<m&&console.log("UpdraftCentral: automatic pre-upgrade backup was already requested, and is complete"):0<m&&console.log("UpdraftCentral: automatic pre-upgrade backup was already requested, but is not yet complete"):(0<m&&console.log("UpdraftCentral: automatic pre-upgrade backup indicated - will request"),e.autobackup_requested=!0,e.autobackup_complete=!1,v.update(e.id,e),t="",e.updates.plugin.count()&&(t="plugins"),e.updates.theme.count()&&(t=t?t+",themes":"themes"),e.updates.core.count()&&(t=t?t+",wpcore":"wpcore"),extra_data={_listener_title:"<h2>"+e.site_description+" - "+udclion.updates.automatic_backup+"</h2>"},UpdraftCentral.set_current_site_row(e.site_row),UpdraftCentral_Module_UpdraftPlus.backupnow_go(!1,!1,!1,t,extra_data,udclion.updates.automatic_backup))}function o(e,t,a){var s=jQuery.Deferred();return t.additional_options={progress_bar:a.progress,update_info:e,items_count:a.tasks_count()},function t(s){var r=jQuery.Deferred();var n=s.additional_options.progress_bar;var i=s.additional_options.update_info;var e=void 0!==i.translation&&i.translation?i.label:i.name;_?n.set_current_label(e+" ("+s.site_description+")"):n.set_current_label(e);!s.site_credentials&&s.credentials_required?g.get_credentials(s).then(function(e){s.site_credentials=e.site_credentials,s.save_credentials_in_browser=e.save_credentials_in_browser,t(s).then(function(e){r.resolve(e)}).fail(function(e){_?r.resolve({skip:!0,response:udclion.failed_credentials,site:s.site_description}):r.reject(e)})}).fail(function(e){r.resolve({skip:!0,response:udclion.failed_credentials,site:s.site_description})}):(n.start(),j(s,i).then(function(e){n.update(),r.resolve(e)}).fail(function(e){n.update();var t=UpdraftCentral_Library.md5(s.id+"_"+i.name),a=s.update_queue.item(t);void 0!==a&&a&&a.hasOwnProperty("key")&&(u.remove_task(a.key),f.remove(t),s.update_queue.remove(t)),r.resolve({skip:!0,item:!0,response:i,site:s.site_description})}));return r.promise()}(t).then(function(e){s.resolve(e)}).fail(function(e){s.reject(e)}),s.promise()}function C(s,e,t){if("up_to_date"==s)return 1;if(void 0!==t&&t.latest==t.old)return 1;if(void 0!==e&&e){var r=udclion.updates.latest_version;void 0!==r&&r&&r.length&&(r=r.toLowerCase());var n=udclion.updates.up_to_date;if(void 0!==n&&n&&n.length&&(n=n.toLowerCase()),e.length)if(h.isArray(e)){if(e.filter(function(e,t,a){return"string"!=typeof e&&(e+=""),e=e.toLowerCase(),"update_failed"==s&&-1!==e.indexOf(r)||-1!==e.indexOf(n)}).length)return 1}else if("string"!=typeof e&&(e+=""),e=e.toLowerCase(),"update_failed"==s&&(-1!==e.indexOf(r)||-1!==e.indexOf(n)))return 1}}function j(u,e){var a=jQuery.Deferred(),l=u.site_row,p={},c=jQuery("#updates_container div.updraftcentral_table > .tbody"),t=90*u.additional_options.items_count;switch(400<t&&(t=400),void 0!==e.mysql_error&&delete e.mysql_error,e.entity){case"plugin":p.plugins=[{plugin:e.plugin,slug:e.slug}];break;case"theme":p.themes=[{theme:e.theme}];break;case"core":p.core=[{core:e.core}],t+=450;break;case"translation":p.translations=[{translation:e.translation}]}return u.site_credentials&&(p.meta={filesystem_credentials:u.site_credentials}),UpdraftCentral.send_site_rpc("updates.do_updates",p,l,function(r,e,t){var n,i,s,d,o;"ok"==e&&r?(s=l,d=jQuery.Deferred(),o={force_refresh:!0},UpdraftCentral.send_site_rpc("updates.get_updates",o,s,function(e,t,a){"ok"==t&&e&&"updates"==UpdraftCentral.get_dashboard_mode()?(o.force_refresh=!1,UpdraftCentral.cache_response(s.data("site_id"),"updates.get_updates",o,e).then(function(e){d.resolve(e)})):d.reject(null)},null),d.promise().always(function(e){var i=!1,d=!1,o=[];jQuery(r.data.plugins).each(function(e,t){var a=t.plugin,s=l.find('.updraft_updates_output .updates-plugin-update[data-plugin-file="'+a+'"]'),r=(s=_?c.find('.row.update-item.updates-plugin-update[data-plugin-file="'+a+'"][data-website_id="'+u.id+'"]'):s).data("plugin-info"),n=s.data("new_version"),a=t.hasOwnProperty("error")?"failure":"success";t.hasOwnProperty("error")&&void 0!==udclion.updates.update_error_messages[t.error]&&void 0===t.message&&(t.message=udclion.updates.update_error_messages[t.error]),o.push({site_id:l.data("site_id"),event_type:"update",event_name:"update.plugin",event_data:JSON.stringify(r),event_status:a,event_result_data:JSON.stringify(t)});a={latest:n,old:t.oldVersion};t.hasOwnProperty("error")&&!C(t.error,t.messages,a)?(0<m&&(console.log("send_remote_updates (updates.do_updates): error_code="+t.error+",latest_version="+n+",old_version="+t.oldVersion),console.log("send_remote_updates (failed update): response object (follows):"),console.log(t)),d=!0,k(t,l,s,r)):(i=!0,0<m&&t.hasOwnProperty("messages")&&console.log(t.messages),b(l.data("site_id")),s.slideUp("slow",function(){s.remove()}))}),jQuery(r.data.themes).each(function(e,t){var a=t.theme,s=l.find('.updraft_updates_output .updates-theme-update[data-theme="'+a+'"]'),r=(s=_?c.find('.row.update-item.updates-theme-update[data-theme="'+a+'"][data-website_id="'+u.id+'"]'):s).data("theme-info"),n=s.data("new_version"),a=t.hasOwnProperty("error")?"failure":"success";t.hasOwnProperty("error")&&void 0!==udclion.updates.update_error_messages[t.error]&&void 0===t.message&&(t.message=udclion.updates.update_error_messages[t.error]),o.push({site_id:l.data("site_id"),event_type:"update",event_name:"update.theme",event_data:JSON.stringify(r),event_status:a,event_result_data:JSON.stringify(t)});a={latest:n,old:t.oldVersion};t.hasOwnProperty("error")&&!C(t.error,t.messages,a)?(0<m&&(console.log("send_remote_updates (updates.do_updates): error_code="+t.error+",latest_version="+n+",old_version="+t.oldVersion),console.log("send_remote_updates (failed update): response object (follows):"),console.log(t)),d=!0,k(t,l,s,r)):(i=!0,0<m&&t.hasOwnProperty("messages")&&console.log(t.messages),b(l.data("site_id")),s.slideUp("slow",function(){s.remove()}))}),jQuery(r.data.core).each(function(e,t){var a=l.find(".updraft_updates_output .updates-core-update"),s=(a=_?c.find('.row.update-item.updates-core-update[data-website_id="'+u.id+'"]'):a).data("core-info"),r=a.data("new_version"),n=t.hasOwnProperty("error")?"failure":"success";s.name=udclion.updates.wordpress,t.hasOwnProperty("error")&&void 0!==udclion.updates.update_error_messages[t.error]&&void 0===t.message&&(t.message=udclion.updates.update_error_messages[t.error]),o.push({site_id:l.data("site_id"),event_type:"update",event_name:"update.core",event_data:JSON.stringify(s),event_status:n,event_result_data:JSON.stringify(t)});n={latest:r,old:t.oldVersion};t.hasOwnProperty("error")&&!C(t.error,t.messages,n)?(0<m&&(console.log("send_remote_updates (updates.do_updates): error_code="+t.error+",latest_version="+r+",old_version="+t.oldVersion),console.log("send_remote_updates (failed update): response object (follows):"),console.log(t)),d=!0,k(t,l,a,s)):(i=!0,0<m&&t.hasOwnProperty("messages")&&console.log(t.messages),b(l.data("site_id")),a.slideUp("slow",function(){a.remove()}))}),jQuery(r.data.translations).each(function(e,t){var a=l.find('.updraft_updates_output .updates-translation-update[data-website_id="'+u.id+'"]'),s=(a=_?c.find('.row.update-item.updates-translation-update[data-website_id="'+u.id+'"]'):a).data("translation-info"),r=t.hasOwnProperty("error")?"failure":"success";t.hasOwnProperty("error")&&void 0!==udclion.updates.update_error_messages[t.error]&&void 0===t.message&&(t.message=udclion.updates.update_error_messages[t.error]),o.push({site_id:l.data("site_id"),event_type:"update",event_name:"update.translation",event_data:JSON.stringify(s),event_status:r,event_result_data:JSON.stringify(t)}),t.hasOwnProperty("error")&&!C(t.error,t.messages)?(0<m&&(console.log("send_remote_updates (updates.do_updates): error_code="+t.error),console.log("send_remote_updates (failed update): response object (follows):"),console.log(t)),d=!0,k(t,l,a,s)):(i=!0,0<m&&t.hasOwnProperty("messages")&&console.log(t.messages),b(l.data("site_id")),a.slideUp("slow",function(){a.remove()}))}),i&&!d&&u.save_credentials_in_browser&&UpdraftCentral.storage_set("filesystem_credentials_"+u.site_hash,u.site_credentials,!0),UpdraftCentral.bulk_log_event(o).always(function(){d?a.reject(r):a.resolve(r)})})):(n=[],i=[],p.hasOwnProperty("plugins")&&jQuery(p.plugins).each(function(e,t){var a=t.plugin,s=l.find('.updraft_updates_output .updates-plugin-update[data-plugin-file="'+a+'"]'),a=(s=_?c.find('.row.update-item.updates-plugin-update[data-plugin-file="'+a+'"][data-website_id="'+u.id+'"]'):s).data("plugin-info");t.error="update_failed",r.hasOwnProperty("data")&&(t.debug=r.data),i.push({site_id:l.data("site_id"),event_type:"update",event_name:"update.plugin",event_data:JSON.stringify(a),event_status:"failure",event_result_data:JSON.stringify(t)}),k(t,l,s,a),n.push({entity_info:a,error:t.error})}),p.hasOwnProperty("themes")&&jQuery(p.themes).each(function(e,t){var a=t.theme,s=l.find('.updraft_updates_output .updates-theme-update[data-theme="'+a+'"]'),a=(s=_?c.find('.row.update-item.updates-theme-update[data-theme="'+a+'"][data-website_id="'+u.id+'"]'):s).data("theme-info");t.error="update_failed",r.hasOwnProperty("data")&&(t.debug=r.data),i.push({site_id:l.data("site_id"),event_type:"update",event_name:"update.theme",event_data:JSON.stringify(a),event_status:"failure",event_result_data:JSON.stringify(t)}),k(t,l,s,a),n.push({entity_info:a,error:t.error})}),p.hasOwnProperty("core")&&jQuery(p.core).each(function(e,t){var a=l.find(".updraft_updates_output .updates-core-update"),s=(a=_?c.find('.row.update-item.updates-core-update[data-website_id="'+u.id+'"]'):a).data("core-info");s.name=udclion.updates.wordpress,t.error="update_failed",r.hasOwnProperty("data")&&(t.debug=r.data),i.push({site_id:l.data("site_id"),event_type:"update",event_name:"update.core",event_data:JSON.stringify(s),event_status:"failure",event_result_data:JSON.stringify(t)}),k(t,l,a,s),n.push({entity_info:s,error:t.error})}),p.hasOwnProperty("translations")&&jQuery(p.translations).each(function(e,t){var a=l.find('.updraft_updates_output .updates-translation-update[data-website_id="'+u.id+'"]'),s=(a=_?c.find('.row.update-item.updates-translation-update[data-website_id="'+u.id+'"]'):a).data("translation-info");t.error="update_failed",r.hasOwnProperty("data")&&(t.debug=r.data),i.push({site_id:l.data("site_id"),event_type:"update",event_name:"update.translation",event_data:JSON.stringify(s),event_status:"failure",event_result_data:JSON.stringify(t)}),k(t,l,a,s),n.push({entity_info:s,error:t.error})}),UpdraftCentral.bulk_log_event(i).always(function(){a.reject(n)}))},null,t),a.promise()}function U(e,t){O(jQuery(".updraftcentral_row_extracontents button#btn-update-all"),e,t)}function Q(e,t){O(jQuery(".updraftcentral_row_extracontents button#btn-mass-update"),e,t)}function O(e,t,a){t=t.tasks_count(),t=void 0!==a&&a?(e.addClass("disabled"),udclion.updates.updates_in_progress):(0<t?e.removeClass("disabled"):e.addClass("disabled"),a=1==t?udclion.updates.queued_update:udclion.updates.queued_updates,'<span class="dashicons dashicons-controls-play"></span> '+udclion.updates.process+" "+a+" ("+t+")");e.html(t)}function x(e,t){var a=l.item(e.id);void 0!==a&&(void 0!==t&&a.progress.abort(t),a.clear_tasks(),l.update(e.id,a),p.clear(),e.update_processing=!1,void 0!==v&&v.update(e.id,e),U(a),jQuery(".updraftcentral_row_extracontents button.update-go").removeClass("disabled").show(),jQuery(".updraftcentral_row_extracontents button.update-in-progress").removeClass("disabled").hide(),setTimeout(function(){a.progress.reset()},2e3))}function P(n,i,d,o){var u=jQuery.Deferred(),e=o.data("site_id"),t=new UpdraftCentral_Site(o);v.exists(e)&&(t=v.item(e));var a,s,l,p,r,c="",_={},f={plugins:null,themes:null,core:null,translations:null};return n.data&&(dayjs.extend(dayjs_plugin_relativeTime),a=dayjs().fromNow(),n.data.hasOwnProperty("plugins")&&n.data.plugins.length&&(_={plugins:n.data.plugins,website:t.site_description,website_id:t.id,host_url:t.site_url},_=h.extend({last_fetched:n.hasOwnProperty("last_fetched")?n.last_fetched:a},_),f.plugins=UpdraftCentral.template_replace("updates-plugin-mass-updates",_),c+=f.plugins),n.data.hasOwnProperty("themes")&&n.data.themes.length&&(_={themes:n.data.themes,website:t.site_description,website_id:t.id,host_url:t.site_url},_=h.extend({last_fetched:n.hasOwnProperty("last_fetched")?n.last_fetched:a},_),f.themes=UpdraftCentral.template_replace("updates-theme-mass-updates",_),c+=f.themes),n.data.hasOwnProperty("core")&&n.data.core.length&&(_={core:n.data.core,website:t.site_description,website_id:t.id,host_url:t.site_url},_=h.extend({last_fetched:n.hasOwnProperty("last_fetched")?n.last_fetched:a},_),f.core=UpdraftCentral.template_replace("updates-core-mass-updates",_),c+=f.core),n.data.hasOwnProperty("translations")&&n.data.translations&&(s=udclion.updates.translations+" ("+t.site_description+")",_={translations:n.data.translations.items,as_json:JSON.stringify(n.data.translations.items),website_id:t.id,website:t.site_description,name:s},_=h.extend({last_fetched:n.hasOwnProperty("last_fetched")?n.last_fetched:a},_),f.translations=UpdraftCentral.template_replace("updates-translation-mass-updates",_),c+=f.translations),n.data.hasOwnProperty("meta")&&void 0!==n.data.meta.automatic_backups&&(t.automatic_backups=n.data.meta.automatic_backups)),f.plugins||f.themes||f.core||f.translations?(l=i.find(".updraft_updates_output"),f=jQuery("<option/>",{value:t.site_description}),c=UpdraftCentral_Library.sanitize_html(c),f.html(t.site_description),v.exists(e)||v.add(t.id,t),p=t,t=c,r=jQuery.Deferred(),p.updates.plugin.clear(),p.updates.theme.clear(),p.updates.core.clear(),p.updates.translation.clear(),jQuery("<table/>",{style:"display:none;"}).html(t).find(".row.update-item").each(function(){var e=jQuery(this),t=e.data("entity"),a=e.data("name"),s=e.data(t+"-info");if("translation"===t||("core"===t||s&&s.hasOwnProperty("update"))&&("core"!==t||s&&s.hasOwnProperty("version"))){e=!0;if(s.hasOwnProperty("installed")&&s.installed.hasOwnProperty("is_mysql")&&!s.installed.is_mysql&&(e=!1),s.hasOwnProperty("sufficient")&&(e=!e||s.sufficient.mysql,r=s.sufficient.php,e?r||(mysql_error="<h2>"+udclion.updates.cannot_update+"</h2>"+sprintf(udclion.updates.insufficient_php,s.version,s.php_version,s.installed.php)):mysql_error=r?"<h2>"+udclion.updates.cannot_update+"</h2>"+sprintf(udclion.updates.insufficient_mysql,s.version,s.mysql_version,s.installed.mysql):"<h2>"+udclion.updates.cannot_update+"</h2>"+sprintf(udclion.updates.insufficient_php_and_mysql,s.version,s.php_version,s.mysql_version,s.installed.php,s.installed.mysql)),void 0===a||!a||!a.length)switch(t){case"plugin":case"theme":a=s.update[t];break;case"core":a=udclion.updates.wordpress;break;case"translation":a=udclion.updates.translations+" ("+p.site_description+")"}if(void 0!==a&&a&&a.length){var r,n={},i=!1;switch(t){case"plugin":n.plugin=s.update.plugin,n.slug=s.update.slug,n.label=s.name,n.name=a,n.old_version=s.version,n.new_version=s.update.new_version,n.plugin&&n.plugin.length&&n.slug&&n.slug.length||(i=!0);break;case"theme":n.theme=s.update.theme,n.label=s.name,n.name=a,n.old_version=s.version,n.new_version=s.update.new_version,n.theme&&n.theme.length||(i=!0);break;case"core":"undefined"!=typeof mysql_error&&(n.mysql_error=mysql_error),n.core=s.version,n.label=a,n.name=a,n.old_version=s.installed.version,n.new_version=s.version,n.core&&n.core.length||(i=!0);break;case"translation":n.translation=1,n.label=udclion.updates.translations,n.name=a}!i&&n&&n.hasOwnProperty("name")&&n.name?(r=UpdraftCentral_Library.md5(p.id+"_"+n.name),n.entity=t,p.updates[t].add(r,n)):0<m&&(console.log("UpdraftCentral: preload_site_updates_credentials(): update ("+t+") without expected info (details follow)"),console.log(n))}}}),g.load_credentials(p).then(function(e){var t,a=e.request_filesystem_credentials,s=!1;for(t in a)UpdraftCentral_Library.parseBool(a[t])&&(s=!0);p.credentials_required=s,v.update(p.id,p),0<m&&console.log("UpdraftCentral: remote site credentials has been loaded"),r.resolve({site:p,response:e})}).fail(function(e){r.reject(e)}),r.promise().then(function(e){d.update(),i.find("div.updraftcentral_table").is(":visible")||i.find("div.updraftcentral_table").show(),i.find("div.updraftcentral_table > .tbody").append(c),i.find('div.updraftcentral_table > .tbody input[name="uc_updates_check_item"]').attr("disabled",!0);var t=jQuery("div.updates_table_container.mass_updates"),a=t.find('.row.update-item[data-entity="plugin"]:visible').length,s=t.find('.row.update-item[data-entity="theme"]:visible').length,r=t.find('.row.update-item[data-entity="core"]:visible').length;translation_count=t.find('.row.update-item[data-entity="translation"]:visible').length,t.find(".filter-elements span.filter_plugin_count").html(a),t.find(".filter-elements span.filter_theme_count").html(s),t.find(".filter-elements span.filter_core_count").html(r),t.find(".filter-elements span.filter_translation_count").html(translation_count),void 0!==n.data&&(void 0!==n.data.plugins&&n.data.plugins.length&&w(o,n.data.plugins,"plugin",i.find("div.updraftcentral_table > .tbody")),void 0!==n.data.themes&&n.data.themes.length&&w(o,n.data.themes,"theme",i.find("div.updraftcentral_table > .tbody"))),u.resolve({output:c,output_container:l,response:e,skip:!1})}).fail(function(e){u.resolve({skip:!0,response:e,site:o.data("site_description")})})):u.resolve({skip:!0,response:udclion.updates.no_updates,site:o.data("site_description")}),u.promise()}function q(s,r,e){var n=jQuery.Deferred(),i=e.progress,t={force_refresh:!1};d&&(t.force_refresh=!0),i.set_current_label(udclion.updates.loading_updates_from+' "'+s.data("site_description")+'"...',!0),i.start();e=UpdraftCentral.get_cached_response(s.data("site_id"),"updates.get_updates");return null!==e&&UpdraftCentral.is_data_good_to_use(e.created)&&!d?(dayjs.extend(dayjs_plugin_relativeTime),P(h.extend({last_fetched:dayjs.unix(e.created).fromNow()},e.reply),r,i,s).then(function(e){n.resolve(e)})):UpdraftCentral.send_site_rpc("updates.get_updates",t,s,function(t,e,a){return"ok"==e&&t&&"updates"==UpdraftCentral.get_dashboard_mode()?void UpdraftCentral.cache_response(s.data("site_id"),"updates.get_updates",{force_refresh:!1},t).then(function(e){P(t,r,i,s).then(function(e){b(s.data("site_id")),n.resolve(e)})}):(n.resolve({skip:!0,response:t&&t.hasOwnProperty("error")?t.error:t,site:s.data("site_description")}),!0)},null,90),n.promise()}function S(){var e=h(".updraftcentral_table"),t=e.find(".uc_no_patch_releases"),a=h("input#filter_patch_release"),s=h("input#filter_site_patch_release");t.length&&t.hide();var r=!1;a.is(":visible")&&(r=!0),(a.length&&a.is(":visible")&&a.is(":checked")||s.length&&s.is(":visible")&&s.is(":checked"))&&(r=!!r&&e.find("div#no_matching_items").length,0!==e.find("div.update-item:visible").length||r||(t.length?t.show():((t=h("<div/>",{class:"uc_no_patch_releases text-center"})).html(udclion.updates.no_patch_releases),e.append(t))))}function L(){var e=jQuery("#updates_container div.updraftcentral_table"),t=jQuery("#updates_container div.updraftcentral_table > .tbody"),a=e.find("span.uc_updates_paginator");if(a.length){var s=parseInt(p.item("current_page")),r=parseInt(p.item("items_per_page")),n=p.item("sorted_items")||[],i=parseInt(n.length/r),i=0<parseInt(n.length%r)?i+1:i,d=n.slice((s-1)*r,s*r);if(d.length){jQuery(".row.update-item").hide();for(var o=0;o<d.length;o++){var u=d[o],l=u.data("name"),u=u.data("website");jQuery('.row.update-item[data-name="'+l+'"][data-website="'+u+'"]').show()}}n=jQuery("<a/>",{id:"load_previous",href:"javascript://"}).html(udclion.updates.previous),r=jQuery("<a/>",{id:"load_next",href:"javascript://"}).html(udclion.updates.next);1<s&&d.length?n.removeClass("disabled"):n.addClass("disabled"),s<i&&d.length?r.removeClass("disabled"):r.addClass("disabled"),a.html(jQuery("<div/>").append(n.clone()).html()+" | "+jQuery("<div/>").append(r.clone()).html()),1<i?a.show():a.hide(),0<jQuery(".row.update-item:visible").length?t.find("div#no_matching_items").remove():0==e.find("div#no_matching_items").length&&(e=jQuery('<div id="no_matching_items" class="row"><div class="col-md-12">'+udclion.updates.no_matching_items+"</div></div>"),t.append(e))}}function N(){var a,s;!function(){var i=jQuery('#updates_container input[name="uc_updates_filter_keyword"]').val().toLowerCase(),t=(jQuery("#updates_container div.updraftcentral_table"),[]);if(jQuery(".row.update-item").hide(),jQuery("#updates_container .filter-elements input.uc_updates_filter_type:checked").each(function(){var e=jQuery(this);t.push(e.val())}),t.length)for(var e=0;e<t.length;e++){var a=t[e];("undefined"!=typeof website&&website.length?jQuery('.row.update-item[data-entity="'+a+'"][data-website="'+website+'"]'):jQuery('.row.update-item[data-entity="'+a+'"]')).show()}0<i.length&&jQuery(".row.update-item").each(function(){var e,t,a,s,r,n=jQuery(this);void 0!==n&&n.is(":visible")&&(e=n.data("entity")||"",t=n.data("name")||"",a=n.data("website")||"",s=n.data("installed_version")||"",r=n.data("new_version")||"",-1!==e.toLowerCase().indexOf(i)||-1!==t.toLowerCase().indexOf(i)||-1!==a.toLowerCase().indexOf(i)||-1!==s.toString().indexOf(i)||-1!==r.toString().indexOf(i)?n.show():n.hide())})}(),null!==(t=jQuery('#updates_container select[name="uc_updates_sort"]').val().match(/^(.*)_(asc|desc)$/))&&(a=t[1],s=t[2],(t=(e=jQuery("#updates_container div.updraftcentral_table > .tbody")).find(".row.update-item")).sort(function(e,t){e=jQuery(e).data(a).toString().toLowerCase(),t=jQuery(t).data(a).toString().toLowerCase();return"desc"===s?t<e?-1:e<t?1:0:e<t?-1:t<e?1:0}),e.html(t));var e=jQuery("#updraftcentral_dashboard_existingsites #updates_container").find("div.updraftcentral_table > .tbody"),t=jQuery("div.updates_table_container.mass_updates"),r=0,n=0,i=0,d=0,o=[];e.find("div.updates-update").each(function(){var e,t=jQuery(this);t.is(":visible")&&("plugin"===(e=t.data("entity"))&&r++,"theme"===e&&n++,"core"===e&&i++,"translation"===e&&d++,o.push(t))}),p.exists("sorted_items")?p.update("sorted_items",o):p.add("sorted_items",o),p.update("current_page",1),L(),t.find(".filter-elements span.filter_plugin_count").html(r),t.find(".filter-elements span.filter_theme_count").html(n),t.find(".filter-elements span.filter_core_count").html(i),t.find(".filter-elements span.filter_translation_count").html(d),t=o,h("input#filter_patch_release").is(":checked")&&h.each(t,function(e,t){var a,s=jQuery(t);void 0!==s&&s&&("number"==typeof(a=s.data("installed_version")||"")&&(a=a.toString()),"number"==typeof(t=s.data("new_version")||"")&&(t=t.toString()),a.length&&t.length?(a=a.split("."),t=t.split("."),void 0!==a[1]&&void 0!==t[1]&&a[0]+"."+a[1]==t[0]+"."+t[1]?s.show():s.hide()):s.hide())}),S()}function J(e,t){void 0!==e.site_runner&&(void 0!==t&&e.site_runner.progress.abort(t),e.site_runner.clear_tasks(),p.exists("current_page")?p.update("current_page",1):p.add("current_page",1),p.exists("items_per_page")?p.update("items_per_page",r):p.add("items_per_page",r),h("span.uc_updates_perpage > select").prop("disabled",!1).val(r),d=c=!1,e.container.find("button#btn-reload-updates").removeClass("disabled"),void 0===e.has_non_skipped_items||e.has_non_skipped_items?(e.form_container.find("input, select").removeAttr("disabled"),e.container.find('div.updraftcentral_table > .tbody input[name="uc_updates_check_item"]').each(function(){var e=jQuery(this),t=e.data("unavailable");void 0!==t&&t?e.prop("disabled",!0):e.prop("disabled",!1)}),N(),setTimeout(function(){e.site_runner.progress.reset()},2e3)):(e.container.find("div.updraftcentral_table > .thead").hide(),e.site_runner.progress.reset()))}function T(e,t){var a;0===i.count()?(0<m&&console.log("UpdraftCentral_Updates: process_site_backup - All sites backup has been processed. Proceeding to mass updates now."),t.set_custom_status(udclion.updates.backup_done),setTimeout(function(){e.trigger("click")},2e3)):(a=i.get_items()).length&&((a=a[0]).autobackup_options={caller:T,mass_updates:!0,args:[e,t]},n(a,t))}function D(e,t,a){var s=v.item(e),r=!1;return void 0!==s&&s&&(e=UpdraftCentral_Library.md5(s.id+"_"+t),!s.update_queue.exists(e)||void 0!==(t=s.update_queue.item(e))&&t&&u.remove_task(t.key)&&(r=!0,f.remove(e),s.update_queue.remove(e),v.update(s.id,s),i.exists(s.id)&&0==s.update_queue.count()&&i.remove(s.id),void 0!==a&&a.length&&a.remove())),r}function I(e){var t,a,s,r=e.closest(".update-item"),n=r.data("website_id"),i=v.item(n),d=!1;return void 0!==i&&i&&e.is(":visible")&&(t=r.data("entity"),void 0!==(a=r.data("name"))&&a.length&&(s=UpdraftCentral_Library.md5(i.id+"_"+a),i.update_queue.exists(s)||(!(n=i.get_update_info(t,s))||(n=u.add_task(o,[n,i]))&&(y.exists(i.id)||y.add(i.id,i),f.add(s,{site_id:i.id,entity:t,name:a,website:r.data("website")}),i.update_queue.add(s,{key:n,site_id:i.id}),v.update(i.id,i),e.prop("checked",d=!0))))),d}function A(e,t){var a=e.data("site_id"),s=new UpdraftCentral_Site(e);v.exists(a)&&(s=v.item(a)),l.exists(s.id)?((i=l.item(s.id)).clear_tasks(),l.update(s.id,i)):l.add(s.id,new UpdraftCentral_Tasks_Runner({concurrency:1}));var d,r=e.find(".updraftcentral_row_extracontents"),n="",i={plugins:null,themes:null,core:null,translations:null};t.data&&(t.data.hasOwnProperty("plugins")&&t.data.plugins.length&&(i.plugins=UpdraftCentral.template_replace("updates-plugin-updates",{plugins:t.data.plugins})),t.data.hasOwnProperty("themes")&&t.data.themes.length&&(i.themes=UpdraftCentral.template_replace("updates-theme-updates",{themes:t.data.themes})),t.data.hasOwnProperty("core")&&t.data.core.length&&(i.core=UpdraftCentral.template_replace("updates-core-updates",{core:t.data.core})),t.data.hasOwnProperty("translations")&&t.data.translations&&(i.translations=UpdraftCentral.template_replace("updates-translation-updates",{translations:t.data.translations.items,as_json:JSON.stringify(t.data.translations.items),website_id:s.id})),t.data.hasOwnProperty("meta")&&void 0!==t.data.meta.automatic_backups&&(s.automatic_backups=t.data.meta.automatic_backups)),n=i.plugins||i.themes||i.core||i.translations?UpdraftCentral.template_replace("updates-table-header",i):"<h5>"+udclion.updates.no_updates+"</h5>",r.html('<div class="updraft_updates_output updraft_module_output"><div class="dashicons dashicons-image-rotate updraftcentral_action_show_updates updraftcentral_updates_force_check"></div>'+UpdraftCentral_Library.sanitize_html(n)+"</div>"),t.data.hasOwnProperty("plugins")&&t.data.plugins.length&&w(e,t.data.plugins,"plugin"),t.data.hasOwnProperty("themes")&&t.data.themes.length&&w(e,t.data.themes,"theme"),v.exists(a)||v.add(s.id,s),(d=s).updates.plugin.clear(),d.updates.theme.clear(),d.updates.core.clear(),d.updates.translation.clear(),jQuery(".updraftcentral_row_extracontents button.update-go").each(function(){var e=jQuery(this).closest(".row.update-item"),t=e.data("entity"),a=e.data("name"),s=e.data(t+"-info");if("translation"===t||("core"===t||s&&s.hasOwnProperty("update"))&&("core"!==t||s&&s.hasOwnProperty("version"))){e=!0;if(s.hasOwnProperty("installed")&&s.installed.hasOwnProperty("is_mysql")&&!s.installed.is_mysql&&(e=!1),s.hasOwnProperty("sufficient")&&(e=!e||s.sufficient.mysql,r=s.sufficient.php,e?r||(mysql_error="<h2>"+udclion.updates.cannot_update+"</h2>"+sprintf(udclion.updates.insufficient_php,s.version,s.php_version,s.installed.php)):mysql_error=r?"<h2>"+udclion.updates.cannot_update+"</h2>"+sprintf(udclion.updates.insufficient_mysql,s.version,s.mysql_version,s.installed.mysql):"<h2>"+udclion.updates.cannot_update+"</h2>"+sprintf(udclion.updates.insufficient_php_and_mysql,s.version,s.php_version,s.mysql_version,s.installed.php,s.installed.mysql)),void 0===a||!a||!a.length)switch(t){case"plugin":case"theme":a=s.update[t];break;case"core":a=udclion.updates.wordpress;break;case"translation":a=udclion.updates.translations+" ("+d.site_description+")"}if(void 0!==a&&a&&a.length){var r,n={},i=!1;switch(t){case"plugin":n.plugin=s.update.plugin,n.slug=s.update.slug,n.label=s.name,n.name=a,n.old_version=s.version,n.new_version=s.update.new_version,n.plugin&&n.plugin.length&&n.slug&&n.slug.length||(i=!0);break;case"theme":n.theme=s.update.theme,n.label=s.name,n.name=a,n.old_version=s.version,n.new_version=s.update.new_version,n.theme&&n.theme.length||(i=!0);break;case"core":"undefined"!=typeof mysql_error&&(n.mysql_error=mysql_error),n.core=s.version,n.label=a,n.name=a,n.old_version=s.installed.version,n.new_version=s.version,n.core&&n.core.length||(i=!0);break;case"translation":n.translation=1,n.label=udclion.updates.translations,n.name=a}!i&&n&&n.hasOwnProperty("name")&&n.name?(r=UpdraftCentral_Library.md5(d.id+"_"+n.name),n.entity=t,d.updates[t].add(r,n)):0<m&&(console.log("UpdraftCentral: load_site_updates(): update ("+t+") without expected info (details follow)"),console.log(n))}}}),g.load_credentials(d).then(function(e){var t,a=e.request_filesystem_credentials,s=!1;for(t in a)UpdraftCentral_Library.parseBool(a[t])&&(s=!0);d.credentials_required=s,v.update(d.id,d),0<m&&console.log("UpdraftCentral: remote site credentials has been loaded")})}function V(e){var t=h(".updraftcentral_updates_force_check"),a=t.find(".uc-fetch-label");void 0!==a&&a.length&&a.remove(),void 0!==e&&e&&(dayjs.extend(dayjs_plugin_relativeTime),e=udclion.updates.last_fetched+": "+dayjs.unix(e).fromNow(),t.append('<div class="uc-fetch-label">'+e+"</div>"),t.find(".uc-fetch-label").on("click",function(e){e.stopPropagation()}))}UpdraftCentral_Updates.reload_interface=function(){N()},jQuery("#updraftcentral_dashboard_existingsites").on("updraftcentral_dashboard_mode_set_updates",function(){UpdraftCentral.register_event_handler("click","input#filter_site_patch_release",function(){var s=h(this);h(".updraftcentral_table div.update-item").each(function(){var e,t,a=h(this);s.is(":checked")?void 0!==a&&a&&("number"==typeof(e=a.data("installed_version")||"")&&(e=e.toString()),"number"==typeof(t=a.data("new_version")||"")&&(t=t.toString()),e.length&&t.length?(e=e.split("."),t=t.split("."),void 0!==e[1]&&void 0!==t[1]&&e[0]+"."+e[1]==t[0]+"."+t[1]?a.show():a.hide()):a.hide()):a.show()}),S()}),UpdraftCentral.register_event_handler("click","input#filter_patch_release",function(){N()}),UpdraftCentral.register_event_handler("click",'#updates_container input[name="uc_updates_check_item"]',function(){var e,t=h(this).closest(".update-item"),a=t.data("website_id"),s=v.item(a),a=h(this);a.is(":checked")?e=I(a):void 0===s||!s||void 0!==(t=t.data("name"))&&t.length&&(e=D(s.id,t)),void 0!==e&&e&&(Q(u),u.tasks_count()?jQuery("#updates_container button#btn-mass-update").removeClass("disabled"):jQuery("#updates_container button#btn-mass-update").addClass("disabled"))}),UpdraftCentral.register_event_handler("click","#updates_queue_selected_items > a",function(){var e=0;jQuery('#updates_container input[name="uc_updates_check_item"]:visible').each(function(){I(h(this))&&e++}),0!==e&&(Q(u),u.tasks_count()?jQuery("#updates_container button#btn-mass-update").removeClass("disabled"):jQuery("#updates_container button#btn-mass-update").addClass("disabled"))}),UpdraftCentral.register_event_handler("click","#updates_dequeue_selected_items > a",function(){var a=0;jQuery('#updates_container input[name="uc_updates_check_item"]:checked').each(function(){var e=h(this).closest(".update-item"),t=e.data("website_id"),t=v.item(t);void 0!==t&&t&&h(this).is(":visible")&&(void 0!==(e=e.data("name"))&&e.length&&D(t.id,e)&&(a++,h(this).prop("checked",!1)))}),0!==a&&(Q(u),u.tasks_count()?jQuery("#updates_container button#btn-mass-update").removeClass("disabled"):jQuery("#updates_container button#btn-mass-update").addClass("disabled"))}),UpdraftCentral.register_event_handler("click","#updates_view_queued_items > a",function(){if(f.count()){for(var e=UpdraftCentral_Library.sort(f.get_items(),"name"),t="<ul>",a=0;a<e.length;a++){var s=e[a];t+=sprintf('<li data-site_id="%s" data-name="%s">%s (%s) - %s <button class="btn btn-primary uc_remove_queue_item">%s</button></li>',s.site_id,s.name,s.name,s.entity,s.website,udclion.updates.remove)}t+="</ul>",UpdraftCentral.open_modal(udclion.updates.queued_items,'<div class="uc_queued_items">'+t+"</div>",null,!1,null,!0,"modal-md")}else UpdraftCentral_Library.dialog.alert("<h2>"+udclion.updates.queue_empty+"</h2><p>"+udclion.updates.no_items_in_queue+"</p>")}),UpdraftCentral.register_event_handler("click","#updraftcentral_modal .uc_remove_queue_item",function(){var e=h(this).closest("li"),t=e.parent(),a=e.data("name"),s=e.data("site_id"),s=v.item(s);void 0!==s&&s&&void 0!==a&&a.length&&D(s.id,a,e)&&(void 0!==(a=h('.update-item[data-website_id="'+s.id+'"][data-name="'+a+'"]'))&&a&&a.length&&a.find('input[name="uc_updates_check_item"]').prop("checked",!1),Q(u),u.tasks_count()?jQuery("#updates_container button#btn-mass-update").removeClass("disabled"):jQuery("#updates_container button#btn-mass-update").addClass("disabled"),0==t.children().length&&UpdraftCentral.close_modal())}),UpdraftCentral.register_event_handler("click","#updates_container div.updraftcentral_table span.uc_updates_paginator a#load_previous",function(){var e;jQuery(this).hasClass("disabled")||(e=parseInt(p.item("current_page")),p.update("current_page",e-1),L())}),UpdraftCentral.register_event_handler("click","#updates_container div.updraftcentral_table span.uc_updates_paginator a#load_next",function(){var e;jQuery(this).hasClass("disabled")||(e=parseInt(p.item("current_page")),p.update("current_page",e+1),L())}),UpdraftCentral.register_event_handler("change",'#updates_container select[name="uc_updates_sort"], #updates_container input.uc_updates_filter_type, #updates_container select[name="uc_updates_filter_website"]',function(){N()}),UpdraftCentral.register_event_handler("change","span.uc_updates_perpage > select",function(){var e=h(this).val(),e=e.length?e:r;p.exists("items_per_page")?p.update("items_per_page",e):p.add("items_per_page",e),N()}),UpdraftCentral.register_event_handler("keyup",'#updates_container input[name="uc_updates_filter_keyword"]',function(){N()}),UpdraftCentral.register_event_handler("click","#updates_container button#btn-mass-update",function(){if(!jQuery(this).hasClass("disabled")||0===i.count()&&u.tasks_count()&&!c){var e=jQuery(this),o=jQuery("div.updates_table_container.mass_updates");0<m&&console.log("Mass updates execution started..."),o&&(h(".updraftcentral_spinner").is(":visible")||h(o).prepend('<div class="updraftcentral_spinner"></div>')),Q(u,_=!0),jQuery("div.updates_table_container.mass_updates").find("input, select, button#btn-reload-updates").attr("disabled",!0);var t=o.find("div.progress-section div.udc-progress-bar");u.progress.set_container(t);var a=h(".updates_table_container.mass_updates select#updates_backup_choice_dropdown").val();if(i.clear(),-1!=h.inArray(a,["default","yes"])&&0<y.count()){var s=y.get_items();if(s.length)for(var r=0;r<s.length;r++){var n=s[r];!n.autobackup_complete&&0<n.update_queue.count()&&!!("yes"==a||n.automatic_backups&&"default"==a)&&!i.exists(n.id)&&i.add(n.id,n)}}0<i.count()?T(e,u.progress):u.process_tasks().then(function(e){0<m&&console.log("Mass updates execution has been completed!");for(var t,a,s="<h2>"+udclion.updates.error_items_header+" ("+udclion.updates.skipped+")</h2>",r=[],n=0;n<e.length;n++)void 0!==(a=e[n]).skip&&a.skip&&(void 0!==a.item&&a.item?(t=a.response,r.push({label:t.label,version:t.old_version,site:a.site})):UpdraftCentral.add_dashboard_notice_singleton(s+a.response+" - "+a.site,"error",3e4,{},"errors"));if(r.length){for(n=0;n<r.length;n++){var i=r[n];s+="<div>"+sprintf("%s (%s) - %s.",i.label,i.version,i.site)+"</div>"}UpdraftCentral.add_dashboard_notice_singleton(s,"error",3e4,{},"error_items")}u.progress.set_complete(),u.clear_tasks();var d=v.get_items();if(d.length)for(n=0;n<d.length;n++)d[n].autobackup_requested=!1,d[n].autobackup_complete=!1,v.update(d[n].id,d[n]);Q(u),o.find("input, select, button#btn-reload-updates").each(function(){var e=jQuery(this),t=e.data("unavailable");void 0!==t&&t?e.prop("disabled",!0):e.prop("disabled",!1)}),h(".updraftcentral_spinner").is(":visible")&&h(".updraftcentral_spinner").remove(),_=!1,f.clear(),jQuery('#updates_container input[name="uc_updates_check_item"]').removeAttr("checked"),setTimeout(function(){u.progress.reset(),N();var e=o.find("div.updraftcentral_table > .tbody");e.find("div.updates-update").length<1&&(o.find("div.updraftcentral_table > .thead").hide(),0<e.find("div#no_matching_items").length&&e.find("div#no_matching_items").remove(),e.append('<div class="row"><div class="col-md-12"><h5>'+udclion.updates.no_available_updates+"</h5></div></div>"))},3e3)}).fail(function(e){0<m&&(console.log("Mass updates execution has stopped due to the following error(s):"),console.log(e)),u.progress.abort(udclion.updates.process_aborted),u.clear_tasks(),Q(u),jQuery("div.updates_table_container.mass_updates").find("input, select, button#btn-reload-updates").each(function(){var e=jQuery(this),t=e.data("unavailable");void 0!==t&&t?e.prop("disabled",!0):e.prop("disabled",!1)}),_=!1,f.clear(),jQuery('#updates_container input[name="uc_updates_check_item"]').removeAttr("checked"),N(),setTimeout(function(){u.progress.reset()},2e3)})}}),UpdraftCentral.register_event_handler("click","#updates_container #btn-reload-updates",function(){jQuery(this).hasClass("disabled")||(d=!0,jQuery(document).find("button.updraftcentral_action_show_all_updates").trigger("click"))}),UpdraftCentral.register_event_handler("click",".updraftcentral_row_extracontents button.update-info",function(){var e=jQuery(this).closest(".row.update-item"),t=e.data("entity"),e=e.data(t+"-info");void 0!==e&&0!==e.length&&e?("translation"===t&&(e={translations:e}),UpdraftCentral.open_modal(udclion.updates.update_info,UpdraftCentral.template_replace("updates-"+t+"-update-info",e),!0,!1,a)):0<m&&console.log(UpdraftCentral_Library.ucfirst(t)+" info not found")}),UpdraftCentral.register_event_handler("click","#updraftcentral_updraftplus_actions > button.updraftcentral_action_choose_another_site",function(){h(this).html(h(this).html().replace(/\s\s+/,"").replace(udclion.return_to_updates,s)),h(this).siblings(".updraftcentral_action_show_all_updates").show()}),UpdraftCentral.register_event_handler("click","#updraftcentral_updraftplus_actions > button.updraftcentral_action_show_all_updates",function(){h(this).hide();var e=h(this).siblings(".updraftcentral_action_choose_another_site");s=e.text().replace(/\s\s+/,""),e.html(e.html().replace(/\s\s+/,"").replace(s,udclion.return_to_updates)),jQuery("#updraftcentral_sites_search_area, #updraftcentral_dashboard_existingsites .updraftcentral_site_row, #updraftcentral_dashboard_existingsites .updraftcentral_row_divider").hide();var t=jQuery("#updraftcentral_dashboard_existingsites"),r=t.find("#updates_container");0===r.length&&(r=jQuery("<div/>",{id:"updates_container",class:"updraftcentral_row_extracontents"}),t.append(r));e=UpdraftCentral.template_replace("updates-table-mass-header",{});r.html('<div class="updraft_updates_output updraft_module_output">'+e+"</div>"),f.clear(),y.clear(),0<v.count()&&h.map(v.get_items(),function(e,t){e.update_queue.clear()}),p.clear(),u.clear_tasks(),t.find(".updraftcentral_site_row:not(.suspended)").each(function(){var e=jQuery(this);u.add_task(q,[e,r])}),r.find("button#btn-reload-updates").addClass("disabled");var n=r.find("div.updates_table_container.mass_updates");n.find("input, select").attr("disabled",!0),c=!0,h("span.uc_updates_perpage > select").prop("disabled",!0),u.progress.set_container(n.find("div.progress-section div.udc-progress-bar")),h(".updraftcentral_spinner").is(":visible")||n.prepend('<div class="updraftcentral_spinner"></div>'),u.process_tasks().then(function(e){n.find(".updraftcentral_spinner").remove(),0<m&&console.log("Tasks execution has been completed!");for(var t,a=!1,s=0;s<e.length;s++)void 0===(t=e[s]).skip||t.skip?0<m&&void 0!==t.site&&(console.log(t.site+" has been skipped due to the following reason or error:"),console.log(t)):a=!0;a||(r.find("div.updraftcentral_table").is(":visible")||r.find("div.updraftcentral_table").show(),r.find("div.updraftcentral_table > .tbody").append('<div class="row"><div class="col-md-12"><h5>'+udclion.updates.no_available_updates+"</h5></div></div>")),u.progress.set_complete(udclion.updates.loading_process_completed),J({site_runner:u,container:r,form_container:n,has_non_skipped_items:a})}).fail(function(e){0<m&&(console.log("Tasks execution has stopped due to the following error(s):"),console.log(e)),J({site_runner:u,container:r,form_container:n},udclion.updates.abort)})}),UpdraftCentral.register_modal_listener("ul#updates-sections-list a.updates-section-link",function(e){e.preventDefault();e=jQuery(this).data("section");jQuery("#updraftcentral_modal #updates-sections-list li.selected").removeClass("selected"),jQuery(this).closest("li").addClass("selected"),jQuery("#updraftcentral_modal .updates-section").hide(),jQuery("#updraftcentral_modal #updates-section-"+e).show()}),UpdraftCentral.register_modal_listener(".request-filesystem-credentials-dialog-content #ssh",function(){jQuery("#updraftcentral_modal .request-filesystem-credentials-dialog-content #ssh_keys").show()}),UpdraftCentral.register_modal_listener(".request-filesystem-credentials-dialog-content #ftp, .request-filesystem-credentials-dialog-content #ftps",function(){jQuery("#updraftcentral_modal .request-filesystem-credentials-dialog-content #ssh_keys").hide()}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents button#btn-update-all",function(d){var e,t,a,o=v.item(d.data("site_id")),u=l.item(o.id);(!jQuery(this).hasClass("disabled")||o.autobackup_complete&&!o.update_processing&&u.tasks_count())&&(a=jQuery(this),e=jQuery(this).parent(),0<m&&console.log("Task runner execution started..."),U(u,!0),jQuery(".updraftcentral_row_extracontents button.update-go").addClass("disabled"),jQuery(".updraftcentral_row_extracontents button.update-in-progress").addClass("disabled"),0===(t=e.find("div.progress-section div.udc-progress-bar")).length&&(t=e.append('<div class="row progress-section"><div class="col-md-12 udc-progress-bar"></div></div>').find("div.progress-section div.udc-progress-bar")),u.progress.set_container(t),t=h(".updates_table_container.per-site select#updates_backup_choice_dropdown").val(),(o.automatic_backups&&"default"==t||"yes"==t)&&!o.autobackup_complete?(o.autobackup_options={caller:a,bypass:!1},n(o,u.progress)):(a=0,o.autobackup_complete&&o.autobackup_options.hasOwnProperty("bypass")&&!o.autobackup_options.bypass&&(u.progress.set_custom_status(udclion.updates.backup_done),o.autobackup_options.bypass=!0,a=2e3),setTimeout(function(){o.update_processing=!0,v.update(o.id,o),u.process_tasks().then(function(e){0<m&&console.log("Tasks execution has been completed!");for(var t,a,s="<h2>"+udclion.updates.error_items_header+" ("+udclion.updates.skipped+")</h2>",r=[],n=0;n<e.length;n++)void 0!==(a=e[n]).skip&&a.skip&&(void 0!==a.item&&a.item?(t=a.response,r.push({label:t.label,version:t.old_version,site:a.site})):UpdraftCentral.add_dashboard_notice_singleton(s+a.response+" - "+a.site,"error",3e4,{},"errors"));if(r.length){for(n=0;n<r.length;n++){var i=r[n];s+="<div>"+sprintf("%s (%s) - %s.",i.label,i.version,i.site)+"</div>"}UpdraftCentral.add_dashboard_notice_singleton(s,"error",3e4,{},"error_items")}u.progress.set_complete(),o.autobackup_requested=!1,o.autobackup_complete=!1,v.update(o.id,o),x(o),setTimeout(function(){var e=d.find(".updates_table_container .tbody");e.children().length<1&&(e.closest(".updates_table_container").remove(),d.find(".updraft_updates_output").append("<h5>"+udclion.updates.no_updates+"</h5>"))},3e3)}).fail(function(e){0<m&&(console.log("Tasks execution has stopped due to the following error(s):"),console.log(e)),x(o,udclion.updates.process_aborted)})},a)))}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents button.update-go",function(e){if(!jQuery(this).hasClass("disabled")){var t,a,s=v.item(e.data("site_id")),r=l.item(s.id),n=jQuery(this).closest(".row.update-item"),i=n.data("entity");if(void 0===(d=n.data("name")))switch(i){case"plugin":case"theme":var d=n.data(i+"-info").update[i];break;case"core":d=udclion.updates.wordpress;break;case"translation":d=udclion.updates.translations+" ("+s.site_description+")"}void 0!==s&&void 0!==d&&d.length&&(t=UpdraftCentral_Library.md5(s.id+"_"+d),(a=s.get_update_info(i,t))&&(void 0!==a.mysql_error?UpdraftCentral_Library.dialog.alert(a.mysql_error,null,!1):(e=r.add_task(o,[a,s]))&&(l.update(s.id,r),0<m&&(console.log("Item queued for processing:"),console.log(a)),n.find("button.update-go").hide(),n.find(".update-in-progress").css("width","auto").show(),p.add(t,e),U(r))))}}),UpdraftCentral.register_row_clicker(".updraftcentral_row_extracontents button.update-in-progress",function(e){if(!jQuery(this).hasClass("disabled")){var t,a=v.item(e.data("site_id")),s=l.item(a.id),r=jQuery(this).closest(".row.update-item"),n=r.data("entity");if(void 0===(i=r.data("name")))switch(n){case"plugin":case"theme":var i=r.data(n+"-info").update[n];break;case"core":i=udclion.updates.wordpress;break;case"translation":i=udclion.updates.translations+" ("+a.site_description+")"}void 0!==a&&void 0!==i&&i.length&&(t=UpdraftCentral_Library.md5(a.id+"_"+i),p.exists(t)&&(e=p.item(t),s.remove_task(e)&&(r.find("button.update-in-progress").hide(),r.find(".update-go").css("width","auto").show(),p.remove(t),U(s))))}}),UpdraftCentral.register_row_clicker(".updraftcentral_action_show_updates",function(s){var e=UpdraftCentral.get_cached_response(s.data("site_id"),"updates.get_updates");null!==e&&!jQuery(this).hasClass("updraftcentral_updates_force_check")&&UpdraftCentral.is_data_good_to_use(e.created)?(A(s,e.reply),V(e.created)):(e={force_refresh:!1},jQuery(this).hasClass("updraftcentral_updates_force_check")&&(e.force_refresh=!0),V(),UpdraftCentral.send_site_rpc("updates.get_updates",e,s,function(t,e,a){"ok"==e&&t&&"updates"==UpdraftCentral.get_dashboard_mode()&&UpdraftCentral.cache_response(s.data("site_id"),"updates.get_updates",{force_refresh:!1},t).then(function(e){A(s,t),V(dayjs().unix()),b(s.data("site_id"))})}))},!0),jQuery("#updraftcentral_notice_container").on("click",".updraftcentral_notice .update-failure-messages-show",function(e){e.preventDefault(),jQuery(this).hide().siblings(".update-failure-messages-text").slideDown()}),jQuery("#updraftcentral_notice_container").on("click",".updraftcentral_notice > .updraftcentral_notice_dismiss",function(){var e=jQuery(this).closest("#updraftcentral_notice_container").find(".update-errors");1<jQuery.trim(e.html()).length&&(e=$site_row.data("site_id"),(e=v.item(e)).update_processing=!1,v.update(e.id,e))}),jQuery("#updraftcentral_dashboard_existingsites").on("updraftcentral_listener_finished_updraftplus_backup",function(e,t){e.preventDefault();e=t.site_id,t=v.item(e);void 0!==t&&(t.autobackup_complete||(0<m&&console.log("UpdraftCentral: automatic backup is complete."),t.autobackup_complete=!0,v.update(t.id,t),void 0!==t.autobackup_options.caller&&(e=t.autobackup_options.caller,void 0!==t.autobackup_options.mass_updates&&t.autobackup_options.mass_updates?(i.exists(t.id)&&i.remove(t.id),e.apply(null,t.autobackup_options.args)):e.trigger("click"))))}),jQuery("#updraftcentral_dashboard_existingsites_container").on("click",".updraftcentral_site_row "+e+" .updates-update a",function(e){var t=jQuery(this).attr("href");void 0!==t&&"http"==t.substring(0,4)&&(e.preventDefault(),window.open(t,"_blank").focus())})})}jQuery(function(){new UpdraftCentral_Updates});